<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Cnd_brasil extends CI_Controller { function __construct(){	parent::__construct();	$this->load->model('log_model','',TRUE);	$this->load->model('loja_model','',TRUE);		$this->load->model('notificacao_model','',TRUE);		$this->load->model('cnd_federal_model','',TRUE);		$this->load->model('cnd_estadual_model','',TRUE);	
	$this->load->model('cnd_mobiliaria_model','',TRUE);	
	$this->load->model('cnd_imobiliaria_model','',TRUE);
    $this->load->model('emitente_imovel_model','',TRUE);
    $this->load->model('tipo_emitente_model','',TRUE);
    $this->load->model('situacao_imovel_model','',TRUE);
    $this->load->model('informacoes_inclusas_iptu_model','',TRUE);
    $this->load->model('user','',TRUE);
    $this->load->model('contratante','',TRUE);
    $this->load->model('emitente_model','',TRUE);
    $this->load->model('imovel_model','',TRUE);
    $this->load->model('iptu_model','',TRUE);
    $this->load->library('Cep');
    $this->load->library('session');   
    $this->load->library('form_validation');
    $this->load->helper('url');	$this->load->helper('pdf_helper');	$this->load->helper('general_helper');
	session_start();	date_default_timezone_set('America/Sao_Paulo');
 }
 function index(){   if(!empty($_SESSION['loginTeste'])){     $session_data = $_SESSION['loginTeste'];     $data['email'] = $session_data['email'];	 $data['empresa'] = $session_data['empresa'];
	 $data['perfil'] = $session_data['perfil'];     $this->load->view('home_view', $data);   }else{     //If no session, redirect to login page     redirect('login', 'refresh');
   } }  function exportPdfTodas(){		$this->logado(); 	$session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estado = $this->input->post('uf');		$this->load->helper('pdf_helper');	date_default_timezone_set('America/Sao_Paulo');		$dataAtual = date("d/m/Y H:i");		tcpdf();	$obj_pdf = new TCPDF('P', PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);	$obj_pdf->SetCreator(PDF_CREATOR);	$title = $dataAtual." - CNDs BRASIL - POR UF : ".$estado;	//$obj_pdf->SetTitle('Status CNDs por IE');	$obj_pdf->SetHeaderData('','' , $title,'' );	$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));	$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));	$obj_pdf->SetDefaultMonospacedFont('helvetica');	$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);	$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);	$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);	$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);	$obj_pdf->SetFont('helvetica', '', 9);	$obj_pdf->setFontSubsetting(false);	$obj_pdf->AddPage();		$cndsEmitidasFed = $this->cnd_federal_model->contaCndFederalByUf($idContratante,1,$estado);	$cndsNaoEmitidasFed = $this->cnd_federal_model->contaCndFederalByUf($idContratante,2,$estado);	$cndsPendentesFed = $this->cnd_federal_model->contaCndFederalByUf($idContratante,3,$estado);	$cndsEmitidasFedTotal = $cndsEmitidasFed[0]->total ;	$cndsNaoEmitidasFedTotal = $cndsNaoEmitidasFed[0]->total ;	$cndsPendentesFedTotal = $cndsPendentesFed[0]->total ;			$totalFedCnds = $cndsEmitidasFed[0]->total + $cndsNaoEmitidasFed[0]->total + $cndsPendentesFed[0]->total; 		if($cndsEmitidasFed[0]->total == 0){		$cndsEmitidasPorcFed =100;	}else{		$cndsEmitidasPorcFed = round((($cndsEmitidasFed[0]->total / $totalFedCnds ) * 100),2);	}			if($cndsNaoEmitidasFed[0]->total == 0){		$cndsNaoEmitidasPorcFed =100;	}else{		$cndsNaoEmitidasPorcFed = round((($cndsNaoEmitidasFed[0]->total / $totalFedCnds ) * 100),2);	}			if($cndsPendentesFed[0]->total == 0){		$cndsPendentesPorcFed =100;	}else{		$cndsPendentesPorcFed = round((($cndsPendentesFed[0]->total / $totalFedCnds ) * 100),2);	}		$cndsEmitidasEst = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,1,$estado);	$cndsNaoEmitidasEst = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,2,$estado);	$cndsPendentesEst = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,3,$estado);	$cndsEmitidasEstTotal = $cndsEmitidasEst[0]->total ;	$cndsNaoEmitidasEstTotal = $cndsNaoEmitidasEst[0]->total ;	$cndsPendentesEstTotal = $cndsPendentesEst[0]->total ;			$totalEstCnds = $cndsEmitidasEst[0]->total + $cndsNaoEmitidasEst[0]->total + $cndsPendentesEst[0]->total; 		if($cndsEmitidasEst[0]->total == 0){		$cndsEmitidasPorcEst =100;	}else{		$cndsEmitidasPorcEst = round((($cndsEmitidasEst[0]->total / $totalEstCnds ) * 100),2);	}			if($cndsNaoEmitidasEst[0]->total == 0){		$cndsNaoEmitidasPorcEst =100;	}else{		$cndsNaoEmitidasPorcEst = round((($cndsNaoEmitidasEst[0]->total / $totalEstCnds ) * 100),2);	}			if($cndsPendentesEst[0]->total == 0){		$cndsPendentesPorcEst =100;	}else{		$cndsPendentesPorcEst = round((($cndsPendentesEst[0]->total / $totalEstCnds ) * 100),2);	}		$cndsEmitidasMob = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,1,$estado);	$cndsNaoEmitidasMob = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,2,$estado);	$cndsPendentesMob = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,3,$estado);	$cndsEmitidasMobTotal = $cndsEmitidasMob[0]->total ;	$cndsNaoEmitidasMobTotal = $cndsNaoEmitidasMob[0]->total ;	$cndsPendentesMobTotal = $cndsPendentesMob[0]->total ;			$totalMobCnds = $cndsEmitidasMob[0]->total + $cndsNaoEmitidasMob[0]->total + $cndsPendentesMob[0]->total; 		if($cndsEmitidasMob[0]->total == 0){		$cndsEmitidasPorcMob =100;	}else{		$cndsEmitidasPorcMob = round((($cndsEmitidasMob[0]->total / $totalMobCnds ) * 100),2);	}			if($cndsNaoEmitidasMob[0]->total == 0){		$cndsNaoEmitidasPorcMob =100;	}else{		$cndsNaoEmitidasPorcMob = round((($cndsNaoEmitidasMob[0]->total / $totalMobCnds ) * 100),2);	}			if($cndsPendentesMob[0]->total == 0){		$cndsPendentesPorcMob =100;	}else{		$cndsPendentesPorcMob = round((($cndsPendentesMob[0]->total / $totalMobCnds ) * 100),2);	}		$cndsEmitidasImob = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,1,$estado);	$cndsNaoEmitidasImob = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,2,$estado);	$cndsPendentesImob = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,3,$estado);	$cndsEmitidasImobTotal = $cndsEmitidasImob[0]->total ;	$cndsNaoEmitidasImobTotal = $cndsNaoEmitidasImob[0]->total ;	$cndsPendentesImobTotal = $cndsPendentesImob[0]->total ;			$totalImobCnds = $cndsEmitidasImob[0]->total + $cndsNaoEmitidasImob[0]->total + $cndsPendentesImob[0]->total; 		if($cndsEmitidasImob[0]->total == 0){		$cndsEmitidasPorcImob =100;	}else{		$cndsEmitidasPorcImob = round((($cndsEmitidasImob[0]->total / $totalImobCnds ) * 100),2);	}			if($cndsNaoEmitidasImob[0]->total == 0){		$cndsNaoEmitidasPorcImob =100;	}else{		$cndsNaoEmitidasPorcImob = round((($cndsNaoEmitidasImob[0]->total / $totalImobCnds ) * 100),2);	}			if($cndsPendentesImob[0]->total == 0){		$cndsPendentesPorcImob =100;	}else{		$cndsPendentesPorcImob = round((($cndsPendentesImob[0]->total / $totalImobCnds ) * 100),2);	}		$data = date("d/m/Y");		$tbl = <<<EOD<table border="0" cellpadding="2" cellspacing="2"><thead><tr style="color:#000;">	<td align="left" ><strong>CND FEDERAL</strong></td>	<td align="left" id='emitQtd'>Total</td>	<td align="left"  id='emitPorc'>$totalFedCnds</td> </tr>  <tr style="color:#000;">	<td align="left" ><strong>Emitidas</strong></td>	<td align="left" id='emitQtd'>$cndsEmitidasFedTotal</td>	<td align="left"  id='emitPorc'>$cndsEmitidasPorcFed %</td> </tr><tr style="color:#000;">	<td align="left" ><strong>Não Tratadas</strong></td>	<td align="left" id='emitQtd'>$cndsNaoEmitidasFedTotal</td>	<td align="left"  id='emitPorc'>$cndsNaoEmitidasPorcFed %</td></tr><tr style="color:#000;">	<td align="left" ><strong>Sem Status</strong></td>	<td align="left" id='emitQtd'>$cndsPendentesFedTotal</td>	<td align="left"  id='emitPorc'>$cndsPendentesPorcFed %</td> </tr> <tr style="color:#000;">	<td align="left" ><strong><BR></strong></td>	<td align="left" id='emitQtd'></td>	<td align="left"  id='emitPorc'></td> </tr>  <tr style="color:#000;">	<td align="left" ><strong>CND ESTADUAL</strong></td>	<td align="left" id='emitQtd'>Total</td>	<td align="left"  id='emitPorc'>$totalEstCnds</td> </tr>  <tr style="color:#000;">	<td align="left" ><strong>Emitidas</strong></td>	<td align="left" id='emitQtd'>$cndsEmitidasEstTotal</td>	<td align="left"  id='emitPorc'>$cndsEmitidasPorcEst %</td> </tr><tr style="color:#000;">	<td align="left" ><strong>Não Tratadas</strong></td>	<td align="left" id='emitQtd'>$cndsNaoEmitidasEstTotal</td>	<td align="left"  id='emitPorc'>$cndsNaoEmitidasPorcEst %</td></tr><tr style="color:#000;">	<td align="left" ><strong>Sem Status</strong></td>	<td align="left" id='emitQtd'>$cndsPendentesEstTotal</td>	<td align="left"  id='emitPorc'>$cndsPendentesPorcEst %</td> </tr>   <tr style="color:#000;">	<td align="left" ><strong><BR></strong></td>	<td align="left" id='emitQtd'></td>	<td align="left"  id='emitPorc'></td> </tr>  <tr style="color:#000;">	<td align="left" ><strong>CND MOBILIÁRIA</strong></td>	<td align="left" id='emitQtd'>Total</td>	<td align="left"  id='emitPorc'>$totalMobCnds</td> </tr>  <tr style="color:#000;">	<td align="left" ><strong>Emitidas</strong></td>	<td align="left" id='emitQtd'>$cndsEmitidasMobTotal</td>	<td align="left"  id='emitPorc'>$cndsEmitidasPorcMob %</td> </tr><tr style="color:#000;">	<td align="left" ><strong>Não Tratadas</strong></td>	<td align="left" id='emitQtd'>$cndsNaoEmitidasMobTotal</td>	<td align="left"  id='emitPorc'>$cndsNaoEmitidasPorcMob %</td></tr><tr style="color:#000;">	<td align="left" ><strong>Sem Status</strong></td>	<td align="left" id='emitQtd'>$cndsPendentesMobTotal</td>	<td align="left"  id='emitPorc'>$cndsPendentesPorcMob %</td> </tr>   <tr style="color:#000;">	<td align="left" ><strong><BR></strong></td>	<td align="left" id='emitQtd'></td>	<td align="left"  id='emitPorc'></td> </tr>  </thead> </table>EOD;	$obj_pdf->writeHTML($tbl, true, false, true, false, '');	$obj_pdf->Output('output.pdf', 'I');			 }	  function exportPdf(){		$this->logado(); 	$session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$this->load->helper('pdf_helper');	date_default_timezone_set('America/Sao_Paulo');		$dataAtual = date("d/m/Y H:i");	$estado = $this->input->post('uf');		$tipoExp = $this->input->post('tipoExp');		tcpdf();	$obj_pdf = new TCPDF('P', PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);	$obj_pdf->SetCreator(PDF_CREATOR);			if($tipoExp =='FEDERAL'){		$title = $dataAtual." - STATUS - CND FEDERAL : ".$estado;		//$obj_pdf->SetTitle('Status CNDs por IE');		$obj_pdf->SetHeaderData('','' , $title,'' );		$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));		$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));		$obj_pdf->SetDefaultMonospacedFont('helvetica');		$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);		$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);		$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);		$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);		$obj_pdf->SetFont('helvetica', '', 9);		$obj_pdf->setFontSubsetting(false);		$obj_pdf->AddPage();			$cndsEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,1,$estado);		$cndsEmitidasTotal = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,2,$estado);		$cndsNaoEmitidasTotal = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_federal_model->contaCndFederalByUf($idContratante,3,$estado);		$cndsPendenteTotal = $cndsPendentes[0]->total;		$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			if($cndsEmitidas[0]->total == 0){			$cndsEmitidasPorc =100;		}else{			$cndsEmitidasPorc = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsNaoEmitidas[0]->total == 0){			$cndsNaoEmitidasPorc=100;		}else{			$cndsNaoEmitidasPorc = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsPendentes[0]->total == 0){			$cndsPendentesPorc =100;		}else{			$cndsPendentesPorc = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}	}elseif($tipoExp =='ESTADUAL'){		$title = $dataAtual." - STATUS - CND ESTADUAL : ".$estado;		//$obj_pdf->SetTitle('Status CNDs por IE');		$obj_pdf->SetHeaderData('','' , $title,'' );		$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));		$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));		$obj_pdf->SetDefaultMonospacedFont('helvetica');		$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);		$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);		$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);		$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);		$obj_pdf->SetFont('helvetica', '', 9);		$obj_pdf->setFontSubsetting(false);		$obj_pdf->AddPage();				$cndsEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,1,$estado);		$cndsEmitidasTotal = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,3,$estado);		$cndsNaoEmitidasTotal = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,2,$estado);		$cndsPendenteTotal = $cndsPendentes[0]->total;		$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			if($cndsEmitidas[0]->total == 0){			$cndsEmitidasPorc =100;		}else{			$cndsEmitidasPorc = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsNaoEmitidas[0]->total == 0){			$cndsNaoEmitidasPorc=100;		}else{			$cndsNaoEmitidasPorc = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsPendentes[0]->total == 0){			$cndsPendentesPorc =100;		}else{			$cndsPendentesPorc = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}	}elseif($tipoExp =='MOBILIÁRIA - INSCRIÇÕES ATIVAS'){		$title = $dataAtual." - STATUS - CND MOBILIÁRIA : ".$estado;		//$obj_pdf->SetTitle('Status CNDs por IE');		$obj_pdf->SetHeaderData('','' , $title,'' );		$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));		$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));		$obj_pdf->SetDefaultMonospacedFont('helvetica');		$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);		$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);		$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);		$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);		$obj_pdf->SetFont('helvetica', '', 9);		$obj_pdf->setFontSubsetting(false);		$obj_pdf->AddPage();				$cndsEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,1,$estado);		$cndsEmitidasTotal = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,2,$estado);		$cndsNaoEmitidasTotal = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,3,$estado);		$cndsPendenteTotal = $cndsPendentes[0]->total;		$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			if($cndsEmitidas[0]->total == 0){			$cndsEmitidasPorc =100;		}else{			$cndsEmitidasPorc = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsNaoEmitidas[0]->total == 0){			$cndsNaoEmitidasPorc=100;		}else{			$cndsNaoEmitidasPorc = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsPendentes[0]->total == 0){			$cndsPendentesPorc =100;		}else{			$cndsPendentesPorc = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}	}else{		$title = $dataAtual." - Status das CND Imobiliária - ".$estado;		//$obj_pdf->SetTitle('Status CNDs por IE');		$obj_pdf->SetHeaderData('','' , $title,'' );		$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));		$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));		$obj_pdf->SetDefaultMonospacedFont('helvetica');		$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);		$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);		$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);		$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);		$obj_pdf->SetFont('helvetica', '', 9);		$obj_pdf->setFontSubsetting(false);		$obj_pdf->AddPage();				$cndsEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,1,$estado);		$cndsEmitidasTotal = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,3,$estado);		$cndsNaoEmitidasTotal = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,3,$estado);		$cndsPendenteTotal = $cndsPendentes[0]->total;		$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			if($cndsEmitidas[0]->total == 0){			$cndsEmitidasPorc =100;		}else{			$cndsEmitidasPorc = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsNaoEmitidas[0]->total == 0){			$cndsNaoEmitidasPorc=100;		}else{			$cndsNaoEmitidasPorc = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsPendentes[0]->total == 0){			$cndsPendentesPorc =100;		}else{			$cndsPendentesPorc = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}	}			$data = date("d/m/Y");		$tbl = <<<EOD<table border="0" cellpadding="2" cellspacing="2"><thead> <tr style="color:#000;">	<td align="left" ><strong>Emitidas</strong></td>	<td align="left" id='emitQtd'>$cndsEmitidasTotal</td>	<td align="left"  id='emitPorc'>$cndsEmitidasPorc %</td> </tr><tr style="color:#000;">	<td align="left" ><strong>Não Tratadas</strong></td>	<td align="left" id='emitQtd'>$cndsNaoEmitidasTotal</td>	<td align="left"  id='emitPorc'>$cndsNaoEmitidasPorc %</td></tr><tr style="color:#000;">	<td align="left" ><strong>Pendentes</strong></td>	<td align="left" id='emitQtd'>$cndsPendenteTotal</td>	<td align="left"  id='emitPorc'>$cndsPendentesPorc %</td> </tr><tr style="color:#000;">	<td align="left" ><strong>Total</strong></td>	<td align="left" id='emitQtd'>$totalCnds</td>	<td align="left"  id='emitPorc'>100 %</td> </tr></thead> </table>EOD;	$obj_pdf->writeHTML($tbl, true, false, true, false, '');	$obj_pdf->Output('output.pdf', 'I');			 }	  function dados_cnd_brasil(){	$this->logado(); 	$session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estado = $this->input->get('estado');			$estadosCnds = array();			$cndsEmitidasFed = $this->cnd_federal_model->contaCndFederalByUf($idContratante,1,$estado);		$cndsNaoEmitidasFed = $this->cnd_federal_model->contaCndFederalByUf($idContratante,2,$estado);		$cndsPendentesFed = $this->cnd_federal_model->contaCndFederalByUf($idContratante,3,$estado);		$estadosCnds['totalFedCnds'] = $totalFedCnds = $cndsEmitidasFed[0]->total + $cndsNaoEmitidasFed[0]->total + $cndsPendentesFed[0]->total; 					$estadosCnds['cndsEmitidasFed'] = $cndsEmitidasFed[0]->total ;		$estadosCnds['cndsNaoEmitidasFed'] = $cndsNaoEmitidasFed[0]->total ;		$estadosCnds['cndsPendentesFed'] = $cndsPendentesFed[0]->total ;				if($cndsEmitidasFed[0]->total == 0){			$estadosCnds['cndsEmitidasPorcFed'] =100;		}else{			$estadosCnds['cndsEmitidasPorcFed'] = round((($cndsEmitidasFed[0]->total / $totalFedCnds ) * 100),2);		}				if($cndsNaoEmitidasFed[0]->total == 0){			$estadosCnds['cndsNaoEmitidasPorcFed'] =100;		}else{			$estadosCnds['cndsNaoEmitidasPorcFed'] = round((($cndsNaoEmitidasFed[0]->total / $totalFedCnds ) * 100),2);		}				if($cndsPendentesFed[0]->total == 0){			$estadosCnds['cndsPendentesPorcFed'] =100;		}else{			$estadosCnds['cndsPendentesPorcFed'] = round((($cndsPendentesFed[0]->total / $totalFedCnds ) * 100),2);		}				$cndsEmitidasEst = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,1,$estado);		$cndsNaoEmitidasEst = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,2,$estado);		$cndsPendentesEst = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,3,$estado);				$estadosCnds['cndsEmitidasEst'] = $cndsEmitidasEst[0]->total ;		$estadosCnds['cndsNaoEmitidasEst'] = $cndsNaoEmitidasEst[0]->total ;		$estadosCnds['cndsPendentesEst'] = $cndsPendentesEst[0]->total ;				$estadosCnds['totalEstCnds'] = $totalEstCnds = $cndsEmitidasEst[0]->total + $cndsNaoEmitidasEst[0]->total + $cndsPendentesEst[0]->total; 			if($cndsEmitidasEst[0]->total == 0){			$estadosCnds['cndsEmitidasPorcEst'] =100;		}else{			$estadosCnds['cndsEmitidasPorcEst'] = round((($cndsEmitidasEst[0]->total / $totalEstCnds ) * 100),2);		}				if($cndsNaoEmitidasEst[0]->total == 0){			$estadosCnds['cndsNaoEmitidasPorcEst'] =100;		}else{			$estadosCnds['cndsNaoEmitidasPorcEst'] = round((($cndsNaoEmitidasEst[0]->total / $totalEstCnds ) * 100),2);		}				if($cndsPendentesEst[0]->total == 0){			$estadosCnds['cndsPendentesPorcEst'] =100;		}else{			$estadosCnds['cndsPendentesPorcEst'] = round((($cndsPendentesEst[0]->total / $totalEstCnds ) * 100),2);		}				$cndsEmitidasMob = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,1,$estado);		$cndsNaoEmitidasMob = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,2,$estado);		$cndsPendentesMob = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,3,$estado);				$estadosCnds['cndsEmitidasMob'] = $cndsEmitidasMob[0]->total ;		$estadosCnds['cndsNaoEmitidasMob'] = $cndsNaoEmitidasMob[0]->total ;		$estadosCnds['cndsPendentesMob'] = $cndsPendentesMob[0]->total ;				$estadosCnds['totalMobCnds'] = $totalMobCnds = $cndsEmitidasMob[0]->total + $cndsNaoEmitidasMob[0]->total + $cndsPendentesMob[0]->total; 			if($cndsEmitidasMob[0]->total == 0){			$estadosCnds['cndsEmitidasPorcMob'] =100;		}else{			$estadosCnds['cndsEmitidasPorcMob'] = round((($cndsEmitidasMob[0]->total / $totalMobCnds ) * 100),2);		}				if($cndsNaoEmitidasMob[0]->total == 0){			$estadosCnds['cndsNaoEmitidasPorcMob'] =100;		}else{			$estadosCnds['cndsNaoEmitidasPorcMob'] = round((($cndsNaoEmitidasMob[0]->total / $totalMobCnds ) * 100),2);		}				if($cndsPendentesMob[0]->total == 0){			$estadosCnds['cndsPendentesPorcMob'] =100;		}else{			$estadosCnds['cndsPendentesPorcMob'] = round((($cndsPendentesMob[0]->total / $totalMobCnds ) * 100),2);		}				$cndsEmitidasImob = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,1,$estado);		$cndsNaoEmitidasImob = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,2,$estado);		$cndsPendentesImob = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,3,$estado);				$estadosCnds['cndsEmitidasImob'] = $cndsEmitidasImob[0]->total ;		$estadosCnds['cndsNaoEmitidasImob'] = $cndsNaoEmitidasImob[0]->total ;		$estadosCnds['cndsPendentesImob'] = $cndsPendentesImob[0]->total ;				$estadosCnds['totalImobCnds'] = $totalImobCnds = $cndsEmitidasImob[0]->total + $cndsNaoEmitidasImob[0]->total + $cndsPendentesImob[0]->total; 			if($cndsEmitidasImob[0]->total == 0){			$estadosCnds['cndsEmitidasPorcImob'] =100;		}else{			$estadosCnds['cndsEmitidasPorcImob'] = round((($cndsEmitidasImob[0]->total / $totalImobCnds ) * 100),2);		}				if($cndsNaoEmitidasImob[0]->total == 0){			$estadosCnds['cndsNaoEmitidasPorcImob'] =100;		}else{			$estadosCnds['cndsNaoEmitidasPorcImob'] = round((($cndsNaoEmitidasImob[0]->total / $totalImobCnds ) * 100),2);		}				if($cndsPendentesImob[0]->total == 0){			$estadosCnds['cndsPendentesPorcImob'] =100;		}else{			$estadosCnds['cndsPendentesPorcImob'] = round((($cndsPendentesImob[0]->total / $totalImobCnds ) * 100),2);		}						echo json_encode($estadosCnds);	 }  function dados_cnd(){	$this->logado(); 	$session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estadosCnds = array();		$estado = $this->input->get('estado');		$tipo = $this->input->get('tipo');			$estadosCnds['uf'] = $estado;		if($tipo =='FEDERAL'){		$cndsEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,1,$estado);		$estadosCnds['cndsEmitidas'] = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,3,$estado);		$estadosCnds['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_federal_model->contaCndFederalByUf($idContratante,2,$estado);		$estadosCnds['cndsPendentes'] = $cndsPendentes[0]->total;		$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			$estadosCnds['totalCnds'] = $totalCnds;		if($cndsEmitidas[0]->total == 0){			$estadosCnds['cndsEmitidasPorc'] =100;		}else{			$estadosCnds['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsNaoEmitidas[0]->total == 0){			$estadosCnds['cndsNaoEmitidasPorc'] =100;		}else{			$estadosCnds['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsPendentes[0]->total == 0){			$estadosCnds['cndsPendentesPorc'] =100;		}else{			$estadosCnds['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}	}elseif($tipo =='ESTADUAL'){		$cndsEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,1,$estado);		$estadosCnds['cndsEmitidas'] = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,3,$estado);		$estadosCnds['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,2,$estado);		$estadosCnds['cndsPendentes'] = $cndsPendentes[0]->total;		$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			$estadosCnds['totalCnds'] = $totalCnds;		if($cndsEmitidas[0]->total == 0){			$estadosCnds['cndsEmitidasPorc'] =100;		}else{			$estadosCnds['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsNaoEmitidas[0]->total == 0){			$estadosCnds['cndsNaoEmitidasPorc'] =100;		}else{			$estadosCnds['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsPendentes[0]->total == 0){			$estadosCnds['cndsPendentesPorc'] =100;		}else{			$estadosCnds['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}	}else{			$cndsEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,1,$estado);		$estadosCnds['cndsEmitidas'] = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,2,$estado);		$estadosCnds['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,3,$estado);		$estadosCnds['cndsPendentes'] = $cndsPendentes[0]->total;		$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			$estadosCnds['totalCnds'] = $totalCnds;		if($cndsEmitidas[0]->total == 0){			$estadosCnds['cndsEmitidasPorc'] =100;		}else{			$estadosCnds['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsNaoEmitidas[0]->total == 0){			$estadosCnds['cndsNaoEmitidasPorc'] =100;		}else{			$estadosCnds['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}		if($cndsPendentes[0]->total == 0){			$estadosCnds['cndsPendentesPorc'] =100;		}else{			$estadosCnds['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}	}		// else{		// $cndsEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,1,$estado);		// print_r($this->db->last_query());exit;		// $estadosCnds['cndsEmitidas'] = $cndsEmitidas[0]->total;		// $cndsNaoEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,3,$estado);		// $estadosCnds['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		// $cndsPendentes = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,2,$estado);		// $estadosCnds['cndsPendentes'] = $cndsPendentes[0]->total;		// $totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			// $estadosCnds['totalCnds'] = $totalCnds;		// if($cndsEmitidas[0]->total == 0){			// $estadosCnds['cndsEmitidasPorc'] =100;		// }else{			// $estadosCnds['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		// }		// if($cndsNaoEmitidas[0]->total == 0){			// $estadosCnds['cndsNaoEmitidasPorc'] =100;		// }else{			// $estadosCnds['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		// }		// if($cndsPendentes[0]->total == 0){			// $estadosCnds['cndsPendentesPorc'] =100;		// }else{			// $estadosCnds['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		// }			// }		echo json_encode($estadosCnds);			 }	  function mapa_geral(){	$this->logado();     $session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estados = $this->cnd_federal_model->listarEstados();		$data['primeiroTitulo'] = 'CNDs BRASIL - TOTAL';	$data['segundoTitulo'] = 'CNDs BRASIL - POR ESTADO';	$data['tipoCnd'] = 'BRASIL';		$data['cndsEmitidasMob'] =  $this->cnd_mobiliaria_model->contaCndMob($idContratante,1,'cnd_federal');		$data['cndsNaoEmitidasMob'] =  $this->cnd_mobiliaria_model->contaCndMob($idContratante,2,'cnd_federal');		$data['cndsPendentesMob'] =  $this->cnd_mobiliaria_model->contaCndMob($idContratante,3,'cnd_federal');			$totalCndsMob = $data['cndsEmitidasMob'][0]->total + $data['cndsNaoEmitidasMob'][0]->total +	 $data['cndsPendentesMob'][0]->total;		if($totalCndsMob== 0){		$data['cndsEmitidasMob'] = 0;		$data['cndsNaoEmitidasMob'] = 0;		$data['cndsPendentesMob'] = 0;	}else{		$data['cndsEmitidasMobPorc'] = round((($data['cndsEmitidasMob'][0]->total / $totalCndsMob) * 100),2);		$data['cndsNaoEmitidasMobPorc'] = round((($data['cndsNaoEmitidasMob'][0]->total / $totalCndsMob) * 100),2);		$data['cndsPendentesMobPorc'] = round((($data['cndsPendentesMob'][0]->total / $totalCndsMob) * 100),2);	}		$data['cndsEmitidasImob'] =  $this->cnd_imobiliaria_model->contaCndImob($idContratante,1,'cnd_federal');		$data['cndsNaoEmitidasImob'] =  $this->cnd_imobiliaria_model->contaCndImob($idContratante,2,'cnd_federal');		$data['cndsPendentesImob'] =  $this->cnd_imobiliaria_model->contaCndImob($idContratante,3,'cnd_federal');			$totalCndsImob = $data['cndsEmitidasImob'][0]->total + $data['cndsNaoEmitidasImob'][0]->total +	 $data['cndsPendentesImob'][0]->total;		if($totalCndsImob== 0){		$data['cndsEmitidasImob'] = 0;		$data['cndsNaoEmitidasImob'] = 0;		$data['cndsPendentesImob'] = 0;	}else{		$data['cndsEmitidasImobPorc'] = round((($data['cndsEmitidasImob'][0]->total / $totalCndsImob) * 100),2);		$data['cndsNaoEmitidasImobPorc'] = round((($data['cndsNaoEmitidasImob'][0]->total / $totalCndsImob) * 100),2);		$data['cndsPendentesImobPorc'] = round((($data['cndsPendentesImob'][0]->total / $totalCndsImob) * 100),2);	}	$data['cndsEmitidasEst'] =  $this->cnd_estadual_model->contaCndEstadual($idContratante,1,'cnd_federal');		$data['cndsNaoEmitidasEst'] =  $this->cnd_estadual_model->contaCndEstadual($idContratante,2,'cnd_federal');		$data['cndsPendentesEst'] =  $this->cnd_estadual_model->contaCndEstadual($idContratante,3,'cnd_federal');			$totalCndsEst = $data['cndsEmitidasEst'][0]->total + $data['cndsNaoEmitidasEst'][0]->total +	 $data['cndsPendentesEst'][0]->total;		if($totalCndsEst== 0){		$data['cndsEmitidasEst'] = 0;		$data['cndsNaoEmitidasEst'] = 0;		$data['cndsPendentesEst'] = 0;	}else{		$data['cndsEmitidasEstPorc'] = round((($data['cndsEmitidasEst'][0]->total / $totalCndsEst) * 100),2);		$data['cndsNaoEmitidasEstPorc'] = round((($data['cndsNaoEmitidasEst'][0]->total / $totalCndsEst) * 100),2);		$data['cndsPendentesEstPorc'] = round((($data['cndsPendentesEst'][0]->total / $totalCndsEst) * 100),2);	}		$data['cndsEmitidasFed'] =  $this->cnd_federal_model->contaCndFederal($idContratante,1,'cnd_federal');		$data['cndsNaoEmitidasFed'] =  $this->cnd_federal_model->contaCndFederal($idContratante,2,'cnd_federal');		$data['cndsPendentesFed'] =  $this->cnd_federal_model->contaCndFederal($idContratante,3,'cnd_federal');			$totalCndsFed = $data['cndsEmitidasFed'][0]->total + $data['cndsNaoEmitidasFed'][0]->total +	 $data['cndsPendentesFed'][0]->total;		if($totalCndsFed== 0){		$data['cndsEmitidasFed'] = 0;		$data['cndsNaoEmitidasFed'] = 0;		$data['cndsPendentesFed'] = 0;	}else{		$data['cndsEmitidasFedPorc'] = round((($data['cndsEmitidasFed'][0]->total / $totalCndsFed) * 100),2);		$data['cndsNaoEmitidasFedPorc'] = round((($data['cndsNaoEmitidasFed'][0]->total / $totalCndsFed) * 100),2);		$data['cndsPendentesFedPorc'] = round((($data['cndsPendentesFed'][0]->total / $totalCndsFed) * 100),2);	}		$i=1;	$estadosCnds = array();	foreach($estados as $est){				$cndsMobEmitidas = $cndsMobNaoEmitidas = $cndsMobPendentes = $totalCndsPorcMob=0;		$cndsImobEmitidas = $cndsImobNaoEmitidas = $cndsImobPendentes = $totalCndsPorcImob=0;		$cndsFedEmitidas = $cndsFedNaoEmitidas = $cndsFedPendentes = $totalCndsPorcFed=0;		$cndsEstEmitidas = $cndsEstNaoEmitidas = $cndsEstPendentes = $totalCndsPorcEst=0;				$estadosCnds[$i]['uf'] = $est->uf;				$cndsMobEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsMobEmitidas'] = $cndsMobEmitidas[0]->total;		$cndsMobNaoEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsMobNaoEmitidas'] = $cndsMobNaoEmitidas[0]->total;		$cndsMobPendentes = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,3,$est->uf);		$estadosCnds[$i]['cndsMobPendentes'] = $cndsMobPendentes[0]->total;				$totalMobCnds = $cndsMobEmitidas[0]->total + $cndsMobNaoEmitidas[0]->total + $cndsMobPendentes[0]->total; 			if($cndsMobEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorcMob'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorcMob'] = round((($cndsMobEmitidas[0]->total / $totalMobCnds ) * 100),2);		}				if($cndsMobNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorcMob'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorcMob'] = round((($cndsMobNaoEmitidas[0]->total / $totalMobCnds ) * 100),2);		}				if($cndsMobPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorcMob'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorcMob'] = round((($cndsMobPendentes[0]->total / $totalMobCnds ) * 100),2);		}				$cndsImobEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsImobEmitidas'] = $cndsImobEmitidas[0]->total;		$cndsImobNaoEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsImobNaoEmitidas'] = $cndsImobNaoEmitidas[0]->total;		$cndsImobPendentes = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,3,$est->uf);		$estadosCnds[$i]['cndsImobPendentes'] = $cndsImobPendentes[0]->total;				$totalImobCnds = $cndsImobEmitidas[0]->total + $cndsImobNaoEmitidas[0]->total + $cndsImobPendentes[0]->total; 			if($cndsImobEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorcImob'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorcImob'] = round((($cndsImobEmitidas[0]->total / $totalImobCnds ) * 100),2);		}				if($cndsImobNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorcImob'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorcImob'] = round((($cndsImobNaoEmitidas[0]->total / $totalImobCnds ) * 100),2);		}				if($cndsImobPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorcImob'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorcImob'] = round((($cndsImobPendentes[0]->total / $totalImobCnds ) * 100),2);		}				$cndsFedEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsFedEmitidas'] = $cndsFedEmitidas[0]->total;		$cndsFedNaoEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsFedNaoEmitidas'] = $cndsFedNaoEmitidas[0]->total;		$cndsFedPendentes = $this->cnd_federal_model->contaCndFederalByUf($idContratante,3,$est->uf);		$estadosCnds[$i]['cndsFedPendentes'] = $cndsFedPendentes[0]->total;				$totalFedCnds = $cndsFedEmitidas[0]->total + $cndsFedNaoEmitidas[0]->total + $cndsFedPendentes[0]->total; 			if($cndsFedEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorcFed'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorcFed'] = round((($cndsFedEmitidas[0]->total / $totalFedCnds ) * 100),2);		}				if($cndsFedNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorcFed'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorcFed'] = round((($cndsFedNaoEmitidas[0]->total / $totalFedCnds ) * 100),2);		}				if($cndsFedPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorcFed'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorcFed'] = round((($cndsFedPendentes[0]->total / $totalFedCnds ) * 100),2);		}				$cndsEstEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsEstEmitidas'] = $cndsEstEmitidas[0]->total;		$cndsEstNaoEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsEstNaoEmitidas'] = $cndsEstNaoEmitidas[0]->total;		$cndsEstPendentes = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,3,$est->uf);		$estadosCnds[$i]['cndsEstPendentes'] = $cndsEstPendentes[0]->total;				$totalEstCnds = $cndsEstEmitidas[0]->total + $cndsEstNaoEmitidas[0]->total + $cndsEstPendentes[0]->total; 			if($cndsEstEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorcEst'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorcEst'] = round((($cndsEstEmitidas[0]->total / $totalEstCnds ) * 100),2);		}				if($cndsEstNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorcEst'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorcEst'] = round((($cndsEstNaoEmitidas[0]->total / $totalEstCnds ) * 100),2);		}				if($cndsEstPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorcEst'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorcEst'] = round((($cndsEstPendentes[0]->total / $totalEstCnds ) * 100),2);		}				$i++;	}	$data['cndEstado'] = $estadosCnds;		$this->load->view('header_pages_view',$data);	$this->load->view('dados_mapa_geral_cnd', $data);	$this->load->view('footer_pages_view');    }   function cnd_est_criar(){	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$data['todas_lojas'] = $this->loja_model->listarTodasLojasSemCndEstadual($idContratante);	 	$data['perfil'] = $session_data['perfil'];		if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}		$this->load->view('header_pages_view',$data);    $this->load->view('cadastrar_cnd_est_view', $data);	$this->load->view('footer_pages_view');	 } function cadastrar_cnd_estadual(){	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$id_loja = $this->input->post('id_loja');		$insc = $this->input->post('insc');		$tipoCND = $this->input->post('tipoCND');		$dados = array('id_contratante' => $idContratante,					'id_loja' => $id_loja,					'inscricao' => $insc,					'tipo_cnd' => $tipoCND	);	$id = $this->cnd_estadual_model->add($dados);	//print_r($this->db->last_query());exit;	redirect('cnd_brasil/visao_interna_cnd_est?id='.$id, 'refresh');	 } function cnd_mob_mapa(){	$this->logado();     $session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estados = $this->cnd_federal_model->listarEstados();		$data['primeiroTitulo'] = 'CNDs ATIVAS - MAPA - BRASIL';	$data['segundoTitulo'] = 'STATUS - CND MOBILIÁRIA';	$data['terceiroTitulo'] = 'CNDs - STATUS - POR UF ';	$data['tipoCnd'] = 'MOBILIÁRIA';		$data['cndsEmitidas'] =  $this->cnd_mobiliaria_model->contaCndMob($idContratante,1,'cnd_mobiliaria');			$data['cndsNaoEmitidas'] =  $this->cnd_mobiliaria_model->contaCndMob($idContratante,2,'cnd_mobiliaria');			$data['cndsPendentes'] =  $this->cnd_mobiliaria_model->contaCndMob($idContratante,3,'cnd_mobiliaria');			$data['cndsIniciada'] =  $this->cnd_mobiliaria_model->contaCndMob($idContratante,4,'cnd_mobiliaria');			$totalCnds = $data['cndsIniciada'][0]->total + $data['cndsEmitidas'][0]->total + $data['cndsNaoEmitidas'][0]->total +	 $data['cndsPendentes'][0]->total;		if($totalCnds== 0){		$data['cndsEmitidas'] = 0;		$data['cndsNaoEmitidas'] = 0;		$data['cndsPendentes'] = 0;		$data['cndsIniciada'] = 0;	}else{		$data['cndsEmitidasPorc'] = round((($data['cndsEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsNaoEmitidasPorc'] = round((($data['cndsNaoEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsPendentesPorc'] = round((($data['cndsPendentes'][0]->total / $totalCnds) * 100),2);		$data['cndsIniciadaPorc'] = round((($data['cndsIniciada'][0]->total / $totalCnds) * 100),2);	}		$i=1;	$estadosCnds = array();	foreach($estados as $est){			$cndsIniciada = $cndsEmitidas = $cndsNaoEmitidas = $cndsPendentes = $totalCndsPorc=0;		$estadosCnds[$i]['uf'] = $est->uf;		$cndsEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsEmitidas'] = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,3,$est->uf);		$cndsIniciadas = $this->cnd_mobiliaria_model->contaCndMobByUf($idContratante,4,$est->uf);		$estadosCnds[$i]['cndsPendentes'] = $cndsPendentes[0]->total;		$estadosCnds[$i]['cndsIniciadas'] = $cndsIniciadas[0]->total;				$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total + $cndsIniciadas[0]->total; 			$estadosCnds[$i]['totalCnds'] = $totalCnds;		if($cndsEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorc'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}				if($cndsIniciadas[0]->total == 0){			$estadosCnds[$i]['cndsIniciadaPorc'] =100;		}else{			$estadosCnds[$i]['cndsIniciadaPorc'] = round((($cndsIniciadas[0]->total / $totalCnds ) * 100),2);		}		$i++;	}	$data['cndEstado'] = $estadosCnds;				$this->load->view('header_pages_view',$data);	$this->load->view('dados_mapa_cnd', $data);	$this->load->view('footer_pages_view');    }   function cnd_imob_mapa(){	$this->logado();     $session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estados = $this->cnd_federal_model->listarEstados();		$data['primeiroTitulo'] = 'CND IMOBILIÁRIA - BRASIL';	$data['segundoTitulo'] = 'STATUS - CND IMOBILIÁRIA POR UF';	$data['tipoCnd'] = 'IMOBILIÁRIA';		$data['cndsEmitidas'] =  $this->cnd_imobiliaria_model->contaCndImob($idContratante,1,'cnd_federal');		$data['cndsNaoEmitidas'] =  $this->cnd_imobiliaria_model->contaCndImob($idContratante,2,'cnd_federal');		$data['cndsPendentes'] =  $this->cnd_imobiliaria_model->contaCndImob($idContratante,3,'cnd_federal');			$totalCnds = $data['cndsEmitidas'][0]->total + $data['cndsNaoEmitidas'][0]->total +	 $data['cndsPendentes'][0]->total;		if($totalCnds== 0){		$data['cndsEmitidas'] = 0;		$data['cndsNaoEmitidas'] = 0;		$data['cndsPendentes'] = 0;	}else{		$data['cndsEmitidasPorc'] = round((($data['cndsEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsNaoEmitidasPorc'] = round((($data['cndsNaoEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsPendentesPorc'] = round((($data['cndsPendentes'][0]->total / $totalCnds) * 100),2);	}		$i=1;	$estadosCnds = array();	foreach($estados as $est){			$cndsEmitidas = $cndsNaoEmitidas = $cndsPendentes = $totalCndsPorc=0;		$estadosCnds[$i]['uf'] = $est->uf;		$cndsEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsEmitidas'] = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,3,$est->uf);		$estadosCnds[$i]['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_imobiliaria_model->contaCndImobByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsPendentes'] = $cndsPendentes[0]->total;				$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			$estadosCnds[$i]['totalCnds'] = $totalCnds;		if($cndsEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorc'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}				$i++;	}	$data['cndEstado'] = $estadosCnds;				$this->load->view('header_pages_view',$data);	$this->load->view('dados_mapa_cnd', $data);	$this->load->view('footer_pages_view');    }  function cnd_est_mapa(){	$this->logado();     $session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estados = $this->cnd_federal_model->listarEstados();		$data['primeiroTitulo'] = 'CNDs ATIVAS - MAPA - BRASIL';	$data['segundoTitulo'] = 'STATUS - CND ESTADUAL ';	$data['terceiroTitulo'] = 'CNDs - STATUS - POR UF ';	$data['tipoCnd'] = 'ESTADUAL';		$data['cndsEmitidas'] =  $this->cnd_estadual_model->contaCndEstadual($idContratante,1);		$data['cndsNaoEmitidas'] =  $this->cnd_estadual_model->contaCndEstadual($idContratante,3);		$data['cndsPendentes'] =  $this->cnd_estadual_model->contaCndEstadual($idContratante,2);				$totalCnds = $data['cndsEmitidas'][0]->total + $data['cndsNaoEmitidas'][0]->total +	 $data['cndsPendentes'][0]->total;		if($totalCnds== 0){		$data['cndsEmitidas'] = 0;		$data['cndsNaoEmitidas'] = 0;		$data['cndsPendentes'] = 0;	}else{		$data['cndsEmitidasPorc'] = round((($data['cndsEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsNaoEmitidasPorc'] = round((($data['cndsNaoEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsPendentesPorc'] = round((($data['cndsPendentes'][0]->total / $totalCnds) * 100),2);	}		$i=1;	$estadosCnds = array();	foreach($estados as $est){			$cndsEmitidas = $cndsNaoEmitidas = $cndsPendentes = $totalCndsPorc=0;		$estadosCnds[$i]['uf'] = $est->uf;		$cndsEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsEmitidas'] = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_estadual_model->contaCndEstadualByUf($idContratante,3,$est->uf);		$estadosCnds[$i]['cndsPendentes'] = $cndsPendentes[0]->total;				$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			$estadosCnds[$i]['totalCnds'] = $totalCnds;		if($cndsEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorc'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}				$i++;	}	$data['cndEstado'] = $estadosCnds;				$this->load->view('header_pages_view',$data);	$this->load->view('dados_mapa_cnd_est', $data);	$this->load->view('footer_pages_view');    }  function cnd_fed_mapa(){	$this->logado();     $session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$estados = $this->cnd_federal_model->listarEstados();		$data['primeiroTitulo'] = 'CNDs - MAPA - BRASIL';	$data['segundoTitulo'] = 'STATUS - CND FEDERAL ';	$data['terceiroTitulo'] = 'CNDs - STATUS - POR UF ';	$data['tipoCnd'] = 'FEDERAL';		$data['cndsEmitidas'] =  $this->cnd_federal_model->contaCndFederal($idContratante,1,'cnd_federal');		$data['cndsNaoEmitidas'] =  $this->cnd_federal_model->contaCndFederal($idContratante,2,'cnd_federal');		$data['cndsPendentes'] =  $this->cnd_federal_model->contaCndFederal($idContratante,3,'cnd_federal');			$totalCnds = $data['cndsEmitidas'][0]->total + $data['cndsNaoEmitidas'][0]->total +	 $data['cndsPendentes'][0]->total;		if($totalCnds== 0){		$data['cndsEmitidas'] = 0;		$data['cndsNaoEmitidas'] = 0;		$data['cndsPendentes'] = 0;	}else{		$data['cndsEmitidasPorc'] = round((($data['cndsEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsNaoEmitidasPorc'] = round((($data['cndsNaoEmitidas'][0]->total / $totalCnds) * 100),2);		$data['cndsPendentesPorc'] = round((($data['cndsPendentes'][0]->total / $totalCnds) * 100),2);	}		$i=1;	$estadosCnds = array();	foreach($estados as $est){			$cndsEmitidas = $cndsNaoEmitidas = $cndsPendentes = $totalCndsPorc=0;		$estadosCnds[$i]['uf'] = $est->uf;		$cndsEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,1,$est->uf);		$estadosCnds[$i]['cndsEmitidas'] = $cndsEmitidas[0]->total;		$cndsNaoEmitidas = $this->cnd_federal_model->contaCndFederalByUf($idContratante,2,$est->uf);		$estadosCnds[$i]['cndsNaoEmitidas'] = $cndsNaoEmitidas[0]->total;		$cndsPendentes = $this->cnd_federal_model->contaCndFederalByUf($idContratante,3,$est->uf);		$estadosCnds[$i]['cndsPendentes'] = $cndsPendentes[0]->total;				$totalCnds = $cndsEmitidas[0]->total + $cndsNaoEmitidas[0]->total + $cndsPendentes[0]->total; 			$estadosCnds[$i]['totalCnds'] = $totalCnds;		if($cndsEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsEmitidasPorc'] = round((($cndsEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsNaoEmitidas[0]->total == 0){			$estadosCnds[$i]['cndsNaoEmitidasPorc'] =100;		}else{			$estadosCnds[$i]['cndsNaoEmitidasPorc'] = round((($cndsNaoEmitidas[0]->total / $totalCnds ) * 100),2);		}				if($cndsPendentes[0]->total == 0){			$estadosCnds[$i]['cndsPendentesPorc'] =100;		}else{			$estadosCnds[$i]['cndsPendentesPorc'] = round((($cndsPendentes[0]->total / $totalCnds ) * 100),2);		}				$i++;	}	$data['cndEstado'] = $estadosCnds;				$this->load->view('header_pages_view',$data);	$this->load->view('dados_mapa_cnd', $data);	$this->load->view('footer_pages_view');    }   function mapa(){	$this->logado();	  	$session_data = $_SESSION['loginTeste'];    $data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];     	$this->load->view('header_pages_view',$data);	$this->load->view('dados_agrupados_cnd_brasil', $data);	$this->load->view('footer_pages_view');	 }
  function cnd_estadual_mapa(){	$this->logado();  	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Estadual - Brasil';	$data['tipo_cnd'] = 'Estadual ';	$idContratante = $session_data['id_contratante'];		$emitidas = count($this->cnd_estadual_model->listarCnd($idContratante,1));	$nEmitidas = $this->cnd_estadual_model->listarCnd($idContratante,2);	$pendentes = $this->cnd_estadual_model->listarCnd($idContratante,3);		$this->load->view('header_pages_view',$data);	$this->load->view('dados_agrupados_cnds', $data);	$this->load->view('footer_pages_view');       }  function cnd_imobiliaria_lista(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Estadual - Brasil';	$data['tipo_cnd'] = 'Estadual';	$idContratante = $session_data['id_contratante'];		if(empty($_POST)){		$data['imovelExp'] = 0;		$data['cnpjExp'] = 0;		$data['estadoExp'] = 0;					$data['inscricaoExp'] = 0;		$data['statusExp'] = 0;		$data['data_vencto_ini_exp'] = 0;		$data['data_vencto_final_exp'] = 0;		$data['iptus'] = $this->cnd_imobiliaria_model->listarCndTodos($idContratante);	}else{					$data['imovelExp'] = $imovelExp=$_POST['imovel'];		$data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpj'];		$data['estadoExp'] = $estadoExp = $_POST['estado'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricao'];		$data['statusExp'] = $statusExp=$status = $_POST['status'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['dataVenctoIni'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['dataVenctoFinal'];			$data['iptus'] = $this->cnd_imobiliaria_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp);	}	$data['estados'] = $this->cnd_imobiliaria_model->listarEstados($idContratante);	$data['cnpj'] = $this->cnd_imobiliaria_model->listarCnpj($idContratante);		$data['imoveis'] = $this->cnd_imobiliaria_model->listarImoveis($idContratante);	$data['inscricoes'] = $this->cnd_imobiliaria_model->listarInscricao($idContratante);		$this->load->view('header_pages_view',$data);	$this->load->view('listar_cnd_imob_view', $data);	$this->load->view('footer_pages_view');	  }   function cnd_fed_lista(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Estadual - Brasil';	$data['tipo_cnd'] = 'Estadual';	$idContratante = $session_data['id_contratante'];		if(empty($_POST)){		$data['imovelExp'] = 0;		$data['cnpjExp'] = 0;		$data['estadoExp'] = 0;					$data['inscricaoExp'] = 0;		$data['statusExp'] = 0;		$data['data_vencto_ini_exp'] = 0;		$data['data_vencto_final_exp'] = 0;		$data['iptus'] = $this->cnd_federal_model->listarCnd($idContratante);	}else{					$data['imovelExp'] = $imovelExp=$_POST['imovel'];		$data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpj'];		$data['estadoExp'] = $estadoExp = $_POST['estado'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricao'];		$data['statusExp'] = $statusExp=$status = $_POST['status'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['dataVenctoIni'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['dataVenctoFinal'];			$data['iptus'] = $this->cnd_federal_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp);	}	$data['estados'] = $this->cnd_federal_model->listarEstado($idContratante);	$data['cnpj'] = $this->cnd_federal_model->listarCnpj($idContratante);		$data['imoveis'] = $this->cnd_federal_model->listarImovel($idContratante);	$data['inscricoes'] = $this->cnd_federal_model->listarInscricao($idContratante);		if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}		$this->load->view('header_pages_view',$data);	$this->load->view('listar_cnd_fed_view', $data);	$this->load->view('footer_pages_view');	  }  function cnd_est_lista_inativa(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Estadual - Inativas';	$data['tipo_cnd'] = 'Estadual';	$data['ativo'] = '1';	$data['controler'] = 'cnd_est_lista_inativa';	$idContratante = $session_data['id_contratante'];			if(empty($_POST)){				if(empty($_SESSION['imovelExp'])){			$imovelExp =$data['imovelExp'] = 0;		}else{			$imovelExp =$data['imovelExp'] =  $_SESSION['imovelExp'];		}						if(empty($_SESSION['estadoExp'])){			$estadoExp =$data['estadoExp'] = 0;		}else{			$estadoExp =$data['estadoExp'] =  $_SESSION['estadoExp'];		}				if(empty($_SESSION['cnpjExp'])){			$cnpjExp =$data['cnpjExp'] = 0;		}else{			$cnpjExp =$data['cnpjExp'] =  $_SESSION['cnpjExp'];		}				if(empty($_SESSION['cidadeExp'])){			$cidadeExp =$data['cidadeExp'] = 0;		}else{			$cidadeExp =$data['cidadeExp'] =  $_SESSION['cidadeExp'];		}		$inscricaoExp=$data['inscricaoExp'] = 0;		$statusExp=$data['statusExp'] = 0;		$data_vencto_ini_exp=$data['data_vencto_ini_exp'] = 0;		$data_vencto_final_exp=$data['data_vencto_final_exp'] = 0;		//$data['iptus'] = $this->cnd_estadual_model->listarCnd($idContratante,'X');		$data['iptus'] = $this->cnd_estadual_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,1,$cidadeExp);		//print_r($this->db->last_query());exit;	}else{					$_SESSION['imovelExp'] = $data['imovelExp'] = $imovelExp=$_POST['imovel'];		$_SESSION['cnpjExp'] = $data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpj'];		$_SESSION['estadoExp'] = $data['estadoExp'] = $estadoExp = $_POST['estado'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricao'];		$data['statusExp'] = $statusExp=$status = $_POST['status'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['dataVenctoIni'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['dataVenctoFinal'];		$_SESSION['cidadeExp'] = $data['cidadeExp'] = $cidadeExp = $_POST['cidade'];			$data['iptus'] = $this->cnd_estadual_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,1,$cidadeExp);		//print_r($this->db->last_query());exit;	}	$data['estados'] = $this->cnd_estadual_model->listarEstado($idContratante,'X',0);		$data['cidades'] = $this->cnd_estadual_model->listarCidade($idContratante,'X',0);		$data['cnpj'] = $this->cnd_estadual_model->listarCnpj($idContratante,'X',0);			$data['imoveis'] = $this->cnd_estadual_model->listarImovel($idContratante,0);		$data['inscricoes'] = $this->cnd_estadual_model->listarInscricao($idContratante,0);			$this->load->view('header_pages_view',$data);	$this->load->view('listar_cnd_est_view', $data);	$this->load->view('footer_pages_view');	  }  function cnd_est_lista(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Estadual - Ativas';	$data['tipo_cnd'] = 'Estadual';	$data['status'] = '0';	$data['ativo'] = '0';	$data['controler'] = 'cnd_est_lista';	$idContratante = $session_data['id_contratante'];			if(empty($_POST)){				if(empty($_SESSION['imovelExp'])){			$imovelExp =$data['imovelExp'] = 0;		}else{			$imovelExp =$data['imovelExp'] =  $_SESSION['imovelExp'];		}						if(empty($_SESSION['estadoExp'])){			$estadoExp =$data['estadoExp'] = 0;		}else{			$estadoExp =$data['estadoExp'] =  $_SESSION['estadoExp'];		}				if(empty($_SESSION['estadoExp'])){			$estadoExp =$data['estadoExp'] = 0;		}else{			$estadoExp =$data['estadoExp'] =  $_SESSION['estadoExp'];		}				if(empty($_SESSION['cnpjExp'])){			$cnpjExp =$data['cnpjExp'] = 0;		}else{			$cnpjExp =$data['cnpjExp'] =  $_SESSION['cnpjExp'];		}				if(empty($_SESSION['cidadeExp'])){			$cidadeExp =$data['cidadeExp'] = 0;		}else{			$cidadeExp =$data['cidadeExp'] =  $_SESSION['cidadeExp'];		}		$inscricaoExp=$data['inscricaoExp'] = 0;		$statusExp=$data['statusExp'] = 0;		$data_vencto_ini_exp=$data['data_vencto_ini_exp'] = 0;		$data_vencto_final_exp=$data['data_vencto_final_exp'] = 0;		//$data['iptus'] = $this->cnd_estadual_model->listarCnd($idContratante,'X');		$data['iptus'] = $this->cnd_estadual_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,0,$cidadeExp);		//print_r($this->db->last_query());exit;	}else{					$_SESSION['imovelExp'] = $data['imovelExp'] = $imovelExp=$_POST['imovel'];		$_SESSION['cnpjExp'] = $data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpj'];		$_SESSION['estadoExp'] = $data['estadoExp'] = $estadoExp = $_POST['estado'];		$_SESSION['cidadeExp'] = $data['cidadeExp'] = $cidadeExp = $_POST['cidade'];				$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricao'];		$data['statusExp'] = $statusExp=$status = $_POST['status'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['dataVenctoIni'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['dataVenctoFinal'];			$data['iptus'] = $this->cnd_estadual_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,0,$cidadeExp);		//print_r($this->db->last_query());exit;	}	$data['estados'] = $this->cnd_estadual_model->listarEstado($idContratante,'X',0);		$data['cidades'] = $this->cnd_estadual_model->listarCidade($idContratante,'X',0);		$data['cnpj'] = $this->cnd_estadual_model->listarCnpj($idContratante,'X',0);			$data['imoveis'] = $this->cnd_estadual_model->listarImovel($idContratante,0);		$data['inscricoes'] = $this->cnd_estadual_model->listarInscricao($idContratante,0);				$this->load->view('header_pages_view',$data);	$this->load->view('listar_cnd_est_view', $data);	$this->load->view('footer_pages_view');	  }  function cnd_lista_inativa(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];		if($_SESSION['loginTeste']['tipo_cnd'] == 2){  		$data['nome_cnd'] = 'CND Estadual - Inativas';		$data['tipo_cnd'] = 'Estadual ';	 }elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		$data['nome_cnd'] = 'CND Mobiliária - Inativas';		$data['tipo_cnd'] = 'Mobiliária ';	 }else{		$data['nome_cnd'] = 'CND Federal - Inativas';		$data['tipo_cnd'] = 'Federal ';			 }		 	$data['controller'] = 'cnd_lista_inativa';	$data['ativo'] = '1';	$idContratante = $session_data['id_contratante'];		if(empty($_POST)){						if(empty($_SESSION['imovelExp'])){			$imovelExp =$data['imovelExp'] = 0;		}else{			$imovelExp =$data['imovelExp'] =  $_SESSION['imovelExp'];		}				if(empty($_SESSION['cidadeExp'])){			$cidadeExp =$data['cidadeExp'] = 0;		}else{			$cidadeExp =$data['cidadeExp'] =  $_SESSION['cidadeExp'];		}				if(empty($_SESSION['estadoExp'])){			$estadoExp =$data['estadoExp'] = 0;		}else{			$estadoExp =$data['estadoExp'] =  $_SESSION['estadoExp'];		}				$cnpjExp = $data['cnpjExp'] = 0;		$inscricaoExp=$data['inscricaoExp'] = 0;		$statusExp= $data['statusExp'] = 0;		$data_vencto_final_exp=$data['data_vencto_ini_exp'] = 0;		$data_vencto_ini_exp=$data['data_vencto_final_exp'] = 0;			$data['iptus'] = $this->cnd_mobiliaria_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cidadeExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,1);		//$data['iptus'] = $this->cnd_mobiliaria_model->listarCndTodos($idContratante,0);	}else{					$_SESSION['imovelExp'] =  $data['imovelExp'] = $imovelExp=$_POST['imovel'];		$_SESSION['cnpjExp'] = $data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpj'];		$_SESSION['estadoExp'] = $data['estadoExp'] = $estadoExp = $_POST['estado'];		$_SESSION['cidadeExp'] = $data['cidadeExp'] = $cidadeExp = $_POST['cidade'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricao'];		$data['statusExp'] = $statusExp=$status = $_POST['status'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['dataVenctoIni'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['dataVenctoFinal'];			$data['iptus'] = $this->cnd_mobiliaria_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cidadeExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,1);	}		$data['statusCnd'] = 2;		$data['estados'] = $this->cnd_mobiliaria_model->listarEstado($idContratante,'X',2);		$data['cnpj'] = $this->cnd_mobiliaria_model->listarCnpj($idContratante,2);		$data['imoveis'] = $this->cnd_mobiliaria_model->listarCndTodos($idContratante,2);		$data['inscricoes'] = $this->cnd_mobiliaria_model->listarInscricao($idContratante,2);			if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}	$data['adm'] = $session_data['adm'];		$this->load->view('header_pages_view',$data);	$this->load->view('listar_cnd_mob_view', $data);	$this->load->view('footer_pages_view');	  } function limpar_filtro(){	 $this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Mobiliária - Ativas';	$data['tipo_cnd'] = 'Mobiliária ';	$data['controller'] = 'cnd_mobiliaria_lista';	$idContratante = $session_data['id_contratante'];	$data['ativo'] = 0;		$_SESSION['imovelExp'] = $data['imovelExp'] = 0;	$_SESSION['cidadeExp'] =$data['cidadeExp'] = 0;	$_SESSION['estadoExp'] =$data['estadoExp'] = 0;	$data['cnpjExp'] = 0;	$data['inscricaoExp'] = 0;	$data['status'] = 0;	$data['data_vencto_ini_exp'] = 0;	$data['data_vencto_final_exp'] = 0;		redirect('cnd_brasil/cnd_lista', 'refresh'); }	   function buscarCnpjByPendencia(){		$pendencia = $this->input->get('pendencia');	$estado = $this->input->get('estado');		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];			$retorno ='';	$result = $this->cnd_mobiliaria_model->listarCndPendenciaEstado($idContratante,$pendencia,$estado);		$isArray =  is_array($result) ? '1' : '0';		if($isArray == 0){		$retorno .="<option value='0'>Não Há Dados</option>";	}else{			$retorno .="<option value=0>Escolha um cnpj</option>";		foreach($result as $imovel){ 			 			$retorno .="<option value='".$imovel->cpf_cnpj."'>".$imovel->cpf_cnpj."</option>";		 		}		}		echo json_encode($retorno);			 }   function buscarCnpjByUf(){		$estado = $this->input->get('estado');		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];			$retorno ='';	$result = $this->cnd_mobiliaria_model->listarCnpjPendencia($idContratante,$estado);		$isArray =  is_array($result) ? '1' : '0';		if($isArray == 0){		$retorno .="<option value='0'>Não Há Dados</option>";	}else{			$retorno .="<option value=0>Escolha um cnpj</option>";		foreach($result as $imovel){ 			 			$retorno .="<option value='".$imovel->cpf_cnpj."'>".$imovel->cpf_cnpj."</option>";		 		}		}		echo json_encode($retorno);			 }  function buscarPendenciaByCnpj(){		$cnpj = $this->input->get('cnpj');		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];			$retorno ='';	$result = $this->cnd_mobiliaria_model->listarPendenciaByCnpj($idContratante,$cnpj);		$isArray =  is_array($result) ? '1' : '0';		if($isArray == 0){		$retorno .="<option value='0'>Não Há Dados</option>";	}else{			foreach($result as $imovel){ 			 			$retorno .="<option value='".$imovel->codigo."'>".$imovel->descricao_natureza_raiz."</option>";		 		}		}		echo json_encode($retorno);			 }   function buscarUfByPendencia(){		$pendencia = $this->input->get('pendencia');		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];			$retorno ='';	$result = $this->cnd_mobiliaria_model->listarCndPendencia($idContratante,$pendencia,0);		$isArray =  is_array($result) ? '1' : '0';		if($isArray == 0){		$retorno .="<option value='0'>Não Há Dados</option>";	}else{			$retorno .="<option value=0>Escolha um estado</option>";		foreach($result as $imovel){ 			 			$retorno .="<option value='".$imovel->estado."'>".$imovel->estado."</option>";		 		}		}		echo json_encode($retorno);			 } function listar_chamados(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Mobiliária - Lista de Chamados';	$data['tipo_cnd'] = 'Mobiliária ';	$data['controller'] = 'listar_pendencia';	$idContratante = $session_data['id_contratante'];	$data['chamados'] = $this->cnd_mobiliaria_model->listarChamados($idContratante);	$this->load->view('header_pages_view',$data);	$this->load->view('listar_chamados_view', $data);	$this->load->view('footer_pages_view');	 }	 function listar_pendencia(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];		$data['nome_cnd'] = 'CND Mobiliária - Pendências';	$data['tipo_cnd'] = 'Mobiliária ';		if($_SESSION['loginTeste']['tipo_cnd'] == 2){		$data['tipo_cnd'] = 'Estadual ';		$data['nome_cnd'] = 'CND Estadual - Ativas';	}elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		$data['tipo_cnd'] = 'Mobiliária ';		$data['nome_cnd'] = 'CND Mobiliária - Ativas';	}else{		$data['tipo_cnd'] = 'Federal ';		$data['nome_cnd'] = 'CND Federal - Ativas';	}			$data['controller'] = 'listar_pendencia';	$idContratante = $session_data['id_contratante'];	$data['ativo'] = 0;	if(empty($_REQUEST)){		$data['iptus'] = $this->cnd_mobiliaria_model->listarCndPendencia($idContratante,1,0,0,1,0);			}else{		if(empty($_REQUEST['cnpj'])){			$cnpj = 0;		}else{			$cnpj=$_REQUEST['cnpj'];			}								if(empty($_REQUEST['pendencia'])){			$pendencia = 1;		}else{			$pendencia=$_REQUEST['pendencia'];			}				if(empty($_REQUEST['estado'])){			$estado = 0;		}else{			$estado=$_REQUEST['estado'];			}				if(empty($_REQUEST['area_focal'])){			$area_focal=1;		}else{			$area_focal=$_REQUEST['area_focal'];		}		if(empty($_REQUEST['valorPendencia'])){			$valor_pendencia=0;		}else{			$valor_pendencia=$_REQUEST['valorPendencia'];						$valor_pendencia=str_replace(',','.',$valor_pendencia);		}				$data['iptus'] = $this->cnd_mobiliaria_model->listarCndPendencia($idContratante,$pendencia,$cnpj,$estado,$area_focal,$valor_pendencia);	}		if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}	$data['area_focal'] = $this->cnd_mobiliaria_model->listarAreaFocal();	$data['estados'] = $this->cnd_mobiliaria_model->listarEstado($idContratante,'X',1);		$data['cnpj'] = $this->cnd_mobiliaria_model->listarCnpj($idContratante,1);		$data['natureza_raiz'] = $this->cnd_mobiliaria_model->listarNaturezaRaiz();	$this->load->view('header_pages_view',$data);	$this->load->view('listar_pendencia_view', $data);	$this->load->view('footer_pages_view');	  }  function dash_area_focal(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$data['nome_cnd'] = 'CND Mobiliária - Pendências';	$data['tipo_cnd'] = 'Mobiliária ';	$data['controller'] = 'listar_pendencia';	$idContratante = $session_data['id_contratante'];	$data['ativo'] = 0;	$resultAreaFocal = $this->cnd_mobiliaria_model->contarAreaFocal($idContratante);	$stringAreaFocal = '';	$dadosAreaFocal ='';	$cores ='';	if($resultAreaFocal <> 0){		foreach($resultAreaFocal as $res){			$cores .= '"'.$res->cor.'",';			$stringAreaFocal .= '"'.$res->descricao_area_focal.'",';			$dadosAreaFocal .= "'$res->total',";					}	}						 		$data['stringAreaFocal'] =$stringAreaFocal;	$data['dadosAreaFocal'] =$dadosAreaFocal;	$data['cores'] =$cores;	$data['dadosAreaFocal'] =$resultAreaFocal;	if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}		$this->load->view('header_pages_view',$data);	$this->load->view('dashboard_area_view', $data);	$this->load->view('footer_pages_view');	  }  function cnd_lista(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];			$data['controller'] = 'cnd_lista';	$idContratante = $session_data['id_contratante'];	$data['ativo'] = 0;		if($_SESSION['loginTeste']['tipo_cnd'] == 2){		$data['tipo_cnd'] = 'Estadual ';		$data['nome_cnd'] = 'CND Estadual - Ativas';	}elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		$data['tipo_cnd'] = 'Mobiliária ';		$data['nome_cnd'] = 'CND Mobiliária - Ativas';	}else{		$data['tipo_cnd'] = 'Federal ';		$data['nome_cnd'] = 'CND Federal - Ativas';	}		if(empty($_POST)){						if(empty($_SESSION['imovelExp'])){			$imovelExp =$data['imovelExp'] = 0;		}else{			$imovelExp =$data['imovelExp'] =  $_SESSION['imovelExp'];		}				if(empty($_SESSION['cidadeExp'])){			$cidadeExp =$data['cidadeExp'] = 0;		}else{			$cidadeExp =$data['cidadeExp'] =  $_SESSION['cidadeExp'];		}				if(empty($_SESSION['estadoExp'])){			$estadoExp =$data['estadoExp'] = 0;		}else{			$estadoExp =$data['estadoExp'] =  $_SESSION['estadoExp'];		}				$cnpjExp = $data['cnpjExp'] = 0;		$inscricaoExp=$data['inscricaoExp'] = 0;		$statusExp= $data['statusExp'] = 0;		$data_vencto_final_exp=$data['data_vencto_ini_exp'] = 0;		$data_vencto_ini_exp=$data['data_vencto_final_exp'] = 0;			$data['iptus'] = $this->cnd_mobiliaria_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cidadeExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,0);		//$data['iptus'] = $this->cnd_mobiliaria_model->listarCndTodos($idContratante,0);	}else{					$_SESSION['imovelExp'] =  $data['imovelExp'] = $imovelExp=$_POST['imovel'];		$_SESSION['cnpjExp'] = $data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpj'];		$_SESSION['estadoExp'] = $data['estadoExp'] = $estadoExp = $_POST['estado'];		$_SESSION['cidadeExp'] = $data['cidadeExp'] = $cidadeExp = $_POST['cidade'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricao'];		$data['statusExp'] = $statusExp= $_POST['status'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['dataVenctoIni'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['dataVenctoFinal'];			$data['iptus'] = $this->cnd_mobiliaria_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cidadeExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,0);	}	$data['statusCnd'] = 1;		$data['estados'] = $this->cnd_mobiliaria_model->listarEstado($idContratante,'X',1);		$data['cidades'] = $this->cnd_mobiliaria_model->listarCidade($idContratante,'X',1);		$data['cnpj'] = $this->cnd_mobiliaria_model->listarCnpj($idContratante,1);		$data['imoveis'] = $this->cnd_mobiliaria_model->listarCndTodos($idContratante,1);		$data['inscricoes'] = $this->cnd_mobiliaria_model->listarInscricao($idContratante,1);			if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}	$data['adm'] = $session_data['adm'];		$this->load->view('header_pages_view',$data);	$this->load->view('listar_cnd_mob_view', $data);	$this->load->view('footer_pages_view');	  }   function buscaLojaByCidade(){		$id = $this->input->get('id');	$estado = $this->input->get('estado');		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];			$retorno ='';	$result = $this->loja_model->buscaLojaByCidadeEstadoFiltro($idContratante,$id);		$isArray =  is_array($result) ? '1' : '0';		if($isArray == 0){		$retorno .="<option value='0'>Não Há Dados</option>";	}else{			$retorno .="<option value=0>Escolha uma Loja</option>";		foreach($result as $imovel){ 			 			$retorno .="<option value='".$imovel->id_loja."'>".$imovel->razao_social."</option>";		 		}		}		echo json_encode($retorno);			 }   function export_cnd_mob(){	 	  $this->logado();	  		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$data['ativo'] = $ativo=$_POST['ativo'];	if(empty($_POST)){				$result = $this->cnd_mobiliaria_model->listarCndTodos($idContratante,$ativo);				$statusCnd=1;	}else{					$data['statusCnd'] = $statusCnd=$_POST['statusCnd'];		$data['imovelExp'] = $imovelExp=$_POST['imovelExp'];		$data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpjExp'];		$data['estadoExp'] = $estadoExp = $_POST['estadoExp'];		$data['cidadeExp'] = $cidadeExp = $_POST['cidadeExp'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricaoExp'];		$data['statusExp'] = $statusExp=$status = $_POST['statusExp'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['data_vencto_ini_exp'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['data_vencto_final_exp'];						$result = $this->cnd_mobiliaria_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cidadeExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,$ativo);					}			$this->csv_cnd_mob($result,$statusCnd);	 }   function export_cnd_imob(){	 	  $this->logado();		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST)){		$result = $this->cnd_imobiliaria_model->listarCndTodos($idContratante);	}else{		$data['imovelExp'] = $imovelExp=$_POST['imovelExp'];		$data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpjExp'];		$data['estadoExp'] = $estadoExp = $_POST['estadoExp'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricaoExp'];		$data['statusExp'] = $statusExp=$status = $_POST['statusExp'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['data_vencto_ini_exp'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['data_vencto_final_exp'];						$result = $this->cnd_imobiliaria_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp);	}			$this->csv_cnd_imob($result); }  function export_cnd_est_total(){	 	  $this->logado();		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST)){		$result = $this->cnd_estadual_model->listarCnd($idContratante);		//print_r($this->db->last_query());exit;			}else{		$data['imovelExp'] = $imovelExp=$_POST['imovelExp'];		$data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpjExp'];		$data['estadoExp'] = $estadoExp = $_POST['estadoExp'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricaoExp'];		$data['statusExp'] = $statusExp=$status = $_POST['statusExp'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['data_vencto_ini_exp'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['data_vencto_final_exp'];		$data['ativo'] = $ativo= $_POST['ativo'];					$cidadeExp =$data['cidadeExp'] =  $_SESSION['cidadeExp']  = $_POST['cidadeExp'];						$result = $this->cnd_estadual_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,$ativo,$cidadeExp);		//print_r($this->db->last_query());exit;	}			$this->csv_cnd_est_total($result,$ativo); }  function export_cnd_est(){	 	  $this->logado();		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST)){		$result = $this->cnd_estadual_model->listarCnd($idContratante);		//print_r($this->db->last_query());exit;			}else{		$data['imovelExp'] = $imovelExp=$_POST['imovelExp'];		$data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpjExp'];		$data['estadoExp'] = $estadoExp = $_POST['estadoExp'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricaoExp'];		$data['statusExp'] = $statusExp=$status = $_POST['statusExp'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['data_vencto_ini_exp'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['data_vencto_final_exp'];		$data['ativo'] = $ativo= $_POST['ativo'];					$cidadeExp =$data['cidadeExp'] =  $_SESSION['cidadeExp']  = $_POST['cidadeExp'];						$result = $this->cnd_estadual_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp,$ativo,$cidadeExp);		//print_r($this->db->last_query());exit;	}			$this->csv_cnd_est($result,$ativo); }  function export_cnd_fed(){	 	  $this->logado();		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST)){		$result = $this->cnd_federal_model->listarCnd($idContratante);	}else{		$data['imovelExp'] = $imovelExp=$_POST['imovelExp'];		$data['cnpjExp'] = $cnpjExp=$cnpj = $_POST['cnpjExp'];		$data['estadoExp'] = $estadoExp = $_POST['estadoExp'];		$data['inscricaoExp'] = $inscricaoExp=$inscricao = $_POST['inscricaoExp'];		$data['statusExp'] = $statusExp=$status = $_POST['statusExp'];			$data['data_vencto_ini_exp'] = $data_vencto_ini_exp=$dataVenctoIni = $_POST['data_vencto_ini_exp'];		$data['data_vencto_final_exp'] =  $data_vencto_final_exp= $dataVenctoFinal = $_POST['data_vencto_final_exp'];						$result = $this->cnd_federal_model->listarCndTodosComFiltro($idContratante,$imovelExp,$estadoExp,$cnpjExp,$inscricaoExp,$statusExp,$data_vencto_final_exp,$data_vencto_ini_exp);	}			$this->csv_cnd_fed($result); }  function csv_cnd_fed($result){	$file="cnd_federal.xls";	if($result == 0){			$test="<table border=1>		<tr>		<td>N&atilde;o H&aacute; Dados Para Esse Filtro</td>		</tr>		";		$test .='</table>';    }else{				$test="<table border=1>			<tr>						<td>Im&oacute;vel</td>			<td>CNPJ</td>			<td>UF</td>			<td>Inscri&ccedil;&atilde;o</td>			<td>Status</td>			<td>Data Vecto</td>						</tr>			";			foreach($result as $key => $iptu){ 		  								if($iptu->possui_cnd == 1){															$status ='Emitida';								$dataDivArr = explode("-",$iptu->data_vencto);						$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];				}elseif($iptu->possui_cnd == 2){						$status ='Não Tratada';																$dataDivArr = explode("-",$iptu->data_vencto);						$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];					}else{					$status ='Não Tratada';																$dataDivArr = explode("-",$iptu->data_pendencias);						$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];					}																$test .= "<tr >";				$test .= "<td>".utf8_decode($iptu->nome)."</td>";				$test .= "<td>".utf8_decode($iptu->cpf_cnpj)."</td>";				$test .= "<td>".utf8_decode($iptu->estado)."</td>";				$test .= "<td>'".utf8_decode($iptu->ins_cnd_mob)."'</td>";				$test .= "<td>".utf8_decode($status)."</td>";				$test .= "<td>".utf8_decode($dataDiv)."</td>";								$test .= "</tr>";										}			$test .='</table>';		}			header("Content-type: application/vnd.ms-excel");		header("Content-Disposition: attachment; filename=$file");		echo $test;	 } function csv_cnd_est($result,$ativo){	if($ativo == 0){		$file="export_base_por_inscricao_excel_ativas.xls";	}else{		$file="export_base_por_inscricao_excel_inativas.xls";	}		if($result == 0){			$test="<table border=1>		<tr>		<td>N&atilde;o H&aacute; Dados Para Esse Filtro</td>		</tr>		";		$test .='</table>';    }else{						$test="<table border=1>			<tr>						<td >Loja (Nome Fantasia)</td>			<td >CPF/CNPJ</td>			<td >CIDADE</td>			<td >UF</td>									<td >REGIONAL</td>			<td >BANDEIRA</td>			<td >Status CNPJ</td>			<td >Inscri&ccedil;&atilde;o</td>						<td >Tipo CND</td>				<td >Status CND</td>			<td >Data Emiss&atilde;o - CND</td>				<td >Data Vencto - CND</td>				<td >Observa&ccedil;&atilde;o CND</td>									<td >Data Pend&ecirc;ncia / Extrato</td>				<td >Observa&ccedil;&atilde;o Extrato</td>					<td >&Uacute;ltimo Usu&aacute;rio</td>						<td >Data Altera&ccedil;&atilde;o</td>														</tr>			";			foreach($result as $key => $iptu){ 		  								$tratativas = $this->cnd_estadual_model->buscarTratativasEst($iptu->id_cnd);	;									if($iptu->possui_cnd == 1){															$status ='Emitida';												}elseif($iptu->possui_cnd == 2){						$status ='Não Tratada';															}else{					$status ='Pendência';																				}				if(empty($iptu->data_alteracao)){					$dataAlteracao = '00-00-0000';				}else{					$dataAlteracaoArr = explode("-",$iptu->data_alteracao);						$dataAlteracao = $dataAlteracaoArr[2].'-'.$dataAlteracaoArr[1].'-'.$dataAlteracaoArr[0];				}								if($iptu->tipo_cnd == 1){															$tipoCnd ='Coletiva';							}else{					$tipoCnd ='Individual';							}																				$dataVencArr = explode("-",$iptu->data_vencto);					$dataEmiArr = explode("-",$iptu->data_emissao);									$dataEmissao = $dataEmiArr[2].'-'.$dataEmiArr[1].'-'.$dataEmiArr[0];				$dataVencto = $dataVencArr[2].'-'.$dataVencArr[1].'-'.$dataVencArr[0];					$dataDivArr = explode("-",$iptu->data_pendencias);					$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];								$test .= "<tr >";				$test .= "<td valign='top'>".utf8_decode($iptu->nome_fantasia)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->cpf_cnpj)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->cidade)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->loja_estado)."</td>";												$test .= "<td valign='top'>".utf8_decode($iptu->descricao_regional)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->descricao_bandeira)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->status_cnpj)."</td>";				$test .= "<td valign='top'>'".utf8_decode($iptu->ins_cnd_mob)."'</td>";									$test .= "<td valign='top'>".utf8_decode($tipoCnd)."</td>";								$test .= "<td valign='top'>".utf8_decode($status)."</td>";				$test .= "<td valign='top'>".utf8_decode($dataEmissao)."</td>";				$test .= "<td valign='top'>".utf8_decode($dataVencto)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->observacoes)."</td>";												$test .= "<td valign='top'></td>";				$test .= "<td valign='top'>".utf8_decode($iptu->observacoes_extrato)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->email)."</td>";								$test .= "<td valign='top'>".utf8_decode($dataAlteracao)."</td>";								$test .= "</tr>";			}		$test .='</table>';		}			header("Content-type: application/vnd.ms-excel");		header("Content-Disposition: attachment; filename=$file");		echo $test;	 } function csv_cnd_est_total($result,$ativo){	if($ativo == 0){		$file="export_base_por_tratativa_excel_ativas.xls";	}else{		$file="export_base_por_tratativa_excel_inativas.xls";	}		if($result == 0){			$test="<table border=1>		<tr>		<td>N&atilde;o H&aacute; Dados Para Esse Filtro</td>		</tr>		";		$test .='</table>';    }else{						$test="<table border=1>			<tr>						<td >Loja (Nome Fantasia)</td>			<td >CPF/CNPJ</td>			<td >CIDADE</td>			<td >UF</td>									<td >REGIONAL</td>			<td >BANDEIRA</td>			<td >Status CNPJ</td>			<td >Inscri&ccedil;&atilde;o</td>						<td >Tipo CND</td>				<td >Status CND</td>			<td >Data Emiss&atilde;o - CND</td>				<td >Data Vencto - CND</td>				<td >Observa&ccedil;&atilde;o CND</td>									<td >Data Pend&ecirc;ncia / Extrato</td>				<td >Observa&ccedil;&atilde;o Extrato</td>					<td >&Uacute;ltimo Usu&aacute;rio</td>						<td >Data Altera&ccedil;&atilde;o</td>											<td >Id Tratativa</td>						<td >Auto</td>						<td >Natureza</td>						<td >Inscri&ccedil;&atilde;o D&iacute;vida Ativa</td>				<td> Processo</td>			<td> Principal</td>			<td> Multa</td>			<td> Juros</td>			<td> Valor Total</td>			<td> Garantia / Validade</td>			<td> Respons&aacute;vel</td>			<td> Pasta</td>			<td> Contato</td>			<td> Escrit&oacute;rio</td>			<td> Data Envio</td>			<td> Data Solu&ccedil;&atilde;o</td>						<td >Status da Tratativa</td>					<td> Data Encerramento</td>						<td >Observa&ccedil;&otilde;es</td>						</tr>			";			foreach($result as $key => $iptu){ 		  								$tratativas = $this->cnd_estadual_model->buscarTratativasEst($iptu->id_cnd);	;									if($iptu->possui_cnd == 1){															$status ='Emitida';												}elseif($iptu->possui_cnd == 2){						$status ='Não Tratada';															}else{					$status ='Pendência';																				}				if(empty($iptu->data_alteracao)){					$dataAlteracao = '00-00-0000';				}else{					$dataAlteracaoArr = explode("-",$iptu->data_alteracao);						$dataAlteracao = $dataAlteracaoArr[2].'-'.$dataAlteracaoArr[1].'-'.$dataAlteracaoArr[0];				}								if($iptu->tipo_cnd == 1){															$tipoCnd ='Coletiva';							}else{					$tipoCnd ='Individual';							}																				$dataVencArr = explode("-",$iptu->data_vencto);					$dataEmiArr = explode("-",$iptu->data_emissao);									$dataEmissao = $dataEmiArr[2].'-'.$dataEmiArr[1].'-'.$dataEmiArr[0];				$dataVencto = $dataVencArr[2].'-'.$dataVencArr[1].'-'.$dataVencArr[0];					$dataDivArr = explode("-",$iptu->data_pendencias);					$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];								$test .= "<tr >";				$test .= "<td valign='top'>".utf8_decode($iptu->nome_fantasia)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->cpf_cnpj)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->cidade)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->estado)."</td>";												$test .= "<td valign='top'>".utf8_decode($iptu->descricao_regional)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->descricao_bandeira)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->status_cnpj)."</td>";				$test .= "<td valign='top'>'".utf8_decode($iptu->ins_cnd_mob)."'</td>";									$test .= "<td valign='top'>".utf8_decode($tipoCnd)."</td>";								$test .= "<td valign='top'>".utf8_decode($status)."</td>";				$test .= "<td valign='top'>".utf8_decode($dataEmissao)."</td>";				$test .= "<td valign='top'>".utf8_decode($dataVencto)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->observacoes)."</td>";												$test .= "<td valign='top'></td>";				$test .= "<td valign='top'>".utf8_decode($iptu->observacoes_extrato)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->email)."</td>";								$test .= "<td valign='top'>".utf8_decode($dataAlteracao)."</td>";								$isArrayDados =  is_array($tratativas) ? '1' : '0';					if($isArrayDados == 0){ 									$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";					$test .= "<td>-</td>";				}else{										$i=1;					foreach($tratativas as $trat => $tra){ 											$observacao = $this->cnd_mobiliaria_model->listarObsTratById($tra->id_tra);							if($i == 1){							$test .= "<td valign='top'>".$tra->id_tra."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->auto)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->natureza)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->inscricao)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->processo)."</td>";							$test .= "<td valign='top'>".$tra->principal."</td>";							$test .= "<td valign='top'>".$tra->multa."</td>";							$test .= "<td valign='top'>".$tra->juros."</td>";							$test .= "<td valign='top'>".$tra->valor_total."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->garantia)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->responsavel)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->pasta)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->contato)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->escritorio)."</td>";							$test .= "<td valign='top'>".$tra->data_envio."</td>";							$test .= "<td valign='top'>".$tra->prazo_solucao."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->descricao)."</td>";							$test .= "<td valign='top'>".$tra->data_encerramento."</td>";							$test .= "<td valign='top'>";							$isArrayDados =  is_array($observacao) ? '1' : '0';							if($isArrayDados == 0){ 														$test .='Sem Observa&ccedil;&otilde;es';							}else{								foreach($observacao as $observ => $obs){ 									$test .=utf8_decode($obs->observacao.'-'.$obs->email.'-'.$obs->data.' '.$obs->hora);									$test .='<BR>';								}							}							$test .= "</td>";							$test .= "</tr>";						}else{							$test .= "<td valign='top'>".utf8_decode($iptu->nome_fantasia)."</td>";							$test .= "<td valign='top'>".utf8_decode($iptu->cpf_cnpj)."</td>";							$test .= "<td valign='top'>".utf8_decode($iptu->cidade)."</td>";							$test .= "<td valign='top'>".utf8_decode($iptu->estado)."</td>";															$test .= "<td valign='top'>".utf8_decode($iptu->descricao_regional)."</td>";							$test .= "<td valign='top'>".utf8_decode($iptu->descricao_bandeira)."</td>";							$test .= "<td valign='top'>".utf8_decode($iptu->status_cnpj)."</td>";							$test .= "<td valign='top'>'".utf8_decode($iptu->ins_cnd_mob)."'</td>";												$test .= "<td valign='top'>".utf8_decode($tipoCnd)."</td>";											$test .= "<td valign='top'>".utf8_decode($status)."</td>";							$test .= "<td valign='top'>".utf8_decode($dataEmissao)."</td>";							$test .= "<td valign='top'>".utf8_decode($dataVencto)."</td>";							$test .= "<td valign='top'>".utf8_decode($iptu->observacoes)."</td>";															$test .= "<td valign='top'></td>";							$test .= "<td valign='top'>".utf8_decode($iptu->observacoes_extrato)."</td>";							$test .= "<td valign='top'>".utf8_decode($iptu->email)."</td>";											$test .= "<td valign='top'>".utf8_decode($dataAlteracao)."</td>";							$test .= "<td valign='top'>".$tra->id_tra."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->auto)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->natureza)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->inscricao)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->processo)."</td>";							$test .= "<td valign='top'>".$tra->principal."</td>";							$test .= "<td valign='top'>".$tra->multa."</td>";							$test .= "<td valign='top'>".$tra->juros."</td>";							$test .= "<td valign='top'>".$tra->valor_total."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->garantia)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->responsavel)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->pasta)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->contato)."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->escritorio)."</td>";							$test .= "<td valign='top'>".$tra->data_envio."</td>";							$test .= "<td valign='top'>".$tra->prazo_solucao."</td>";							$test .= "<td valign='top'>".utf8_decode($tra->descricao)."</td>";							$test .= "<td valign='top'>".$tra->data_encerramento."</td>";							$test .= "<td valign='top'>";							$isArrayDados =  is_array($observacao) ? '1' : '0';							if($isArrayDados == 0){ 														$test .='Sem Observa&ccedil;&otilde;es';							}else{								foreach($observacao as $observ => $obs){ 									$test .=utf8_decode($obs->observacao.'-'.$obs->email.'-'.$obs->data.' '.$obs->hora);									$test .='<BR>';								}							}							$test .= "</td>";							$test .= "</tr>";						}																		$i++;					}									}															$test .= "</tr>";			}		$test .='</table>';		}		header("Content-type: application/vnd.ms-excel");		header("Content-Disposition: attachment; filename=$file");		echo $test;	 } function csv_cnd_mob($result,$status){	 	if($_SESSION['loginTeste']['tipo_cnd'] == 2){  		if($status == 1) {			$file="cnd_estadual_ativas.xls";		}else{			$file="cnd_estadual_inativas.xls";		}			 }elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		 if($status == 1) {			$file="cnd_mobiliaria_ativas.xls";		}else{			$file="cnd_mobiliaria_inativas.xls";		}	 }else{		if($status == 1) {			$file="cnd_federal_ativas.xls";		}else{			$file="cnd_federal_inativas.xls";		}	 }	 			if($result == 0){			$test="<table border=1>		<tr>		<td>N&atilde;o H&aacute; Dados Para Esse Filtro</td>		</tr>		";		$test .='</table>';    }else{				$test="<table border=1>			<tr>						<td >Loja (Nome Fantasia)</td>			<td >CPF/CNPJ</td>			<td >CIDADE</td>			<td >UF</td>						<td >Inscri&ccedil;&atilde;o</td>			<td >REGIONAL</td>			<td >BANDEIRA</td>			<td >Status CND</td>			<td >Data Emiss&atilde;o - CND</td>				<td >Data Vencto - CND</td>				<td >Observa&ccedil;&atilde;o CND</td>									<td >Data Pend&ecirc;cia / Extrato</td>				<td >Observa&ccedil;&atilde;o Extrato</td>					<td >Valor Total</td>					<td >&Uacute;ltimo Usu&aacute;rio</td>						<td >Data Altera&ccedil;&atilde;o</td>					<td >Id Tratativa</td>						<td >Tipo de Pend&ecirc;ncia</td>						<td >&Uacute;ltima Tratativa (Data)</td>						<td >Status da Tratativa</td>						<td >Observa&ccedil;&otilde;es</td>						</tr>			";						foreach($result as $key => $iptu){ 		  								$tratativas = $this->cnd_mobiliaria_model->buscarTratativas($iptu->id_cnd);									if($iptu->possui_cnd == 1){															$status ='Emitida';												}elseif($iptu->possui_cnd == 2){						$status ='Não Tratada';					}elseif($iptu->possui_cnd ==3 ){						$status ='Pendência';						}else{					$status ='Sem Pendência';																				}				if(empty($iptu->data_alteracao)){					$dataAlteracao = '00-00-0000';				}else{					$dataAlteracaoArr = explode("-",$iptu->data_alteracao);						$dataAlteracao = $dataAlteracaoArr[2].'-'.$dataAlteracaoArr[1].'-'.$dataAlteracaoArr[0];				}				$valorTotal = str_replace('.',',',$iptu->valor_total);								$dataVencArr = explode("-",$iptu->data_vencto);					$dataEmiArr = explode("-",$iptu->data_emissao);									$dataEmissao = $dataEmiArr[2].'-'.$dataEmiArr[1].'-'.$dataEmiArr[0];				$dataVencto = $dataVencArr[2].'-'.$dataVencArr[1].'-'.$dataVencArr[0];					$dataDivArr = explode("-",$iptu->data_pendencias);					$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];								$test .= "<tr >";				$test .= "<td valign='top'>".utf8_decode($iptu->nome_fantasia)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->cpf_cnpj)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->cidade)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->estado)."</td>";								$test .= "<td valign='top'>'".utf8_decode($iptu->ins_cnd_mob)."'</td>";								$test .= "<td valign='top'>".utf8_decode($iptu->regional)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->descricao_bandeira)."</td>";				$test .= "<td valign='top'>".utf8_decode($status)."</td>";				$test .= "<td valign='top'>".utf8_decode($dataEmissao)."</td>";				$test .= "<td valign='top'>".utf8_decode($dataVencto)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->observacoes)."</td>";												$test .= "<td valign='top'>".utf8_decode($dataDiv)."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->observacoes_extrato)."</td>";				$test .= "<td valign='top'>".$valorTotal."</td>";				$test .= "<td valign='top'>".utf8_decode($iptu->email)."</td>";				$test .= "<td valign='top'>".utf8_decode($dataAlteracao)."</td>";				$isArrayDados =  is_array($tratativas) ? '1' : '0';					if($isArrayDados == 0){ 					$test .= "<td></td>";					$test .= "<td></td>";					$test .= "<td></td>";					$test .= "<td></td>";					$test .= "<td></td>";				}else{					$test .= "<td valign='top'>";					foreach($tratativas as $trat => $tra){ 						$test .=$tra->id;						$test .='<BR>';					}					$test .= "</td>";					$test .= "<td valign='top'>";					foreach($tratativas as $trat => $tra){ 						$test .=$tra->pendencia;						$test .='<BR>';					}					$test .= "</td>";					$test .= "<td valign='top'>";					foreach($tratativas as $trat => $tra){ 						$test .=$tra->data_informe_pendencia;						$test .='<BR>';					}					$test .= "</td>";					$test .= "<td valign='top'>";					foreach($tratativas as $trat => $tra){ 						if($tra->status_demanda == 1){							$test .='EM ATENDIMENTO';						}elseif($tra->status_demanda == 2){							$test .='ENCERRADO';						}elseif($tra->status_demanda == 3){							$test .='CANCELADO';						}else{							$test .='SEM STATUS';						}						$test .='<BR>';					}					$test .= "</td>";					$test .= "<td valign='top'>";					foreach($tratativas as $trat => $tra){ 						$observacao = $this->cnd_mobiliaria_model->listarObsTratById($tra->id);							$isArrayDados =  is_array($observacao) ? '1' : '0';						if($isArrayDados == 0){ 													$test .='Sem Observações';						}else{							foreach($observacao as $observ => $obs){ 								$test .=utf8_decode($obs->observacao.'-'.$obs->email.'-'.$obs->data.' '.$obs->hora);								$test .='<BR>';							}						}											}					$test .= "</td>";				}															$test .= "</tr>";										}		$test .='</table>';		}					header("Content-type: application/vnd.ms-excel");		header("Content-Disposition: attachment; filename=$file");		echo $test;	 }  function csv_cnd_imob($result){	$file="cnd_imobiliaria.xls";	if($result == 0){			$test="<table border=1>		<tr>		<td>N&atilde;o H&aacute; Dados Para Esse Filtro</td>		</tr>		";		$test .='</table>';    }else{				$test="<table border=1>			<tr>						<td>Im&oacute;vel</td>			<td>CNPJ</td>			<td>UF</td>			<td>Inscri&ccedil;&atilde;o</td>			<td>Status</td>			<td>Data Vecto</td>						</tr>			";			foreach($result as $key => $iptu){ 		  								if($iptu->possui_cnd == 1){															$status ='Emitida';								$dataDivArr = explode("-",$iptu->data_vencto);						$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];				}elseif($iptu->possui_cnd == 2){						$status ='Não Tratada';																$dataDivArr = explode("-",$iptu->data_vencto);						$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];					}else{					$status ='Não Tratada';																$dataDivArr = explode("-",$iptu->data_pendencias);						$dataDiv = $dataDivArr[2].'-'.$dataDivArr[1].'-'.$dataDivArr[0];					}																$test .= "<tr >";				$test .= "<td>".utf8_decode($iptu->nome)."</td>";				$test .= "<td>".utf8_decode($iptu->cpf_cnpj)."</td>";				$test .= "<td>".utf8_decode($iptu->estado)."</td>";				$test .= "<td>'".utf8_decode($iptu->inscricao)."'</td>";				$test .= "<td>".utf8_decode($status)."</td>";				$test .= "<td>".utf8_decode($dataDiv)."</td>";								$test .= "</tr>";										}			$test .='</table>';		}		header("Content-type: application/vnd.ms-excel");		header("Content-Disposition: attachment; filename=$file");		echo $test;	 }  function visao_interna_cnd_imob(){   $this->logado();         if(empty($_SESSION['idTratativa'])){		$idTratativa = 0;	}else{		$idTratativa = $_SESSION['idTratativa'];	}			$data['idTratativa'] = $idTratativa;	$id = $this->input->get('id');	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$data['obs'] = $this->cnd_imobiliaria_model->buscaTodasObservacoes($id,2);		$data['imovel'] = $this->cnd_imobiliaria_model->listarInscricaoByImovel($idContratante,$id);	$data['id_cnd'] = $id;	$data['tratativas'] =  $this->cnd_imobiliaria_model->listarTodasTratativas($idContratante,$id,2);	$data['esferas'] = $this->cnd_imobiliaria_model->listarEsfera();	$data['etapas'] = $this->cnd_imobiliaria_model->listarEtapa();	$data['statusInterno'] = $this->cnd_imobiliaria_model->listarStatusInterno();	$data['statusDemanda'] = $this->cnd_imobiliaria_model->listarStatusDemanda();		$data['empresa'] = $session_data['empresa'];	$data['nome_modulo'] = 'Cnd Imobiliária';		$data['modulo'] = '2';			$data['usuarios']  = $this->user->dadosUsuarios();		$this->load->view('header_pages_view',$data);    $this->load->view('cnd_imob_visao_unica_view', $data);	$this->load->view('footer_pages_view');}function kpi_estadual(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}		$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];	$data['controler'] =  'kpi_estadual';	$data['perfil'] = $session_data['perfil'];	$data['tipo'] =  'ESTADUAIS';	$data['meses'] = $this->cnd_estadual_model->listarMesesKPIEst();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$data['dataExibicao'] = meses(date("m")).'/'.date("Y");			}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];	}	$data['primeiroDia'] = $primeiroDia;			$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);	if($totalWMBR[0]['total'] == 0){				$data['WMBR'] = $this->kpi_dinamica_todos('WMBR',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['WMBR'] =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);			}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);	if($totalBPBA[0]['total'] == 0){				$data['BPBA'] = $this->kpi_dinamica_todos('BPBA',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['BPBA'] =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);			}		$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);	if($totalBPNE[0]['total'] == 0){				$data['BPNE'] = $this->kpi_dinamica_todos('BPNE',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['BPNE'] =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);			}		$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);	if($totalWMS[0]['total'] == 0){				$data['WMS'] = $this->kpi_dinamica_todos('WMS',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['WMS'] =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);			}			$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);	if($totalTB[0]['total'] == 0){				$data['TB'] = $this->kpi_dinamica_todos('TB',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['TB'] =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);			}			$this->load->view('header_pages_view',$data);	$this->load->view('kpi_estadual', $data);	$this->load->view('footer_pages_view'); }  function kpi_imobiliaria(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}		$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$data['perfil'] = $session_data['perfil'];	$data['controler'] =  'kpi_imobiliaria';	$data['tipo'] =  'IMOBILIÁRIOS';	$data['meses'] = $this->cnd_estadual_model->listarMesesKPIFed();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$data['dataExibicao'] = meses(date("m")).'/'.date("Y");			}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];	}	$data['primeiroDia'] = $primeiroDia;			$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);	if($totalWMBR[0]['total'] == 0){				$data['WMBR'] = $this->kpi_dinamica_todos('WMBR',$primeiroDia,$idContratante,'kpi_imobiliaria');	}else{		$data['WMBR'] =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);			}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);	if($totalBPBA[0]['total'] == 0){				$data['BPBA'] = $this->kpi_dinamica_todos('BPBA',$primeiroDia,$idContratante,'kpi_imobiliaria');	}else{		$data['BPBA'] =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);			}		$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);	if($totalBPNE[0]['total'] == 0){				$data['BPNE'] = $this->kpi_dinamica_todos('BPNE',$primeiroDia,$idContratante,'kpi_imobiliaria');	}else{		$data['BPNE'] =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);			}		$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);	if($totalWMS[0]['total'] == 0){				$data['WMS'] = $this->kpi_dinamica_todos('WMS',$primeiroDia,$idContratante,'kpi_imobiliaria');	}else{		$data['WMS'] =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);			}			$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);	if($totalTB[0]['total'] == 0){				$data['TB'] = $this->kpi_dinamica_todos('TB',$primeiroDia,$idContratante,'kpi_imobiliaria');	}else{		$data['TB'] =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);			}			$this->load->view('header_pages_view',$data);	$this->load->view('kpi_estadual', $data);	$this->load->view('footer_pages_view'); }  function kpi(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}		$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$data['perfil'] = $session_data['perfil'];			if($_SESSION['loginTeste']['tipo_cnd'] == 2){		$data['controler'] =  'kpi_estadual';		$data['tipo'] = 'ESTADUAIS';		$data['nome_cnd'] = 'CND Estadual - Ativas';	}elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		$data['controler'] =  'kpi_mobiliaria';		$data['tipo'] = 'MOBILIÁRIOS';		$data['nome_cnd'] = 'CND Mobiliária - Ativas';	}else{		$data['controler'] =  'kpi_federal';		$data['tipo'] = 'FEDERAIS';		$data['nome_cnd'] = 'CND Federal - Ativas';	}			$data['meses'] = $this->cnd_estadual_model->listarMesesKPIMob();			if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$data['dataExibicao'] = meses(date("m")).'/'.date("Y");			}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];	}	$data['primeiroDia'] = $primeiroDia;		$cnpjs =  $this->cnd_estadual_model->listarRegional();		$arrDados = array();	$i=0;	foreach($cnpjs as $val){		$arrDados[$i]['idReg'] = $val->id;		$arrDados[$i]['descricao'] = $val->descricao;		$resultado =  $this->cnd_estadual_model->listarTotalClientes($val->descricao,$primeiroDia);		if($resultado[0]['total'] == 0){				$arrDados[$i]['dados'] = $this->kpi_dinamica_todos($val->descricao,$primeiroDia,$idContratante,$data['controler']);		}else{			$arrDados[$i]['dados'] =  $this->cnd_estadual_model->listarResumoClientes($val->descricao,$primeiroDia);				}				$i++;	}	$data['dados'] = $arrDados;		// $totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('Regional 1',$primeiroDia);	// if($totalWMBR[0]['total'] == 0){			// $data['WMBR'] = $this->kpi_dinamica_todos('Regional 1',$primeiroDia,$idContratante,'kpi_mobiliaria');	// }else{		// $data['WMBR'] =  $this->cnd_estadual_model->listarResumoClientes('Regional 1',$primeiroDia);			// }				// $totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('Regional 2',$primeiroDia);	// if($totalBPBA[0]['total'] == 0){				// $data['BPBA'] = $this->kpi_dinamica_todos('Regional 2',$primeiroDia,$idContratante,'kpi_mobiliaria');	// }else{		// $data['BPBA'] =  $this->cnd_estadual_model->listarResumoClientes('Regional 2',$primeiroDia);			// }		// $totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('Regional 3',$primeiroDia);	// if($totalBPNE[0]['total'] == 0){				// $data['BPNE'] = $this->kpi_dinamica_todos('Regional 3',$primeiroDia,$idContratante,'kpi_mobiliaria');	// }else{		// $data['BPNE'] =  $this->cnd_estadual_model->listarResumoClientes('Regional 3',$primeiroDia);			// }		// $totalWMS =  $this->cnd_estadual_model->listarTotalClientes('Regional 4',$primeiroDia);	// if($totalWMS[0]['total'] == 0){				// $data['WMS'] = $this->kpi_dinamica_todos('Regional 4',$primeiroDia,$idContratante,'kpi_mobiliaria');	// }else{		// $data['WMS'] =  $this->cnd_estadual_model->listarResumoClientes('Regional 4',$primeiroDia);			// }			// $totalTB =  $this->cnd_estadual_model->listarTotalClientes('Regional 5',$primeiroDia);	// if($totalTB[0]['total'] == 0){				// $data['TB'] = $this->kpi_dinamica_todos('Regional 5',$primeiroDia,$idContratante,'kpi_mobiliaria');	// }else{		// $data['TB'] =  $this->cnd_estadual_model->listarResumoClientes('Regional 5',$primeiroDia);			// }			$this->load->view('header_pages_view',$data);	$this->load->view('kpi_estadual', $data);	$this->load->view('footer_pages_view'); }  function fechamentoEstadual(){				$session_data = $_SESSION['loginTeste'];		$data['email'] = $session_data['email'];		$data['empresa'] = $session_data['empresa'];		$data['perfil'] = $session_data['perfil'];		$idContratante = $session_data['id_contratante'];			//ultimo dia do mes			$primeiroDia  = $_GET['data'];		$primeiroDiaArr = explode("-",$primeiroDia);				$ultimoDiaEncontrado = date("t", mktime(0,0,0,$primeiroDiaArr[1] ,'01',$primeiroDiaArr[0])); 		$ultimoDia = $primeiroDiaArr[0].'-'.$primeiroDiaArr[1].'-'.$ultimoDiaEncontrado; 				$cnpjs =  $this->cnd_estadual_model->listarRegional();				$tipo = 'kpi_estadual';					$i=0;		foreach($cnpjs as $cnpj){			$cnpjCliente = $cnpj->cnpj;			$referencia = $cnpj->descricao;			$nome = $cnpj->descricao;						$contratante = $idContratante;						$dadosEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,1);				$dadosNaoEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,2);							$dadosPendentes =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,3);										$dados[$i]['cnpj']=$cnpjCliente;			$dados[$i]['mes_competencia'] =$primeiroDia;			$dados[$i]['emitidas'] =$dadosEmitidas[0]->total;			$dados[$i]['n_emitidas']=$dadosNaoEmitidas[0]->total;			$dados[$i]['pendentes']=$dadosPendentes[0]->total;			$dados[$i]['nome_empresa']=$nome;			$dados[$i]['id_contratante']=$contratante;									$totalEmitidas =  $dadosEmitidas[0]->total;						$totalNTratadas =  $dadosNaoEmitidas[0]->total;									$totalPendentes =  $dadosPendentes[0]->total;								$verifica = $this->cnd_estadual_model->verificaFechamentoMensal($cnpj->id,$primeiroDia);						if($verifica[0]->total == 0){				$dados = array(				'cnpj' => $cnpjCliente,				'mes_competencia' => $primeiroDia,				'n_emitidas' => $totalNTratadas,				'pendentes' => $totalPendentes,				'emitidas' => $totalEmitidas,				'regional' => $cnpj->id,			);						$this->cnd_estadual_model->insere_serpac($dados);						}			}	echo json_encode($primeiroDia);	exit;	}	 function fechamentoMobiliaria(){				$session_data = $_SESSION['loginTeste'];		$data['email'] = $session_data['email'];		$data['empresa'] = $session_data['empresa'];		$data['perfil'] = $session_data['perfil'];		$idContratante = $session_data['id_contratante'];			//ultimo dia do mes			$primeiroDia  = $_GET['data'];		$primeiroDiaArr = explode("-",$primeiroDia);				$ultimoDiaEncontrado = date("t", mktime(0,0,0,$primeiroDiaArr[1] ,'01',$primeiroDiaArr[0])); 		$ultimoDia = $primeiroDiaArr[0].'-'.$primeiroDiaArr[1].'-'.$ultimoDiaEncontrado; 				$cnpjs =  $this->cnd_estadual_model->listarRegional();				$tipo = 'kpi_mobiliaria';					$i=0;		foreach($cnpjs as $cnpj){			$cnpjCliente = $cnpj->cnpj;			$referencia = $cnpj->descricao;			$nome = $cnpj->descricao;						$contratante = $idContratante;						$dadosEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,1);				$dadosNaoEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,2);							$dadosPendentes =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,3);										$dados[$i]['cnpj']=$cnpjCliente;			$dados[$i]['mes_competencia'] =$primeiroDia;			$dados[$i]['emitidas'] =$dadosEmitidas[0]->total;			$dados[$i]['n_emitidas']=$dadosNaoEmitidas[0]->total;			$dados[$i]['pendentes']=$dadosPendentes[0]->total;			$dados[$i]['nome_empresa']=$nome;			$dados[$i]['id_contratante']=$contratante;									$totalEmitidas =  $dadosEmitidas[0]->total;						$totalNTratadas =  $dadosNaoEmitidas[0]->total;									$totalPendentes =  $dadosPendentes[0]->total;								$verifica = $this->cnd_estadual_model->verificaFechamentoMensal($cnpj->id,$primeiroDia);						if($verifica[0]->total == 0){				$dados = array(				'cnpj' => $cnpjCliente,				'mes_competencia' => $primeiroDia,				'n_emitidas' => $totalNTratadas,				'pendentes' => $totalPendentes,				'emitidas' => $totalEmitidas,				'regional' => $cnpj->id,			);						$this->cnd_estadual_model->insere_serpac($dados);						}			}	echo json_encode($primeiroDia);	exit;	}	function kpi_federal(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}		$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$data['perfil'] = $session_data['perfil'];	$data['controler'] =  'kpi_federal';	$data['meses'] = $this->cnd_estadual_model->listarMesesKPIFed();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$data['dataExibicao'] = meses(date("m")).'/'.date("Y");			}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];	}	$data['primeiroDia'] = $primeiroDia;			$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);	if($totalWMBR[0]['total'] == 0){				$data['WMBR'] = $this->kpi_dinamica('WMBR',$primeiroDia,$idContratante,'federal');	}else{		$data['WMBR'] =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);			}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);	if($totalBPBA[0]['total'] == 0){				$data['BPBA'] = $this->kpi_dinamica('BPBA',$primeiroDia,$idContratante,'federal');	}else{		$data['BPBA'] =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);			}		$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);	if($totalBPNE[0]['total'] == 0){				$data['BPNE'] = $this->kpi_dinamica('BPNE',$primeiroDia,$idContratante,'federal');	}else{		$data['BPNE'] =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);			}		$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);	if($totalWMS[0]['total'] == 0){				$data['WMS'] = $this->kpi_dinamica('WMS',$primeiroDia,$idContratante,'federal');	}else{		$data['WMS'] =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);			}			$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);	if($totalTB[0]['total'] == 0){				$data['TB'] = $this->kpi_dinamica('TB',$primeiroDia,$idContratante,'federal');	}else{		$data['TB'] =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);			}			$this->load->view('header_pages_view',$data);	$this->load->view('kpi_federal', $data);	$this->load->view('footer_pages_view'); }  function kpi_dinamica_todos($nomeCliente,$primeiroDia,$idContratante,$tipo){		//ultimo dia do mes			$primeiroDiaArr = explode("-",$primeiroDia);				$ultimoDiaEncontrado = date("t", mktime(0,0,0,$primeiroDiaArr[1] ,'01',$primeiroDiaArr[0])); 		$ultimoDia = $primeiroDiaArr[0].'-'.$primeiroDiaArr[1].'-'.$ultimoDiaEncontrado; 				$cnpjs =  $this->cnd_estadual_model->listarRegional();						$i=0;	foreach($cnpjs as $cnpj){		if($nomeCliente == $cnpj->descricao){						$totalEmitidas =  0;			$totalNaoEmitidas =  0;			$cnpjCliente = $cnpj->cnpj;						$nome = $cnpj->descricao;						$contratante = $idContratante;						$dadosEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,1);					$dadosNaoEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,2);							$dadosPendentes =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,3);										$dados[$i]['cnpj']=$cnpjCliente;			$dados[$i]['mes_competencia'] =$primeiroDia;			$dados[$i]['emitidas'] =$dadosEmitidas[0]->total;			$dados[$i]['n_emitidas']=$dadosNaoEmitidas[0]->total;			$dados[$i]['pendentes']=$dadosPendentes[0]->total;			$dados[$i]['nome_empresa']=$nome;			$dados[$i]['id_contratante']=$contratante;			$i++;										}	}		return($dados);	}	 function kpi_dinamica($nomeCliente,$primeiroDia,$idContratante,$tipo){		//ultimo dia do mes			$primeiroDiaArr = explode("-",$primeiroDia);				$ultimoDiaEncontrado = date("t", mktime(0,0,0,$primeiroDiaArr[1] ,'01',$primeiroDiaArr[0])); 		$ultimoDia = $primeiroDiaArr[0].'-'.$primeiroDiaArr[1].'-'.$ultimoDiaEncontrado; 				$cnpjs =  $this->cnd_estadual_model->listarRegional();								$i=0;		$dados = array();	foreach($cnpjs as $cnpj){		if($nomeCliente == $cnpj->descricao){						$totalEmitidas =  0;			$totalNaoEmitidas =  0;			$cnpjCliente = $cnpj->cnpj;						$nome = $cnpj->descricao;						$contratante = $idContratante;						$dadosEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,1);			$dadosNaoEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,2);							$dadosPendentes =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$cnpj->id,$primeiroDia,$ultimoDia,3);										$dados[$i]['cnpj']=$cnpjCliente;			$dados[$i]['mes_competencia'] =$primeiroDia;			$dados[$i]['emitidas'] =$dadosEmitidas[0]->total;			$dados[$i]['n_emitidas']=$dadosNaoEmitidas[0]->total;			$dados[$i]['pendentes']=$dadosPendentes[0]->total;			$dados[$i]['nome_empresa']=$nome;			$dados[$i]['id_contratante']=$contratante;						if($dadosEmitidas[0]->total == 0){				$dados[$i]['porc'] = 0;			}else{				$dados[$i]['porc'] = round((($dadosEmitidas[0]->total / ($dadosEmitidas[0]->total + $dadosNaoEmitidas[0]->total)) * 100),2);			}					$i++;										}	}			return($dados);	}		function exportKpiEstadual(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST['data'])){		$primeiroDia = date("Y-m".'-01');	}else{		$primeiroDia = $_POST['data'];	}	$data['primeiroDia'] = $primeiroDia;		$tipo = $_POST['tipo'];		$dataArr = explode("-",$primeiroDia);	$dataExibicao = meses($dataArr[1]).'/'.$dataArr[0];		if($tipo == 'todos'){				$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);		if($totalWMBR[0]['total'] == 0){					$WMBR = $this->kpi_dinamica('WMBR',$primeiroDia,$idContratante,'federal');		}else{			$WMBR =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);				}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);		if($totalBPBA[0]['total'] == 0){					$BPBA = $this->kpi_dinamica('BPBA',$primeiroDia,$idContratante,'federal');		}else{			$BPBA =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);				}				$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);		if($totalBPNE[0]['total'] == 0){					$BPNE = $this->kpi_dinamica('BPNE',$primeiroDia,$idContratante,'federal');		}else{			$BPNE =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);				}				$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);		if($totalWMS[0]['total'] == 0){					$WMS = $this->kpi_dinamica('WMS',$primeiroDia,$idContratante,'federal');		}else{			$WMS =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);				}						$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);		if($totalTB[0]['total'] == 0){					$TB = $this->kpi_dinamica('TB',$primeiroDia,$idContratante,'federal');		}else{			$TB =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);				}				$html = $this->montaHtmlVariosFederal($WMBR,$BPBA,$BPNE,$WMS,$TB,$dataExibicao);	}else{		$cliente = $this->cnd_estadual_model->listarResumoClientes($tipo,$primeiroDia);							$isArrayDados =  is_array($cliente) ? '1' : '0';			if($isArrayDados == 0){ 			$cliente =  $this->kpi_dinamica($tipo,$primeiroDia);		}else{			$cliente = $cliente;		}				$html = $this->montaHtml($cliente,$dataExibicao);	}		$dataAtual = date("d/m/Y - H:i");	tcpdf();	$obj_pdf = new TCPDF('P', PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);	$obj_pdf->SetCreator(PDF_CREATOR);		$obj_pdf->SetHeaderData('','' , $dataAtual,'' );	$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));	$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));	$obj_pdf->SetDefaultMonospacedFont('helvetica');	$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);	$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);	$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);	$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);	$obj_pdf->SetFont('helvetica', '', 9);	$obj_pdf->setFontSubsetting(false);	$obj_pdf->AddPage();		$obj_pdf->writeHTML($html, true, false, true, false, '');	$obj_pdf->Output('output.pdf', 'I');				}function exportKpiUnico(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$dataAtual = date("d/m/Y - H:i");		$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST['data'])){		$primeiroDia = date("Y-m".'-01');	}else{		$primeiroDia = $_POST['data'];	}	$data['primeiroDia'] = $primeiroDia;	$tipo= $_POST['tipo'];	$tipoCnd = $_POST['tipoCnd'];		$dataArr = explode("-",$primeiroDia);	$dataExibicao = meses($dataArr[1]).'/'.$dataArr[0];		$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes($tipo,$primeiroDia);	if($totalWMBR[0]['total'] == 0){				$cliente = $this->kpi_dinamica($tipo,$primeiroDia,$idContratante,$tipoCnd);	}else{		$cliente =  $this->cnd_estadual_model->listarResumoClientes($tipo,$primeiroDia);			}		$html = $this->montaHtmlCnd($cliente,$dataExibicao,$tipoCnd,$tipo);			$this->load->library('Pdf');	$this->dompdf->loadHtml($html);	$this->dompdf->setPaper('A4', 'portrait');	$this->dompdf->render();	$this->dompdf->stream($tipoCnd.".pdf", array("Attachment"=>0));	exit;		 		}function exportKpi(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}			$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST['data'])){		$primeiroDia = date("Y-m".'-01');	}else{		$primeiroDia = $_POST['data'];	}	$data['primeiroDia'] = $primeiroDia;		 if($_SESSION['loginTeste']['tipo_cnd'] == 2){  		$tipoCnd = "kpi_estadual";		$modulo = 2;	 }elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		 $tipoCnd = "kpi_mobiliaria";		 $modulo = 1;	 }else{		 $tipoCnd = "kpi_federal";		 $modulo = 3;	 }		 	 	 		$dataArr = explode("-",$primeiroDia);	$dataExibicao = meses($dataArr[1]).'/'.$dataArr[0];				$cnpjs =  $this->cnd_estadual_model->listarRegional();		$arrDados = array();		$i=0;		foreach($cnpjs as $val){			$arrDados[$i]['descricao'] = $val->descricao;			$resultado =  $this->cnd_estadual_model->listarTotalClientes($val->descricao,$primeiroDia);			if($resultado[0]['total'] == 0){					$arrDados[$i]['dados'] = $this->kpi_dinamica_todos($val->descricao,$primeiroDia,$idContratante,$tipoCnd);			}else{				$arrDados[$i]['dados'] =  $this->cnd_estadual_model->listarResumoClientes($val->descricao,$primeiroDia);					}						$i++;		}			$html = $this->montaHtmlVarios($arrDados,$dataExibicao,$tipoCnd);			$this->load->library('Pdf');		$this->dompdf->loadHtml($html);		$this->dompdf->setPaper('A4', 'portrait');		$this->dompdf->render();		$this->dompdf->stream($tipoCnd.".pdf", array("Attachment"=>0));	}	function exportKpiFederal(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		if(empty($_POST['data'])){		$primeiroDia = date("Y-m".'-01');	}else{		$primeiroDia = $_POST['data'];	}	$data['primeiroDia'] = $primeiroDia;		$tipo = $_POST['tipo'];		$dataArr = explode("-",$primeiroDia);	$dataExibicao = meses($dataArr[1]).'/'.$dataArr[0];		if($tipo == 'todos'){				$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);		if($totalWMBR[0]['total'] == 0){					$WMBR = $this->kpi_dinamica('WMBR',$primeiroDia,$idContratante,'federal');		}else{			$WMBR =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);				}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);		if($totalBPBA[0]['total'] == 0){					$BPBA = $this->kpi_dinamica('BPBA',$primeiroDia,$idContratante,'federal');		}else{			$BPBA =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);				}				$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);		if($totalBPNE[0]['total'] == 0){					$BPNE = $this->kpi_dinamica('BPNE',$primeiroDia,$idContratante,'federal');		}else{			$BPNE =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);				}				$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);		if($totalWMS[0]['total'] == 0){					$WMS = $this->kpi_dinamica('WMS',$primeiroDia,$idContratante,'federal');		}else{			$WMS =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);				}						$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);		if($totalTB[0]['total'] == 0){					$TB = $this->kpi_dinamica('TB',$primeiroDia,$idContratante,'federal');		}else{			$TB =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);				}				$html = $this->montaHtmlVariosFederal($WMBR,$BPBA,$BPNE,$WMS,$TB,$dataExibicao);	}else{		$cliente = $this->cnd_estadual_model->listarResumoClientes($tipo,$primeiroDia);							$isArrayDados =  is_array($cliente) ? '1' : '0';			if($isArrayDados == 0){ 			$cliente =  $this->kpi_dinamica($tipo,$primeiroDia);		}else{			$cliente = $cliente;		}				$html = $this->montaHtml($cliente,$dataExibicao);	}		$dataAtual = date("d/m/Y - H:i");	tcpdf();	$obj_pdf = new TCPDF('P', PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);	$obj_pdf->SetCreator(PDF_CREATOR);		$obj_pdf->SetHeaderData('','' , $dataAtual,'' );	$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));	$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));	$obj_pdf->SetDefaultMonospacedFont('helvetica');	$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);	$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);	$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);	$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);	$obj_pdf->SetFont('helvetica', '', 9);	$obj_pdf->setFontSubsetting(false);	$obj_pdf->AddPage();		$obj_pdf->writeHTML($html, true, false, true, false, '');	$obj_pdf->Output('output.pdf', 'I');				}	function exportKpiFederalUnico(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];			if(empty($_POST['data'])){		$primeiroDia = date("Y-m".'-01');	}else{		$primeiroDia = $_POST['data'];	}	$data['primeiroDia'] = $primeiroDia;	$tipo = $_POST['tipo'];		$dataArr = explode("-",$primeiroDia);	$dataExibicao = meses($dataArr[1]).'/'.$dataArr[0];		$cliente = $this->cnd_estadual_model->listarResumoClientes($tipo,$primeiroDia);						$isArrayDados =  is_array($cliente) ? '1' : '0';		if($isArrayDados == 0){ 		$cliente = $this->kpi_dinamica($tipo,$primeiroDia,$idContratante,'federal');	}else{		$cliente = $cliente;	}			$html = $this->montaHtml($cliente,$dataExibicao,$tipo);		$dataAtual = date("d/m/Y - H:i");	tcpdf();	$obj_pdf = new TCPDF('P', PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);	$obj_pdf->SetCreator(PDF_CREATOR);		$obj_pdf->SetHeaderData('','' , $dataAtual,'' );	$obj_pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));	$obj_pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));	$obj_pdf->SetDefaultMonospacedFont('helvetica');	$obj_pdf->SetHeaderMargin(PDF_MARGIN_HEADER);	$obj_pdf->SetFooterMargin(PDF_MARGIN_FOOTER);	$obj_pdf->SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);	$obj_pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);	$obj_pdf->SetFont('helvetica', '', 9);	$obj_pdf->setFontSubsetting(false);	$obj_pdf->AddPage();		$obj_pdf->writeHTML($html, true, false, true, false, '');	$obj_pdf->Output('output.pdf', 'I');				}function graficoKpiEstadual(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];	$data['perfil'] = $session_data['perfil'];	$data['tipo'] = 'Estadual';	$data['controler'] =  'graficoKpiEstadual';	$data['meses'] = $this->cnd_estadual_model->listarMesesKPIEst();		$WMBR =	$BPBA =	$BPNE =	$WMS = 	$TB = array();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$dataArr = explode("-",$primeiroDia);			$data['dataExibicao'] = meses(date("m")).'/'.date("Y");				$primeiraData  = date('Y-m-d', strtotime('-365 days', strtotime($primeiroDia)));		$ultimoDia = cal_days_in_month(CAL_GREGORIAN, $dataArr[1], $dataArr[0]);		$ultimaData  = date($dataArr[0].'-'.$dataArr[1].'-'.$ultimoDia);								}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];				$primeiraData  = date($dataArr[0].'-'.$dataArr[1].'-01');		$ultimoDia = cal_days_in_month(CAL_GREGORIAN, $dataArr[1], $dataArr[0]);				$ultimaData  = date($dataArr[0].'-'.$dataArr[1].'-'.$ultimoDia);	}	$start    = (new DateTime($primeiraData))->modify('first day of this month');	$end      = (new DateTime($ultimaData))->modify('first day of next month');	$interval = DateInterval::createFromDateString('1 month');	$period   = new DatePeriod($start, $interval, $end);	$i=1;	foreach ($period as $dt) {		$dataConsulta = $dt->format("Y-m-01");						$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(1,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(1,$dataConsulta,$idContratante,'kpi_estadual');					}		$WMBR[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$WMBR[$i]['emitidas'] = $dados[0]['emitidas'];		$WMBR[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$WMBR[$i]['pendentes'] = $dados[0]['pendentes'];		$WMBR[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(2,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(2,$dataConsulta,$idContratante,'kpi_estadual');					}		$BPBA[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$BPBA[$i]['emitidas'] = $dados[0]['emitidas'];		$BPBA[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$BPBA[$i]['pendentes'] = $dados[0]['pendentes'];		$BPBA[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(3,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(3,$dataConsulta,$idContratante,'kpi_estadual');					}		$BPNE[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$BPNE[$i]['emitidas'] = $dados[0]['emitidas'];		$BPNE[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$BPNE[$i]['pendentes'] = $dados[0]['pendentes'];		$BPNE[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(4,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(4,$dataConsulta,$idContratante,'kpi_estadual');					}		$WMS[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$WMS[$i]['emitidas'] = $dados[0]['emitidas'];		$WMS[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$WMS[$i]['pendentes'] = $dados[0]['pendentes'];		$WMS[$i]['nome_empresa'] = $dados[0]['nome_empresa'];						$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(5,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(5,$dataConsulta,$idContratante,'kpi_estadual');					}		$TB[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$TB[$i]['emitidas'] = $dados[0]['emitidas'];		$TB[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$TB[$i]['pendentes'] = $dados[0]['pendentes'];		$TB[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$i++;			}			$data['WMBR'] =  $WMBR;	$data['BPBA'] =  $BPBA;	$data['BPNE'] =  $BPNE;	$data['WMS'] =  $WMS;	$data['TB'] =  $TB;		$this->load->view('header_pages_view',$data);	$this->load->view('graficoKpiEstadual', $data);	$this->load->view('footer_pages_view');	 } function graficoKpiMobiliaria(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];	$data['perfil'] = $session_data['perfil'];	$data['tipo'] = 'Mobiliárias';	$data['controler'] =  'graficoKpiMobiliaria';	$data['meses'] = $this->cnd_estadual_model->listarMesesKPIMob();		$WMBR =	$BPBA =	$BPNE =	$WMS = 	$TB = array();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$dataArr = explode("-",$primeiroDia);			$data['dataExibicao'] = meses(date("m")).'/'.date("Y");				$primeiraData  = date('Y-m-d', strtotime('-365 days', strtotime($primeiroDia)));		$ultimoDia = cal_days_in_month(CAL_GREGORIAN, $dataArr[1], $dataArr[0]);		$ultimaData  = date($dataArr[0].'-'.$dataArr[1].'-'.$ultimoDia);								}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];				$primeiraData  = date($dataArr[0].'-'.$dataArr[1].'-01');		$ultimoDia = cal_days_in_month(CAL_GREGORIAN, $dataArr[1], $dataArr[0]);				$ultimaData  = date($dataArr[0].'-'.$dataArr[1].'-'.$ultimoDia);	}	$start    = (new DateTime($primeiraData))->modify('first day of this month');	$end      = (new DateTime($ultimaData))->modify('first day of next month');	$interval = DateInterval::createFromDateString('1 month');	$period   = new DatePeriod($start, $interval, $end);	$i=1;	foreach ($period as $dt) {		$dataConsulta = $dt->format("Y-m-01");						$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(1,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(1,$dataConsulta,$idContratante,'kpi_mobiliaria');					}		$WMBR[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$WMBR[$i]['emitidas'] = $dados[0]['emitidas'];		$WMBR[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$WMBR[$i]['pendentes'] = $dados[0]['pendentes'];		$WMBR[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(2,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(2,$dataConsulta,$idContratante,'kpi_mobiliaria');					}		$BPBA[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$BPBA[$i]['emitidas'] = $dados[0]['emitidas'];		$BPBA[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$BPBA[$i]['pendentes'] = $dados[0]['pendentes'];		$BPBA[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(3,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(3,$dataConsulta,$idContratante,'kpi_mobiliaria');					}		$BPNE[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$BPNE[$i]['emitidas'] = $dados[0]['emitidas'];		$BPNE[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$BPNE[$i]['pendentes'] = $dados[0]['pendentes'];		$BPNE[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(4,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(4,$dataConsulta,$idContratante,'kpi_mobiliaria');					}		$WMS[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$WMS[$i]['emitidas'] = $dados[0]['emitidas'];		$WMS[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$WMS[$i]['pendentes'] = $dados[0]['pendentes'];		$WMS[$i]['nome_empresa'] = $dados[0]['nome_empresa'];						$dados = $this->cnd_estadual_model->buscarDadosKpiMeses(5,$dataConsulta);				if($dados ==0){			$dados = $this->kpiDadosDinamica(5,$dataConsulta,$idContratante,'kpi_mobiliaria');					}		$TB[$i]['mes_competencia'] = $dados[0]['mes_competencia'];		$TB[$i]['emitidas'] = $dados[0]['emitidas'];		$TB[$i]['n_emitidas'] = $dados[0]['n_emitidas'];		$TB[$i]['pendentes'] = $dados[0]['pendentes'];		$TB[$i]['nome_empresa'] = $dados[0]['nome_empresa'];				$i++;			}			$data['WMBR'] =  $WMBR;	$data['BPBA'] =  $BPBA;	$data['BPNE'] =  $BPNE;	$data['WMS'] =  $WMS;	$data['TB'] =  $TB;		$this->load->view('header_pages_view',$data);	$this->load->view('graficoKpiEstadual', $data);	$this->load->view('footer_pages_view');	 }  function kpiDadosDinamica($regional,$primeiroDia,$idContratante,$tipo){		$primeiroDiaArr = explode("-",$primeiroDia);			$ultimoDiaEncontrado = date("t", mktime(0,0,0,$primeiroDiaArr[1] ,'01',$primeiroDiaArr[0])); 	$ultimoDia = $primeiroDiaArr[0].'-'.$primeiroDiaArr[1].'-'.$ultimoDiaEncontrado; 	$i=0;		$dadosEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$regional,$primeiroDia,$ultimoDia,1);	$dadosNaoEmitidas =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$regional,$primeiroDia,$ultimoDia,2);					$dadosPendentes =  $this->cnd_estadual_model->buscarDadosKpiClientes($tipo,$regional,$primeiroDia,$ultimoDia,3);								$dados[$i]['mes_competencia'] =$primeiroDia;			$dados[$i]['emitidas'] =$dadosEmitidas[0]->total;	$dados[$i]['n_emitidas']=$dadosNaoEmitidas[0]->total;	$dados[$i]['pendentes']=$dadosPendentes[0]->total;	$dados[$i]['nome_empresa']=$regional;					if($dadosEmitidas[0]->total == 0){		$dados[$i]['porc'] = 0;	}else{		$dados[$i]['porc'] = round((($dadosEmitidas[0]->total / ($dadosEmitidas[0]->total + $dadosNaoEmitidas[0]->total)) * 100),2);	}		return($dados);}		 function graficoKpiImobiliaria(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];	$data['perfil'] = $session_data['perfil'];	$data['tipo'] = 'Imobiliárias';	$data['controler'] =  'graficoKpiImobiliaria';	$data['meses'] = $this->cnd_estadual_model->listarMesesKPIFed();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$data['dataExibicao'] = meses(date("m")).'/'.date("Y");				$primeiraData  = date('Y-m-d', strtotime('-365 days', strtotime($primeiroDia)));		$ultimaData  = $primeiroDia;			}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];				$primeiraData  = date($dataArr[0].'-'.$dataArr[1].'-01');		$ultimoDia = cal_days_in_month(CAL_GREGORIAN, $dataArr[1], $dataArr[0]);				$ultimaData  = date($dataArr[0].'-'.$dataArr[1].'-'.$ultimoDia);	}		$data['primeiroDia'] = $primeiroDia;		$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);	if($totalWMBR[0]['total'] == 0){				$data['WMBR'] = $this->kpi_dinamica('WMBR',$primeiroDia,$idContratante,'kpi_mobiliaria');	}else{		$data['WMBR'] =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);			}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);	if($totalBPBA[0]['total'] == 0){				$data['BPBA'] = $this->kpi_dinamica('BPBA',$primeiroDia,$idContratante,'kpi_mobiliaria');	}else{		$data['BPBA'] =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);			}		$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);	if($totalBPNE[0]['total'] == 0){				$data['BPNE'] = $this->kpi_dinamica('BPNE',$primeiroDia,$idContratante,'kpi_mobiliaria');	}else{		$data['BPNE'] =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);			}		$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);	if($totalWMS[0]['total'] == 0){				$data['WMS'] = $this->kpi_dinamica('WMS',$primeiroDia,$idContratante,'kpi_mobiliaria');	}else{		$data['WMS'] =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);			}			$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);	if($totalTB[0]['total'] == 0){				$data['TB'] = $this->kpi_dinamica('TB',$primeiroDia,$idContratante,'kpi_mobiliaria');	}else{		$data['TB'] =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);			}				//print_r($data['alcon']);exit;		$this->load->view('header_pages_view',$data);	$this->load->view('graficoKpiEstadual', $data);	$this->load->view('footer_pages_view'); } function graficoKpiEstadualOld(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];	$data['perfil'] = $session_data['perfil'];	$data['tipo'] = 'Estaduais';	$data['controler'] =  'graficoKpiEstadual';	$data['meses'] = $this->cnd_estadual_model->listarMesesKPIEst();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$data['dataExibicao'] = meses(date("m")).'/'.date("Y");				$primeiraData  = date('Y-m-d', strtotime('-365 days', strtotime($primeiroDia)));		$ultimaData  = $primeiroDia;			}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];				$primeiraData  = date($dataArr[0].'-'.$dataArr[1].'-01');		$ultimoDia = cal_days_in_month(CAL_GREGORIAN, $dataArr[1], $dataArr[0]);				$ultimaData  = date($dataArr[0].'-'.$dataArr[1].'-'.$ultimoDia);	}		$data['primeiroDia'] = $primeiroDia;		$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);	if($totalWMBR[0]['total'] == 0){				$data['WMBR'] = $this->kpi_dinamica('WMBR',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['WMBR'] =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);			}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);	if($totalBPBA[0]['total'] == 0){				$data['BPBA'] = $this->kpi_dinamica('BPBA',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['BPBA'] =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);			}		$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);	if($totalBPNE[0]['total'] == 0){				$data['BPNE'] = $this->kpi_dinamica('BPNE',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['BPNE'] =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);			}		$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);	if($totalWMS[0]['total'] == 0){				$data['WMS'] = $this->kpi_dinamica('WMS',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['WMS'] =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);			}			$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);	if($totalTB[0]['total'] == 0){				$data['TB'] = $this->kpi_dinamica('TB',$primeiroDia,$idContratante,'kpi_estadual');	}else{		$data['TB'] =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);			}		$this->load->view('header_pages_view',$data);	$this->load->view('graficoKpiEstadual', $data);	$this->load->view('footer_pages_view'); } function graficoKpiFederal(){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];	$data['perfil'] = $session_data['perfil'];		$data['meses'] = $this->cnd_estadual_model->listarMesesKPIFed();		if(empty($_POST)){		$primeiroDia = date("Y-m".'-01');		$data['dataExibicao'] = meses(date("m")).'/'.date("Y");				$primeiraData  = date('Y-m-d', strtotime('-365 days', strtotime($primeiroDia)));		$ultimaData  = $primeiroDia;			}else{		$primeiroDia = $_POST['data'];		$dataArr = explode("-",$primeiroDia);				$data['dataExibicao'] = meses($dataArr[1]).'/'.$dataArr[0];				$primeiraData  = date($dataArr[0].'-'.$dataArr[1].'-01');		$ultimoDia = cal_days_in_month(CAL_GREGORIAN, $dataArr[1], $dataArr[0]);				$ultimaData  = date($dataArr[0].'-'.$dataArr[1].'-'.$ultimoDia);	}		$data['primeiroDia'] = $primeiroDia;		$totalWMBR =  $this->cnd_estadual_model->listarTotalClientes('WMBR',$primeiroDia);	if($totalWMBR[0]['total'] == 0){				$data['WMBR'] = $this->kpi_dinamica('WMBR',$primeiroDia,$idContratante,'federal');	}else{		$data['WMBR'] =  $this->cnd_estadual_model->listarResumoClientes('WMBR',$primeiroDia);			}			$totalBPBA =  $this->cnd_estadual_model->listarTotalClientes('BPBA',$primeiroDia);	if($totalBPBA[0]['total'] == 0){				$data['BPBA'] = $this->kpi_dinamica('BPBA',$primeiroDia,$idContratante,'federal');	}else{		$data['BPBA'] =  $this->cnd_estadual_model->listarResumoClientes('BPBA',$primeiroDia);			}		$totalBPNE =  $this->cnd_estadual_model->listarTotalClientes('BPNE',$primeiroDia);	if($totalBPNE[0]['total'] == 0){				$data['BPNE'] = $this->kpi_dinamica('BPNE',$primeiroDia,$idContratante,'federal');	}else{		$data['BPNE'] =  $this->cnd_estadual_model->listarResumoClientes('BPNE',$primeiroDia);			}		$totalWMS =  $this->cnd_estadual_model->listarTotalClientes('WMS',$primeiroDia);	if($totalWMS[0]['total'] == 0){				$data['WMS'] = $this->kpi_dinamica('WMS',$primeiroDia,$idContratante,'federal');	}else{		$data['WMS'] =  $this->cnd_estadual_model->listarResumoClientes('WMS',$primeiroDia);			}			$totalTB =  $this->cnd_estadual_model->listarTotalClientes('TB',$primeiroDia);	if($totalTB[0]['total'] == 0){				$data['TB'] = $this->kpi_dinamica('TB',$primeiroDia,$idContratante,'federal');	}else{		$data['TB'] =  $this->cnd_estadual_model->listarResumoClientes('TB',$primeiroDia);			}				//print_r($data['alcon']);exit;		$this->load->view('header_pages_view',$data);	$this->load->view('graficoKpiFederal', $data);	$this->load->view('footer_pages_view'); } function montaHtmlCnd($cliente,$dataExibicao,$tipoCnd,$tipo){		$texto='';	if($tipoCnd == 'kpi_estadual'){		$texto ='ESTADUAIS';	}elseif($tipoCnd == 'kpi_mobiliaria'){		$texto ='MOBILIARIOS';	}elseif($tipoCnd == 'kpi_federal'){		$texto ='FEDERAL';	}		$empresa = $cliente[0]['nome_empresa'];	$title = "RESUMO - CERTIDÕES NEGATIVAS DE DÉBITOS ".$texto." - ".$dataExibicao;	$html='';	$html.='<p style="font-size:14px;text-align:center">'.$title.'</p>';	$html.='<table cellspacing="0" width="100%" style="font-size:12px">';	$html.='<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="7" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">'.$tipo.' </td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">EMITIDAS </td>		<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">PENDÊNCIAS </td>		<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O TRATADAS</td>				<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>		 ';		$totalPH = 0;		$totalPHEmit = 0;		$totalPHNEmit = 0;				foreach($cliente as $ph){ 			$totalPHEmit += $ph['emitidas'];			$totalPHNEmit += $ph['n_emitidas'];			$emitidas = $ph['emitidas'];			$naoEmitidas = $ph['n_emitidas'];			$pendentes = $ph['pendentes'];			$total = $ph['emitidas']+$ph['n_emitidas']+$ph['pendentes'];			$cnpj = $ph['cnpj'];			if($total == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($totalPHNEmit / $total)*100)),2)."%";			}							$html.='	  			 <tr style="background-color:#dedede;">									<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$emitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$pendentes.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$naoEmitidas.'</td>								<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$total.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold"> '.$porcPH.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>			  </tr>';							}//fim foreach				$html.=' 		</thead>		</table>';		  			return$html;}function montaHtml($cliente,$dataExibicao,$tipo){		$empresa = $cliente[0]['nome_empresa'];	$title = "RESUMO - CERTIDÕES NEGATIVAS DE DÉBITOS FEDERAIS - ".$dataExibicao;	$html='';	$html.='<p style="font-size:14px;text-align:center">'.$title.'</p>';	$html.='<table cellspacing="0" width="100%" style="font-size:12px">';		$html.='<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">'.$tipo.' </td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">V&Aacute;LIDAS </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O   V&Aacute;LIDAS</td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>		 ';		$totalPH = 0;		$totalPHEmit = 0;		$totalPHNEmit = 0;				foreach($cliente as $ph){ 			$totalPHEmit += $ph['emitidas'];			$totalPHNEmit += $ph['n_emitidas'];			$emitidas = $ph['emitidas']; 			$naoEmitidas = $ph['n_emitidas'];			$total = $emitidas + $naoEmitidas;			$cnpj = $ph['cnpj'];						$totalPH = $totalPHEmit+$totalPHNEmit;			if($totalPHNEmit == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($totalPHNEmit / $totalPH)*100)),2)."%";			}					$html.='	  				 <tr style="background-color:#dedede;">										<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>					<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$emitidas.'</td>					<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$naoEmitidas.'</td>					<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$totalPH.' </td>					<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold"> '.$porcPH.'   </td>					<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>				  </tr>';					  						}//fim foreach		$totalPH = $totalPHEmit+$totalPHNEmit;		if($totalPHNEmit == 0){			$porcPH =  100;		}else{				$porcPH = round((100 - (($totalPHNEmit / $totalPH)*100)),2)."%";		}			$html.=' 		</thead>		</table>';		  			return$html;}function montaHtmlVariosFederal($WMBR,$BPBA,$BPNE,$WMS,$TB,$dataExibicao){			$title = "RESUMO - CERTIDÕES NEGATIVAS DE DÉBITOS FEDERAIS - ".$dataExibicao;	$html='';	$html.='<p style="font-size:14px;text-align:center">'.$title.'</p>';	$html.='<table cellspacing="0" width="100%" style="font-size:12px">';	$html.='<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">WMBR </td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">V&Aacute;LIDAS </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O   V&Aacute;LIDAS</td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>		 ';		$total = 0;		  $emitidas = 0;		  $naoEmitidas = 0;		foreach($WMBR as $ph){ 			$emitidas = $ph['emitidas'];			$naoEmitidas = $ph['n_emitidas'];			$total = $emitidas + $naoEmitidas;			$cnpj = $ph['cnpj'];			if($naoEmitidas == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($naoEmitidas / $total)*100)),2)."%";			}								$html.='	  			 <tr style="background-color:#dedede;">									<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$emitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$naoEmitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$total.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold"> '.$porcPH.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>			  </tr>';		  			}//fim foreach				$html.='		<tr style="background-color:#fff;color:#fff!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold"><BR> </td>		</tr>		<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">BPBA </td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">V&Aacute;LIDAS </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O   V&Aacute;LIDAS</td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>';		  //bpba			$total = 0;		  $emitidas = 0;		  $naoEmitidas = 0;		  foreach($BPBA as $ph){ 						$emitidas = $ph['emitidas'];			$naoEmitidas = $ph['n_emitidas'];			$total = $emitidas + $naoEmitidas;			$cnpj = $ph['cnpj'];			if($naoEmitidas == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($naoEmitidas / $total)*100)),2)."%";			}					$html.='	  			 <tr style="background-color:#dedede;">									<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$emitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$naoEmitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$total.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold"> '.$porcPH.'   </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>			  </tr>';				  }//fim foreach		  		$html.='		<tr style="background-color:#fff;color:#fff!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold"><BR> </td>		</tr>		<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">BPNE </td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">V&Aacute;LIDAS </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O   V&Aacute;LIDAS</td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>';		  			  //bpne		  $total = 0;		  $emitidas = 0;		  $naoEmitidas = 0;		  foreach($BPNE as $ph){ 						$emitidas = $ph['emitidas'];			$naoEmitidas = $ph['n_emitidas'];			$total = $emitidas + $naoEmitidas;			$cnpj = $ph['cnpj'];			if($naoEmitidas == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($totalPHNEmit / $total)*100)),2)."%";			}					$html.='	  			 <tr style="background-color:#dedede;">									<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$emitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$naoEmitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$total.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold"> '.$porcPH.'   </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>			  </tr>';				  }//fim foreach		 		 		 $html.='		<tr style="background-color:#fff;color:#fff!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold"><BR> </td>		</tr>		<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">WMS </td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">V&Aacute;LIDAS </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O   V&Aacute;LIDAS</td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>';		  			  //wms		  $total = 0;		  $emitidas = 0;		  $naoEmitidas = 0;		  foreach($WMS as $ph){ 						$emitidas = $ph['emitidas'];			$naoEmitidas = $ph['n_emitidas'];			$total = $emitidas + $naoEmitidas;			$cnpj = $ph['cnpj'];			if($naoEmitidas == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($totalPHNEmit / $total)*100)),2)."%";			}					$html.='	  			 <tr style="background-color:#dedede;">									<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$emitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$naoEmitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$total.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold"> '.$porcPH.'   </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>			  </tr>';				  }//fim foreach		  		  $html.='		<tr style="background-color:#fff;color:#fff!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold"><BR> </td>		</tr>		<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="6" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">TB </td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">V&Aacute;LIDAS </td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O   V&Aacute;LIDAS</td>		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>';		  			  //tb		  $total = 0;		  $emitidas = 0;		  $naoEmitidas = 0;		  foreach($TB as $ph){ 						$emitidas = $ph['emitidas'];			$naoEmitidas = $ph['n_emitidas'];			$total = $emitidas + $naoEmitidas;			$cnpj = $ph['cnpj'];			if($naoEmitidas == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($naoEmitidas / $total)*100)),2)."%";			}					$html.='	  			 <tr style="background-color:#dedede;">									<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$emitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$naoEmitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:center;">'.$total.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold">'.$porcPH.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>			  </tr>';				  }//fim foreach		  		$html.='		  		  		</thead>			</table>';		return$html;}function montaHtmlVarios($dados,$dataExibicao,$tipoCnd){		if($tipoCnd == 'kpi_estadual'){		$tipo ='ESTADUAIS';	}elseif($tipoCnd == 'kpi_mobiliaria'){		$tipo ='MOBILIÁRIOS';	}else{		$tipo ='FEDERAIS';	}		$title = "RESUMO - CERTIDÕES NEGATIVAS DE DÉBITOS ".$tipo." - ".$dataExibicao;	$html='';	$html.='<p style="font-size:14px;text-align:center">'.$title.'</p>';	$html.='<table cellspacing="0" width="100%" style="font-size:12px">';	foreach($dados as $val){			$html.='<tr style="background-color:#002060;border:1px solid #002060!important;">		<td colspan="7" style="width:100%;color:#fff;text-align:center;font-weight:bold;border:1px solid #002060!important;">'.$val['descricao'].'</td>		</tr>   		<tr style="background-color:#01A8FE;color:#000!important;border:1px solid #002060!important;text-align:center;font-size:11px;">		<td style="width:20%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">CNPJ </td>		<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">EMITIDAS </td>		<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">PENDÊNCIAS </td>		<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">N&Atilde;O TRATADAS</td>				<td style="width:15%;border:1px solid #002060!important;font-size:9px!important;color:#fff;text-align:center;font-weight:bold">TOTAL </td>		<td style="width:10%;background-color:#DEDEDE;font-size:9px!important;" > </td>		<td style="width:10%;border-right:1px solid #dedede!important;background-color:#DEDEDE;font-size:9px!important;" > </td>		 </tr>		 		 ';		$total = 0;		$emitidas = 0;		$naoEmitidas = 0;		foreach($val['dados'] as $ph){ 			$emitidas = $ph['emitidas'];			$naoEmitidas = $ph['n_emitidas'];			$pendentes = $ph['pendentes'];			$total = $emitidas + $naoEmitidas + $pendentes;			$cnpj = $ph['cnpj'];			if($naoEmitidas == 0){				$porcPH =  '100%';			}else{					$porcPH = round((100 - (($naoEmitidas / $total)*100)),2)."%";			}							$html.='	  			 <tr style="background-color:#dedede;">									<td style="border:1px solid #002060!important;font-size:8px!important;color:#002060;text-align:left;">'.$cnpj.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;background-color:#fff;color:#002060;text-align:center;">'.$emitidas.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;background-color:#fff;color:#002060;text-align:center;">'.$pendentes.'</td>				<td style="border:1px solid #002060!important;font-size:8px!important;background-color:#fff;color:#002060;text-align:center;">'.$naoEmitidas.'</td>								<td style="border:1px solid #002060!important;font-size:8px!important;background-color:#fff;color:#002060;text-align:center;">'.$total.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;background-color:#fff;color:#fff;text-align:center;background-color:#01A8FE;font-weight:bold"> '.$porcPH.' </td>				<td style="border:1px solid #002060!important;font-size:8px!important;color:#fff;text-align:center;background-color:#002060;font-weight:bold"> 0% </td>			  </tr>			  <tr style="">				<td colspan="7" style="width:100%;"><br></td>			</tr> ';		  			}//fim foreach		}						  		$html.='	        				</thead>			</table>';				return$html;} function kpi_dinamica_grafico($cliente,$primeiraData,$ultimaData){		if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$idContratante = $_SESSION['cliente'] ;		$startDate = strtotime($primeiraData);	$endDate   = strtotime($ultimaData);	$currentDate = $endDate;	$datas = array();	$dados = array();	$i=0;	while ($currentDate >= $startDate) {		$datas[$i]['inicial'] = date('Y-m-01',$currentDate);		$datas[$i]['final'] = date('Y-m-t',$currentDate);		$currentDate = strtotime( date('Y/m/01/',$currentDate).' -1 month');		$i++;	}			$j=0;	//$data['pharma'] = $this->cnd_estadual_model->listarResumoClientesEntrePeriodoDinamicoEmitido('PHARMA',$primeiraData,$ultimaData);		foreach($datas as $dat){		$dados[$j]['mes_competencia'] = $dat['inicial'];		$totalEmitidasDebFiscal = $this->cnd_estadual_model->listarResumoClientesEntrePeriodoDinamicoEmitido('cnd_estadual_debito_fiscal',$cliente,$dat['inicial'],$dat['final']);				$totalEmitidasDivAtiv = $this->cnd_estadual_model->listarResumoClientesEntrePeriodoDinamicoEmitido('cnd_estadual_divida_ativa',$cliente,$dat['inicial'],$dat['final']);				$totalEmitidasAmbas = $this->cnd_estadual_model->listarResumoClientesEntrePeriodoDinamicoEmitido('cnd_estadual_ambas',$cliente,$dat['inicial'],$dat['final']);						$dados[$j]['emitidas'] = $totalEmitidasDebFiscal[0]['total'] + $totalEmitidasDivAtiv[0]['total'] + $totalEmitidasAmbas[0]['total'];								$totalNaoEmitidasDebFiscal = $this->cnd_estadual_model->listarResumoClientesEntrePeriodoDinamicoNaoEmitido('cnd_estadual_debito_fiscal',$cliente,$dat['inicial'],$dat['final']);			$totalNaoEmitidasDivAtiv = $this->cnd_estadual_model->listarResumoClientesEntrePeriodoDinamicoNaoEmitido('cnd_estadual_divida_ativa',$cliente,$dat['inicial'],$dat['final']);			$totalNaoEmitidasAmbas = $this->cnd_estadual_model->listarResumoClientesEntrePeriodoDinamicoNaoEmitido('cnd_estadual_ambas',$cliente,$dat['inicial'],$dat['final']);							$dados[$j]['nao_emitidas'] = $totalNaoEmitidasDebFiscal[0]['total'] + $totalNaoEmitidasDivAtiv[0]['total'] + $totalNaoEmitidasAmbas[0]['total'];		if($dados[$j]['emitidas'] == 0){			$dados[$j]['porc'] = 0;		}else{			$dados[$j]['porc'] = round((($dados[$j]['emitidas'] / ($dados[$j]['nao_emitidas'] + $dados[$j]['emitidas'])) * 100),2);		}		$j++;	}		return($dados); 	 } function visao_interna_cnd_fed(){   $this->logado();         $idTratativa = 0;			$data['idTratativa'] = $idTratativa;	$id = $this->input->get('id');	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$data['obs'] = $this->cnd_federal_model->buscaTodasObservacoes($id,4);		$data['imovel'] = $this->cnd_federal_model->listarInscricaoByLoja($id);		$cnpjString = substr($data['imovel'][0]->cpf_cnpj,0,5);	$data['id_cnd'] = $id;	$data['tratativas'] =  $this->cnd_federal_model->listarTodasTratativas($idContratante,$id);	$data['esferas'] = $this->cnd_federal_model->listarEsfera();	$data['origemPendencia'] = $this->cnd_federal_model->listarOrigemPendemcia();	$data['naturezaPendencia'] = $this->cnd_federal_model->listarNaturezaPendenciaFederal();	$data['agrupamento'] = $this->cnd_federal_model->listarAgrupamentoFederal();	$data['cnpjs'] = $this->cnd_federal_model->listarCnpjs($idContratante,$cnpjString);	$data['etapas'] = $this->cnd_federal_model->listarEtapa();	$data['statusInterno'] = $this->cnd_federal_model->listarStatusFederal();	$data['statusDemanda'] = $this->cnd_federal_model->listarStatusDemanda();	$data['areaFocal'] = $this->cnd_federal_model->listarAreaFocalFederal();		$data['empresa'] = $session_data['empresa'];	$data['nome_modulo'] = 'Cnd Federal';		$data['modulo'] = '4';			$data['usuarios']  = $this->user->dadosUsuarios();		$this->load->view('header_pages_view',$data);    $this->load->view('cnd_federal_visao_unica_view', $data);	$this->load->view('footer_pages_view');}function upload_obs(){			$session_data = $_SESSION['loginTeste'];		$data['controller'] = 'falencia_concordata';	$controller = 'falencia_concordata';		$id = $this->input->post('obsId');			$id_cnd_mob = $this->input->post('id_cnd_mob');			$modulo = $this->input->post('modulo');				$dados =  $this->cnd_estadual_model->listarUltimaObsTratById($id,$modulo);		$nome = rand($id_cnd_mob,$id);			$file = $_FILES["userfile"]["name"];					$extensao = str_replace('.','',strrchr($file, '.'));							$base = base_url();		        	$config['upload_path'] = './assets/observacoes/';			$config['allowed_types'] = '*';			$config['overwrite'] = 'true';					$config['file_name'] = $nome.'-'.$id_cnd_mob.'-'.$id.'.'.$extensao;					$this->load->library('upload', $config);		$this->upload->initialize($config);			$field_name = "userfile";					if (!$this->upload->do_upload($field_name)){					$error = array('error' => $this->upload->display_errors());								$_SESSION['mensagemIptu'] =  $this->upload->display_errors();	}else{					$dados = array(			'id_tratativas' => $id,			'arquivo' => $nome.'-'.$id_cnd_mob.'-'.$id.'.'.$extensao,			'modulo' => $modulo,		);									$this->cnd_estadual_model->inserirNovoArquivo($dados,$id);			$data = array('upload_data' => $this->upload->data($field_name));				$_SESSION['mensagemIptu'] =  UPLOAD;	}if($modulo == 1){	redirect('cnd_brasil/visao_interna_cnd_mob?id='.$id_cnd_mob, 'refresh');		 }elseif($modulo == 2){	redirect('cnd_brasil/visao_interna_cnd_imob?id='.$id_cnd_mob, 'refresh');		 }elseif($modulo == 3){	redirect('cnd_brasil/visao_interna_cnd_est?id='.$id_cnd_mob, 'refresh');		 }else{	redirect('cnd_brasil/visao_interna_cnd_fed?id='.$id_cnd_mob, 'refresh');		 }	}  function calcularDias(){	$dtAtendi = $this->input->get('dtAtendi');	$dataEnvio = $this->input->get('dataEnvio');		$dtAtendiArr = explode("/",$dtAtendi);			$dataEncerrArr = explode("/",$dataEnvio);				$dtAtend = $dtAtendiArr[2].'-'.$dtAtendiArr[1].'-'.$dtAtendiArr[0];	$dtEnvio = $dataEncerrArr[2].'-'.$dataEncerrArr[1].'-'.$dataEncerrArr[0];		$obj = array();	if($dtEnvio > $dtAtend){		$obj['status']=1;		$obj['dias']=0;	}else{		$obj['status']=0;		$result = $this->notificacao_model->calcularDias($dtAtend,$dtEnvio);		$obj['dias']=$result[0]->dias;			}		echo json_encode($obj);		}function apagarArquivosEst(){	 	$id = $this->input->get('id'); 	$idCnd = $this->input->get('idCnd'); 		$dados =  $this->cnd_federal_model->listarArquivosById($id);		if($dados[0]->tipo == 2){		$filename =  './assets/cnd_fed_pend/'.$dados[0]->arquivo;				}else{		$filename =  './assets/cnd_fed/'.$dados[0]->arquivo;				}		if (file_exists($filename)) {		unlink($filename);	}	 	$this->cnd_federal_model->apagarArquivoCnd($id);		redirect('/cnd_brasil/visao_interna_cnd_mob?id='.$idCnd);	  }	 function listaArquivosEst(){	$base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];		$id = $this->input->get('id');		$idArr = explode("-",$id);		$data ='';	$dados =  $this->cnd_federal_model->listarArquivos($idArr[1],$idArr[0]);		$base = $this->config->base_url();		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){						if(!empty($dado->arquivo)){				if($idArr[0] == 1){					$arquivo = "<a href=".$base."assets/cnd_fed/".$dado->arquivo." target='_blank'>  <i class='fa fa-download' aria-hidden='true'></i></a>";													}else{					$arquivo = "<a href=".$base."assets/cnd_fed_pend/".$dado->arquivo." target='_blank'>  <i class='fa fa-download' aria-hidden='true'></i></a>";								}				$excluir = "<a href=".$base."/index.php/cnd_brasil/apagarArquivosEst?id=".$dado->id_arquivo."&idCnd=".$idArr[1]." >  <i class='fa fa-trash' aria-hidden='true'></i></a>";						if($dado->observacao){					$observacao = $dado->observacao;				}else{					$observacao = 'Sem observação';				}				$data .= "<span>".$observacao."&nbsp; &nbsp; ".$arquivo."&nbsp; &nbsp;".$excluir."</span> <BR>";			}else{				$data .= "<span>Sem Arquivo</span> <BR>";				}					}	}else{		$data .= "<span>Sem Arquivo</span>";	}				echo json_encode($data);	 }  function enviar(){			$session_data = $_SESSION['loginTeste'];		$id = $this->input->post('id_cnd_mob');				$observacao = $this->input->post('observacao');		$tipo = $this->input->post('tipo');			$nome = rand(1,strtotime("now"));		$file = $_FILES["userfile"]["name"];					$extensao = str_replace('.','',strrchr($file, '.'));							$base = base_url();		        	if($tipo == 1){		$config['upload_path'] = './assets/cnd_fed/';			}else{		$config['upload_path'] = './assets/cnd_fed_pend/';			}		 if($_SESSION['loginTeste']['tipo_cnd'] == 2){  		$modulo = 2;	 }elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		 $modulo = 1;	 }else{		 $modulo = 3;	 }		 	$config['allowed_types'] = '*';			$config['overwrite'] = 'true';					$config['file_name'] = $nome.'.'.$extensao;					$this->load->library('upload', $config);		$this->upload->initialize($config);			$field_name = "userfile";					if (!$this->upload->do_upload($field_name)){					$error = array('error' => $this->upload->display_errors());								$_SESSION['mensagemIptu'] =  $this->upload->display_errors();				print_r($error);		echo '0'; 	}else{								$dados = array(			'observacao' => $observacao,			'tipo' => $tipo,			'id_cnd' => $id,			'modulo' => $modulo,			'arquivo' => $nome.'.'.$extensao		);						$this->cnd_federal_model->add_cnd($dados);					$data = array('upload_data' => $this->upload->data($field_name));				$_SESSION['mensagemIptu'] =  UPLOAD;		redirect('/cnd_brasil/visao_interna_cnd_mob?id='.$id);					}//redirect('/iptu/listar', 'refresh');		 } function subir_arquivo_chamado(){			$session_data = $_SESSION['loginTeste'];	$dataEnvio = $this->input->post('data_envio');		$dataEnvio = str_replace("/", "-", $dataEnvio);	$dataEnvio = strtotime($dataEnvio);		$tipo = $this->input->post('tipo');				$file = $_FILES["userfile"]["name"];					$extensao = str_replace('.','',strrchr($file, '.'));							$base = base_url();		        	$config['upload_path'] = './assets/chamados/';		$config['allowed_types'] = '*';			$config['overwrite'] = 'true';	  	if($tipo == 1){		$config['file_name'] = 'envio-'.$dataEnvio.'.'.$extensao;					}else{		$config['file_name'] = 'retorno-'.$dataEnvio.'.'.$extensao;					}	$this->load->library('upload', $config);		$this->upload->initialize($config);			$field_name = "userfile";					if (!$this->upload->do_upload($field_name)){					$error = array('error' => $this->upload->display_errors());								$_SESSION['mensagemIptu'] =  $this->upload->display_errors();			print_r($error);		echo '0'; 	}else{								if($tipo == 1){			$verificarChamado = $this->cnd_mobiliaria_model->listarChamadosByData($dataEnvio);			if($verificarChamado[0]->tem == 1){				$this->session->set_flashdata('messagemErro', 'Já existe um arquivo de envio para essa data, escolha outra data');			}else{				$dados = array(					'id_contratante'=>1,					'arquivo_envio' => 'envio-'.$dataEnvio.'.'.$extensao,					'data_envio' => $dataEnvio				);								$this->cnd_mobiliaria_model->add_arquivo_chamado($dados);				$data = array('upload_data' => $this->upload->data($field_name));					}						}else{			$verificarChamado = $this->cnd_mobiliaria_model->listarChamadosByData($dataEnvio);			if($verificarChamado[0]->tem == 1){								$dados = array(					'id_contratante'=>1,					'arquivo_retorno' => 'retorno-'.$dataEnvio.'.'.$extensao,					'data_retorno' => $dataEnvio				);					$this->cnd_mobiliaria_model->atualizar_arquivo_chamado($dados,$verificarChamado[0]->id);					$data = array('upload_data' => $this->upload->data($field_name));					}else{				$this->session->set_flashdata('messagemErro', 'Não existe arquivo de envio nessa data.');			}		}							}	redirect('/cnd_brasil/listar_chamados');} function enviarFederal(){			$session_data = $_SESSION['loginTeste'];	$data['controller'] = 'cnd_federal';	$id = $this->input->get('id');			$file = $_FILES["userfile"]["name"];					$extensao = str_replace('.','',strrchr($file, '.'));							$base = base_url();		        	$config['upload_path'] = './assets/federal/';			$config['allowed_types'] = '*';			$config['overwrite'] = 'true';					$config['file_name'] = 'cnd_federal-'.$id.'.'.$extensao;					$this->load->library('upload', $config);		$this->upload->initialize($config);			$field_name = "userfile";					if (!$this->upload->do_upload($field_name)){					$error = array('error' => $this->upload->display_errors());								$_SESSION['mensagemIptu'] =  $this->upload->display_errors();		echo '0'; 	}else{					$dadosLog = array(		'id_contratante' => $session_data['id_contratante'],		'tabela' => 'cnd_fed',		'id_usuario' => $session_data['id'],		'id_operacao' => $id,		'tipo' => 2,		'texto' => 'Upload de Arquivo CND Federal',		'data' => date("Y-m-d"),		'upload' => 1		);		$this->log_model->log($dadosLog);		$dados = array('arquivo_cnd' => 'cnd_federal-'.$id.'.'.$extensao);									$this->cnd_federal_model->atualizar($dados,$id);				$data = array('upload_data' => $this->upload->data($field_name));				$_SESSION['mensagemIptu'] =  UPLOAD;		echo'1';	}//redirect('/iptu/listar', 'refresh');		 } function enviar_pend(){			$session_data = $_SESSION['loginTeste'];	$id = $this->input->get('id');			$file = $_FILES["userfile"]["name"];					$extensao = str_replace('.','',strrchr($file, '.'));							$base = base_url();		        	$config['upload_path'] = './assets/cnd_fed_pend/';			$config['allowed_types'] = '*';			$config['overwrite'] = 'true';					$config['file_name'] = 'cnd_federal-'.$id.'.'.$extensao;					$this->load->library('upload', $config);		$this->upload->initialize($config);			$field_name = "userfile";					if (!$this->upload->do_upload($field_name)){					$error = array('error' => $this->upload->display_errors());								$_SESSION['mensagemIptu'] =  $this->upload->display_errors();		echo '0'; 	}else{				$dadosLog = array(		'id_contratante' => $session_data['id_contratante'],		'tabela' => 'cnd_fed',		'id_usuario' => $session_data['id'],		'id_operacao' => $id,		'tipo' => 2,		'texto' => 'Upload de Arquivo CND Federal - Pendência',		'data' => date("Y-m-d"),		'upload' => 1		);		$this->log_model->log($dadosLog);		$dados = array(			'arquivo_pendencias' => 'cnd_federal-'.$id.'.'.$extensao			);			$this->cnd_federal_model->atualizar($dados,$id);				$data = array('upload_data' => $this->upload->data($field_name));				$_SESSION['mensagemIptu'] =  UPLOAD;		echo'1';}//redirect('/iptu/listar', 'refresh');		 } function atualizar_cnd_tratativa(){	if(!$_SESSION['loginTeste']){		redirect('login', 'refresh');	}	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];	$idUsuario = $session_data['id'];			$id = $this->input->get('idCnd');	$possui_cnd = $this->input->get('status');	$data_vencto = $this->input->get('dataVecto');		if(empty($data_vencto)){		$dataVencto = '0000/00/00';	}else{		$arrDataVencto = explode("/",$data_vencto);						$dataVencto = $arrDataVencto[2].'/'.$arrDataVencto[1].'/'.$arrDataVencto[0];	}			$dataEmissao = $this->input->get('dataEmissao');		if(!empty($dataEmissao)){		$arrdataEmissao = explode("/",$dataEmissao);			$dataEmissao = $arrdataEmissao[2].'/'.$arrdataEmissao[1].'/'.$arrdataEmissao[0];	}else{		$dataEmissao ='1111-11-11';	}		$observacoes = $this->input->get('observacaoCnd');		$observacaoExtrato = $this->input->get('observacaoExtrato');			$dados = array(			//'inscricao' => $inscricao,			'id_contratante' => $idContratante,			'possui_cnd' => $possui_cnd,			'ativo' => 0,			'data_vencto' => $dataVencto,			'data_emissao' => $dataEmissao,			'data_pendencias' => $dataVencto,			'observacoes' => $observacoes,			'observacoes_extrato' => $observacaoExtrato,		);				$dadosAtuais = $this->cnd_federal_model->listarCNDById($id);	$dadosAlterados ='';	$arrDataAtual = explode("-",$dadosAtuais[0]->data_vencto);		$dataAtual = $arrDataAtual[2].'/'.$arrDataAtual[1].'/'.$arrDataAtual[0];	$arrDataPAtual = explode("-",$dadosAtuais[0]->data_pendencias);		$dataPAtual = $arrDataPAtual[2].'/'.$arrDataPAtual[1].'/'.$arrDataPAtual[0];	if($dadosAtuais[0]->possui_cnd <> $possui_cnd){		if($dadosAtuais[0]->possui_cnd == 1){			$dadosAlterados .= ' - Possui CND: Sim';			if($dadosAtuais[0]->data_vencto <> $dataVencto){				$dadosAlterados .= ' - Data Vencimento: '.$dataAtual;						}		}else if($dadosAtuais[0]->possui_cnd == 2){			$dadosAlterados .= ' - Possui CND: Não';			if($dadosAtuais[0]->data_vencto <> $dataVencto){				$dadosAlterados .= ' - Data Vencimento: '.$dataAtual;						}					}		else{			$dadosAlterados .= ' - Possui CND: Pendência';					if($dadosAtuais[0]->data_pendencias <> $dataVencto){				$dadosAlterados .= ' - Data Pendência: '.$dataPAtual;						}		}	}	if($dadosAtuais[0]->observacoes <> $observacoes){		$dadosAlterados .= ' - Observações: '.$dadosAtuais[0]->observacoes;		}	if(!empty($dadosAlterados)){		$dadosLog = array(		'id_contratante' => $idContratante,		'tabela' => 'cnd_imob',		'id_usuario' => $idUsuario,		'id_operacao' => $id,		'tipo' => 2,		'texto' => $dadosAlterados,		'data' => date("Y-m-d"),		);		$this->log_model->log($dadosLog);	}		$this->cnd_federal_model->atualizar($dados,$id);		echo 1; } function visao_interna_cnd_est(){   $this->logado();         $idTratativa = 0;	$data['idTratativa'] = $idTratativa;	$id = $this->input->get('id');	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];	$idContratante = $session_data['id_contratante'];		$data['obs'] = $this->cnd_estadual_model->buscaTodasObservacoes($id,3);		$data['imovel'] = $this->cnd_estadual_model->listarInscricaoByLoja($id);		$data['id_cnd'] = $id;	$data['tratativas'] =  $this->cnd_estadual_model->listarTodasTratativasEst($idContratante,$id,3);	$data['esferas'] = $this->cnd_estadual_model->listarEsfera();	$data['etapas'] = $this->cnd_estadual_model->listarEtapa();	$data['statusInterno'] = $this->cnd_estadual_model->listarStatusInterno();	$data['statusCnpj'] = $this->cnd_estadual_model->listarStatusCnpj();	//$data['statusDemanda'] = $this->cnd_estadual_model->listarStatusDemanda();		$data['empresa'] = $session_data['empresa'];	$data['nome_modulo'] = 'Cnd Estadual';		$data['modulo'] = '3';			$data['usuarios']  = $this->user->dadosUsuarios();		$this->load->view('header_pages_view',$data);    $this->load->view('cnd_estadual_visao_unica_view', $data);	$this->load->view('footer_pages_view');} function visao_interna_cnd_mob(){   $this->logado();        if(empty($_SESSION['idTratativa'])){		$idTratativa = 0;	}else{		$idTratativa = $_SESSION['idTratativa'];	}			$data['idTratativa'] = $idTratativa;	$id = $this->input->get('id');	$session_data = $_SESSION['loginTeste'];	$data['email'] = $session_data['email'];	$data['empresa'] = $session_data['empresa'];	$data['perfil'] = $session_data['perfil'];		$idContratante = $session_data['id_contratante'];		$data['obs'] = $this->cnd_mobiliaria_model->buscaTodasObservacoes($id,1);		$data['imovel'] = $this->cnd_mobiliaria_model->listarInscricaoByLoja($id);		// if($data['imovel'][0]->total == 0){		// redirect('cnd_brasil/cnd_lista', 'refresh');	// }	$data['valorTotalPendencia'] = $this->cnd_mobiliaria_model->listarInscricaoByLoja($id);			$data['id_cnd'] = $id;	$data['tratativas'] =  $this->cnd_mobiliaria_model->listarTodasTratativas($idContratante,$id,$_SESSION['loginTeste']['tipo_cnd']);	$data['esferas'] = $this->cnd_mobiliaria_model->listarEsfera();	$data['etapas'] = $this->cnd_mobiliaria_model->listarEtapa();	$data['area_focal'] = $this->cnd_mobiliaria_model->listarAreaFocal();	$data['natureza_raiz'] = $this->cnd_mobiliaria_model->listarNaturezaRaiz();	$data['statusInterno'] = $this->cnd_mobiliaria_model->listarStatusInterno();	//$data['statusDemanda'] = $this->cnd_mobiliaria_model->listarStatusDemanda();		$data['empresa'] = $session_data['empresa'];	$data['nome_modulo'] = 'Cnd Mobiliária';		$data['modulo'] = '1';			$data['usuarios']  = $this->user->dadosUsuarios();		if(empty($session_data['visitante'])){		$data['visitante'] = 0;	}else{		$data['visitante'] = $session_data['visitante'];		}	$data['adm'] = $session_data['adm'];			if($_SESSION['loginTeste']['tipo_cnd'] == 2){  		$data['nome'] = "Estadual";	 }elseif($_SESSION['loginTeste']['tipo_cnd'] ==1){		 $data['nome'] = "Mobiliária";	 }else{		 $data['nome'] = "Federal";	 }		 	$this->load->view('header_pages_view',$data);    $this->load->view('cnd_mob_visao_unica_view', $data);	$this->load->view('footer_pages_view');} function logado(){	if(empty($_SESSION['loginTeste'])){		redirect('login', 'refresh');	} 	 }   function listaArquivosMob(){	$base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];	//$idContratante = $_SESSION['id_contratante'] ;	$id = $this->input->get('id');	$controller = 'cnd_estadual';	$data ='';	$dados =  $this->cnd_mobiliaria_model->listarArquivosMobiliaria($id);		$base = $this->config->base_url();		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){						if(!empty($dado->arquivo)){				$arquivo = "<a href=".$base."assets/observacoes/".$dado->arquivo." target='_blank'>  <i class='fa fa-download' aria-hidden='true'></i></a>";								$data .= "<span>".$dado->arquivo." ".$arquivo."</span> <BR>";			}else{				$data .= "<span>Sem Arquivo</span> <BR>";				}					}	}else{		$data .= "<span>Sem Arquivo</span>";	}				echo json_encode($data);	 }	  function listaArquivosEstadual(){	$base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];	//$idContratante = $_SESSION['id_contratante'] ;	$id = $this->input->get('id');	$controller = 'cnd_estadual';	$data ='';	$dados =  $this->cnd_estadual_model->listarArquivosEstadual($id);		$base = $this->config->base_url();		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){						if(!empty($dado->arquivo)){				$arquivo = "<a href=".$base."assets/observacoes/".$dado->arquivo." target='_blank'>  <i class='fa fa-download' aria-hidden='true'></i></a>";								$data .= "<span>".$dado->arquivo." ".$arquivo."</span> <BR>";			}else{				$data .= "<span>Sem Arquivo</span> <BR>";				}					}	}else{		$data .= "<span>Sem Arquivo</span>";	}				echo json_encode($data);	 }	  function listaArquivosFederal(){	$base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];	//$idContratante = $_SESSION['id_contratante'] ;	$id = $this->input->get('id');	$controller = 'cnd_estadual';	$data ='';	$dados =  $this->cnd_federal_model->listarArquivosFederal($id);		$base = $this->config->base_url();		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){						if(!empty($dado->arquivo)){				$arquivo = "<a href=".$base."assets/observacoes/".$dado->arquivo." target='_blank'>  <i class='fa fa-download' aria-hidden='true'></i></a>";								$data .= "<span>".$dado->arquivo." ".$arquivo."</span> <BR>";			}else{				$data .= "<span>Sem Arquivo</span> <BR>";				}					}	}else{		$data .= "<span>Sem Arquivo</span>";	}				echo json_encode($data);	 }	   function excluirTratativa(){	$id = $this->input->get('id');		$this->cnd_estadual_model->excluirTratativa($id);		$obj['tem'] = 0; 		echo(json_encode($obj));	 }    function listaObsTratEst(){	$base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];	//$idContratante = $_SESSION['id_contratante'] ;	$id = $this->input->get('id');	$modulo = $this->input->get('modulo');	$controller = 'cnd_estadual';	$data ='';	$dados =  $this->cnd_estadual_model->listarObsTratById($id,$_SESSION['loginTeste']['tipo_cnd']);		$base = $this->config->base_url();		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){						if($session_data['adm'] == 2){				$excluir = " - <i style='color: rgb(0, 176, 240);' title='Excluir Tratativa' class='fa fa-trash excluirTratativa' id=".$dado->id." aria-hidden='true'></i>";							}else{				$excluir ="";			}						$arquivo = "<i style='color: rgb(0, 176, 240);' class='fa fa-eye ver_arquivo' id=".$dado->id." aria-hidden='true'></i>";							$data .= "<span>".$dado->data.' - '.$dado->hora.' - '.$dado->email.' - '.$dado->observacao.' - '.$arquivo." ".$excluir."	</span> <BR>";									//$arquivo = "<i style='color: rgb(0, 176, 240);' class='fa fa-eye ver_arquivo' id=".$dado->id." aria-hidden='true'></i>";							//$data .= "<span>".$dado->data.' - '.$dado->hora.' - '.$dado->email.' - '.$dado->observacao.' - '.$arquivo."	</span> <BR>";					}	}else{		$data .= "0";	}				echo json_encode($data);	 }	    function listaObsTrat(){	$base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];	//$idContratante = $_SESSION['id_contratante'] ;	$id = $this->input->get('id');	$controller = 'cnd_estadual';	$data ='';	$dados =  $this->cnd_federal_model->listarObsTratById($id);	$base = $this->config->base_url();		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){						$arquivo = "<i style='color: rgb(0, 176, 240);' class='fa fa-eye ver_arquivo' id=".$dado->id." aria-hidden='true'></i>";							$data .= "<span >".$dado->data.' - '.$dado->hora.' - '.$dado->email.' - '.$dado->observacao.' - '.$arquivo."	</span> <BR>";		}	}else{		$data .= "0";	}				echo json_encode($data);	 }	     function listaObsTratCheckFederal(){	 $base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$id = $this->input->get('id');	$data ='';	$dados =  $this->cnd_federal_model->listarObsTratById($id);		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){			$data .= "<span> <input type='radio' name='obsId' value='$dado->id'>".$dado->data.' - '.$dado->hora.' - '.$dado->email.' - '.$dado->observacao."	</span> <BR>";		}	}else{		$data .= "<span></span>";	}				echo json_encode($data);	 }	   function listaObsTratCheck(){	 $base = $this->config->base_url().'index.php';	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$id = $this->input->get('id');	$controller = 'cnd_estadual';	$data ='';	$dados =  $this->cnd_mobiliaria_model->listarObsTratById($id);		$isArrayLog =  is_array($dados) ? '1' : '0';	if($isArrayLog == 1) {		foreach($dados as $dado){			$data .= "<span> <input type='radio' name='obsId' value='$dado->id'>".$dado->data.' - '.$dado->hora.' - '.$dado->email.' - '.$dado->observacao."	</span> <BR>";		}	}else{		$data .= "<span></span>";	}				echo json_encode($data);	 }	   function listarTratativaEstById(){	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$id = $this->input->get('id');		$data = array();	$dados =  $this->cnd_estadual_model->listarTodasTratativasEstById($idContratante,$id);	$data['id'] = $dados[0]->id;	$data['tipo_tratativa'] = $dados[0]->tipo_tratativa;	$data['id_cnd_mob'] = $dados[0]->id_cnd_mob;		$data['auto'] = $dados[0]->auto;	$data['natureza'] = $dados[0]->natureza;	$data['inscricao'] = $dados[0]->inscricao;	$data['processo'] = $dados[0]->processo;	$data['principal'] = $dados[0]->principal;		$data['multa'] = $dados[0]->multa;	$data['juros'] = $dados[0]->juros;	$data['valor_total'] = $dados[0]->valor_total;	$data['garantia'] = $dados[0]->garantia;		$data['responsavel'] = $dados[0]->responsavel;	$data['pasta'] = $dados[0]->pasta;	$data['contato'] = $dados[0]->contato;	$data['escritorio'] = $dados[0]->escritorio;		$data['data_envio_bd'] = $dados[0]->data_envio_bd;	$data['prazo_solucao_bd'] = $dados[0]->prazo_solucao_bd;	$data['data_encerramento_bd'] = $dados[0]->data_encerramento_bd;	$data['escritorio'] = $dados[0]->escritorio;		$data['sla'] = $dados[0]->sla;	$data['status_tratativa'] = $dados[0]->status_tratativa;			echo json_encode($data);	} function listarTratativaMobById(){	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$id = $this->input->get('id');		$data = array();	$dados =  $this->cnd_mobiliaria_model->listarTratativaById($idContratante,$id);				$data['id'] = $dados[0]->id;	$data['tipo_tratativa'] = $dados[0]->tipo_tratativa;	$data['pendencia'] = $dados[0]->pendencia;	$data['esfera'] = $dados[0]->esfera;	$data['etapa'] = $dados[0]->etapa;	$data['data_informe_pendencia'] = $dados[0]->data_informe_pendencia;	$data['id_sis_ext'] = $dados[0]->id_sis_ext;	$data['data_inclusao_sis_ext'] = $dados[0]->data_inclusao_sis_ext;	$data['prazo_solucao_sis_ext'] = $dados[0]->prazo_solucao_sis_ext;	$data['data_encerramento_sis_ext'] = $dados[0]->data_encerramento_sis_ext;	$data['status_chamado_sis_ext'] = $dados[0]->status_chamado_sis_ext;	$data['id_sla_sis_ext'] = $dados[0]->sla_sis_ext;	$data['usu_inc'] = $dados[0]->usu_inc;	$data['area_focal'] = $dados[0]->area_focal;	$data['sub_area_focal'] = $dados[0]->sub_area_focal;	$data['contato'] = $dados[0]->contato;	$data['data_envio'] = $dados[0]->data_envio;	$data['prazo_solucao'] = $dados[0]->prazo_solucao;	$data['data_retorno'] = $dados[0]->data_retorno;	$data['sla'] = $dados[0]->sla;	$data['status_demanda'] = $dados[0]->status_demanda;	$data['esc_data_prazo_um'] = $dados[0]->esc_data_prazo_um;	$data['esc_data_retorno_um'] = $dados[0]->esc_data_retorno_um;	$data['esc_status_um'] = $dados[0]->esc_status_um;	$data['esc_data_prazo_dois'] = $dados[0]->esc_data_prazo_dois;	$data['esc_data_retorno_dois'] = $dados[0]->esc_data_retorno_dois;	$data['esc_status_dois'] = $dados[0]->esc_status_dois;	$data['esc_data_prazo_tres'] = $dados[0]->esc_data_prazo_tres;	$data['esc_data_retorno_tres'] = $dados[0]->esc_data_retorno_tres;	$data['esc_status_tres'] = $dados[0]->esc_status_tres;	$data['codigo_natureza_raiz'] = $dados[0]->codigo_natureza_raiz;	$data['codigo_area_focal'] = $dados[0]->codigo_area_focal;	$data['valor_pendencia'] = $dados[0]->valor_pendencia;	echo json_encode($data);	}	 function listarTratativaById(){	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$id = $this->input->get('id');		$data = array();	$dados =  $this->cnd_federal_model->listarTratativaById($idContratante,$id);		$data['id'] = $dados[0]->id_tratativa;	$data['tipo_tratativa'] = $dados[0]->tipo_tratativa;	$data['pendencia'] = $dados[0]->pendencia;	$data['esfera'] = $dados[0]->esfera;	$data['etapa'] = $dados[0]->etapa;	$data['data_informe_pendencia'] = $dados[0]->data_informe_pendencia;	$data['id_sis_ext'] = $dados[0]->id_sis_ext;	$data['data_inclusao_sis_ext'] = $dados[0]->data_inclusao_sis_ext;	$data['prazo_solucao_sis_ext'] = $dados[0]->prazo_solucao_sis_ext;	$data['data_encerramento_sis_ext'] = $dados[0]->data_encerramento_sis_ext;	$data['status_chamado_sis_ext'] = $dados[0]->status_chamado_sis_ext;	$data['id_sla_sis_ext'] = $dados[0]->sla_sis_ext;	$data['usu_inc'] = $dados[0]->usu_inc;	$data['area_focal'] = $dados[0]->area_focal;	$data['sub_area_focal'] = $dados[0]->sub_area_focal;	$data['contato'] = $dados[0]->contato;	$data['data_envio'] = $dados[0]->data_envio;	$data['prazo_solucao'] = $dados[0]->prazo_solucao;	$data['data_retorno'] = $dados[0]->data_retorno;	$data['sla'] = $dados[0]->sla;	$data['status_demanda'] = $dados[0]->status_demanda;	$data['esc_data_prazo_um'] = $dados[0]->esc_data_prazo_um;	$data['esc_data_retorno_um'] = $dados[0]->esc_data_retorno_um;	$data['esc_status_um'] = $dados[0]->esc_status_um;	$data['esc_data_prazo_dois'] = $dados[0]->esc_data_prazo_dois;	$data['esc_data_retorno_dois'] = $dados[0]->esc_data_retorno_dois;	$data['esc_status_dois'] = $dados[0]->esc_status_dois;	$data['esc_data_prazo_tres'] = $dados[0]->esc_data_prazo_tres;	$data['esc_data_retorno_tres'] = $dados[0]->esc_data_retorno_tres;	$data['esc_status_tres'] = $dados[0]->esc_status_tres;	$data['cnpj_pendencia'] = $dados[0]->cnpj_pendencia;	$data['origem_pendencia'] = $dados[0]->origem_pendencia;	$data['natureza_pendencia'] = $dados[0]->natureza_pendencia;	$data['agrupamento'] = $dados[0]->agrupamento;	$data['inscricao_divida_ativa'] = $dados[0]->inscricao_divida_ativa;	$data['processo'] = $dados[0]->processo;	$data['debito_cobranca_rfb'] = $dados[0]->debito_cobranca_rfb;	$data['debito_cobranca_pgfn'] = $dados[0]->debito_cobranca_pgfn;	$data['descricao_pendencia'] = $dados[0]->descricao_pendencia;	$data['valor_pendencia'] = $dados[0]->valor_pendencia;	echo json_encode($data);	}	function export_tratativas_ext_fed(){		$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$id = $this->input->get('id');	$dados = $this->cnd_federal_model->listarInscricaoByLoja($id);		$this->csvTratativaFedExt($dados);	  }  function export_tratativas_ext(){		$id = $this->input->get('id');	$dados = $this->cnd_mobiliaria_model->listarInscricaoByLoja($id);		$this->csvTratativaMobExt($dados);	  }   function csvTratativaMobExt($result){	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];			if($_SESSION['loginTeste']['tipo_cnd'] == 2){  		$file="cnd_estadual.xls";	 }elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		 $file="cnd_mobiliaria.xls";	 }else{		 $file="cnd_federal.xls";	 }		 		if($result == 0){			$test="<table border=1>		<tr>		<td>N&atilde;o H&aacute; Dados Para Esse Filtro</td>		</tr>		";		$test .='</table>';    }else{				$test="<table border=1>			<tr>			<td>Estado</td>			<td>Cidade</td>			<td>Bairro</td>			<td>Endere&ccedil;o</td>			<td>N&uacute;mero</td>			<td>CEP</td>			<td>Unidade</td>			<td>Emitente</td>			<td>CPF/CNPJ</td>			</tr>			";			foreach($result as $key => $iptu){ 				 $dadosLog = $this->log_model->listarLog($iptu->id_cnd,'cnd_mob');							 $isArrayLog =  is_array($dadosLog) ? '1' : '0';			 			 $dataEmissao = $this->cnd_mobiliaria_model->listarDataEmissao($iptu->id_cnd,'falencia');														$cor='#fff';				$test .= "<tr >";				$test .= "<td>".utf8_decode($iptu->estado)."</td>";				$test .= "<td>".utf8_decode($iptu->cidade)."</td>";				$test .= "<td>".utf8_decode($iptu->bairro)."</td>";				$test .= "<td>".utf8_decode($iptu->endereco)."</td>";				$test .= "<td>".utf8_decode($iptu->numero)."</td>";				$test .= "<td>".utf8_decode($iptu->cep)."</td>";				$test .= "<td>".utf8_decode($iptu->nome)."</td>";				$test .= "<td>".utf8_decode($iptu->nome_fantasia)."</td>";								$test .= "<td>".utf8_decode($iptu->cpf_cnpj)."</td>";				//$test .= "<td>".utf8_decode($cnd)."</td>";				//$test .= "<td>".utf8_decode($iptu->data_emissao_br)."</td>";								//$test .= "<td>".utf8_decode($dataV)."</td>";				//$test .= "<td>".utf8_decode($iptu->descricao)."</td>";				//$test .= "<td>".utf8_decode($iptu->descricao_bandeira)."</td>";				//$test .= "<td>".utf8_decode($iptu->cc)."</td>";				//$test .= "<td>".utf8_decode($iptu->cod1)."</td>";				//$test .= "<td>".utf8_decode($iptu->cod1)."</td>";				$test .= "</tr>";			}								$dadosPendencia = $this->cnd_mobiliaria_model->listarTratativasIdCnd($iptu->id_cnd);												$test .= "<tr >";				$test .= "<td >".utf8_decode('Tratativa')."</td>";				$test .= "<td >".utf8_decode('Pendência')."</td>";				$test .= "<td >".utf8_decode('Tipo Pendência')."</td>";				$test .= "<td >".utf8_decode('Esfera')."</td>";				$test .= "<td >".utf8_decode('Etapa')."</td>";				$test .= "<td >".utf8_decode('Tratativa da Pendência')."</td>";				$test .= "<td >".utf8_decode('Área Focal')."</td>";				$test .= "<td >".utf8_decode('Sub Área Focal')."</td>";				$test .= "<td >".utf8_decode('Contato')."</td>";				$test .= "<td >".utf8_decode('Data Envio')."</td>";				$test .= "<td >".utf8_decode('Status Chamado')."</td>";				$test .= "<td >".utf8_decode('Data Encerramento')."</td>";				$test .= "<td >".utf8_decode('Histórico')."</td>";							$test .= "</tr>";				foreach($dadosPendencia as $key => $pend){ 										$observacoes='';										$observacoes ='';					$dados =  $this->cnd_mobiliaria_model->listarObsTratById($pend->id);					 $isArrayHist =  is_array($dados) ? '1' : '0';					 if($isArrayHist == 1){						foreach($dados as $dado){							$observacoes .= $dado->data.' - '.$dado->hora.' - '.$dado->email.' - '.$dado->observacao."<BR>";						} 					 }else{						$observacoes .= 'Sem históricos';					  }					  					  					if($pend->tipo_tratativa == 1){						$tipoTratavia ='Áreas Externas';					}else{						$tipoTratavia ='Áreas Internas';					}					if($pend->status_chamado_sis_ext ==1){						$statusChamado ='Em Atendimento';					}elseif($pend->status_chamado_sis_ext ==2){						$statusChamado ='Cancelado';					}elseif($pend->status_chamado_sis_ext ==3){						$statusChamado ='Encerrado';					}else{						$statusChamado ='Sem Status Definido';					}					$test .= "<tr >";					$test .= "<td >".utf8_decode($pend->id)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_natureza_raiz)."</td>";					$test .= "<td >".utf8_decode($pend->pendencia)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_esfera)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_etapa)."</td>";					$test .= "<td >".utf8_decode($tipoTratavia)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_area_focal)."</td>";					$test .= "<td >".utf8_decode($pend->sub_area_focal)."</td>";					$test .= "<td >".utf8_decode($pend->contato)."</td>";					$test .= "<td >".utf8_decode($pend->data_envio)."</td>";					$test .= "<td >".utf8_decode($statusChamado)."</td>";					$test .= "<td >".utf8_decode($pend->data_encerramento_sis_ext)."</td>";					$test .= "<td >".utf8_decode($observacoes)."</td>";															$test .= "</tr>";				}							$test .='</table>';		}				header("Content-type: application/vnd.ms-excel");		header("Content-Disposition: attachment; filename=$file");		echo $test;	 }   function csvTratativaFedExt($result){	$file="cnd_federal.xls";	if($result == 0){			$test="<table border=1>		<tr>		<td>N&atilde;o H&aacute; Dados Para Esse Filtro</td>		</tr>		";		$test .='</table>';    }else{				$test="<table border=1>			<tr>			<td>Estado</td>			<td>Regional</td>			<td>CNPJ</td>			<td>CNPJ por regi&atilde;o</td>			</tr>			";						foreach($result as $key => $iptu){ 					$cnpjRegiao = explode("/",$iptu->cpf_cnpj);				$cor='#fff';				$test .= "<tr >";				$test .= "<td>".utf8_decode($iptu->estado)."</td>";				$test .= "<td>".utf8_decode($iptu->descricao)."</td>";				$test .= "<td>".utf8_decode($iptu->cpf_cnpj)."</td>";				$test .= "<td>".utf8_decode($cnpjRegiao[0])."</td>";				$test .= "</tr>";			}				$session_data = $_SESSION['loginTeste'];				$idContratante = $session_data['id_contratante'];					$dadosPendencia = $this->cnd_federal_model->listarTratativaById($idContratante ,$iptu->id);												$test .= "<tr >";				$test .= "<td >".utf8_decode('Origem Pendência')."</td>";				$test .= "<td >".utf8_decode('Natureza Pendência')."</td>";				$test .= "<td >".utf8_decode('Agrupamento')."</td>";				$test .= "<td >".utf8_decode('Número da Inscrição')."</td>";				$test .= "<td >".utf8_decode('Nr. do Processo')."</td>";				$test .= "<td >".utf8_decode('Descrição da pendência')."</td>";				$test .= "<td >".utf8_decode('Valor da pendência')."</td>";				$test .= "<td >".utf8_decode('Tratativa da Pendência')."</td>";				$test .= "<td >".utf8_decode('Área Focal')."</td>";				$test .= "<td >".utf8_decode('Contato')."</td>";				$test .= "<td >".utf8_decode('Data Envio')."</td>";				$test .= "<td >".utf8_decode('Status Chamado')."</td>";				$test .= "<td >".utf8_decode('Data Encerramento')."</td>";				$test .= "<td >".utf8_decode('Histórico')."</td>";							$test .= "</tr>";				foreach($dadosPendencia as $key => $pend){ 										$observacoes='';										$observacoes ='';					$dados =  $this->cnd_mobiliaria_model->listarObsTratById($pend->id);					 $isArrayHist =  is_array($dados) ? '1' : '0';					 if($isArrayHist == 1){						foreach($dados as $dado){							$observacoes .= $dado->data.' - '.$dado->hora.' - '.$dado->email.' - '.$dado->observacao."<BR>";						} 					 }else{						$observacoes .= 'Sem históricos';					  }					  					  					if($pend->tipo_tratativa == 1){						$tipoTratavia ='Áreas Externas';					}else{						$tipoTratavia ='Áreas Internas';					}					if($pend->status_chamado_sis_ext ==1){						$statusChamado ='Em Atendimento';					}elseif($pend->status_chamado_sis_ext ==2){						$statusChamado ='Cancelado';					}elseif($pend->status_chamado_sis_ext ==3){						$statusChamado ='Encerrado';					}else{						$statusChamado ='Sem Status Definido';					}					$test .= "<tr >";					$test .= "<td >".utf8_decode($pend->descricao_origem)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_natureza)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_agrupamento)."</td>";					$test .= "<td >".utf8_decode($pend->inscricao_divida_ativa)."</td>";					$test .= "<td >".utf8_decode($pend->processo)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_pendencia)."</td>";					$test .= "<td >".utf8_decode($pend->valor_pendencia)."</td>";					$test .= "<td >".utf8_decode($tipoTratavia)."</td>";					$test .= "<td >".utf8_decode($pend->descricao_area_focal)."</td>";					$test .= "<td >".utf8_decode($pend->contato)."</td>";					$test .= "<td >".utf8_decode($pend->data_envio)."</td>";					$test .= "<td >".utf8_decode($statusChamado)."</td>";					if($pend->data_encerramento_sis_ext == '11/11/1111'){						$test .= "<td ></td>";					}else{						$test .= "<td >".utf8_decode($pend->data_encerramento_sis_ext)."</td>";					}										$test .= "<td >".utf8_decode($observacoes)."</td>";															$test .= "</tr>";				}							$test .='</table>';		}				header("Content-type: application/vnd.ms-excel");		header("Content-Disposition: attachment; filename=$file");		echo $test;	 } function atualizar_cnd_imob_tratativa_unica(){		 $this->logado();	 	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$idUsu = $session_data['id'];	$acao 	= $this->input->post('acao');			$data_entrada_cadin 	= $this->input->post('data_entrada_cadin');			if(empty($data_entrada_cadin)){		$dtCadin = '1111-11-11';		}else{		$dtCadinArr = explode("/",$data_entrada_cadin);			$dtCadin = $dtCadinArr[2].'-'.$dtCadinArr[1].'-'.$dtCadinArr[0];	}	$id_cnd 	= $this->input->post('id');	$tipo_tratativa 	= $this->input->post('tipo_tratativa');	if(empty($tipo_tratativa)){		$tipo_tratativa = $this->input->post('tipo_tratativa_bd');	}	$id_tratativa 	= $this->input->post('id_tratativa');	$id_pendencia 	= $this->input->post('id_pendencia');	$id_esfera 	= $this->input->post('id_esfera');	$id_etapa 	= $this->input->post('id_etapa');	$data_informe_pendencia 	= $this->input->post('data_informe_pendencia');	$id_sis_ext 	= $this->input->post('id_sis_ext');	$data_inclusao_sis_ext 	= $this->input->post('data_inclusao_sis_ext');	$prazo_solucao_sis_ext 	= $this->input->post('prazo_solucao_sis_ext');	$data_encerramento_sis_ext 	= $this->input->post('data_encerramento_sis_ext');	$status_chamado_sis_ext 	= $this->input->post('status_chamado_sis_ext');		$id_sla = $this->input->post('id_sla');		if(empty($id_sla)){		$id_sla = 0;	}		$usu_inc 	= $this->input->post('usu_inc');	$area_focal 	= $this->input->post('area_focal');	$sub_area_focal 	= $this->input->post('sub_area_focal');	$contato 	= $this->input->post('contato');	$data_envio 	= $this->input->post('data_envio');	$prazo_solucao 	= $this->input->post('prazo_solucao');	$data_retorno 	= $this->input->post('data_retorno');	$sla 	= $this->input->post('sla');	$status_demanda 	= $this->input->post('status_demanda');	$esc_data_prazo_um 	= $this->input->post('esc_data_prazo_um');	$esc_data_retorno_um 	= $this->input->post('esc_data_retorno_um');	$esc_status_um 	= $this->input->post('esc_status_um');	$esc_data_prazo_dois 	= $this->input->post('esc_data_prazo_dois');	$esc_data_retorno_dois 	= $this->input->post('esc_data_retorno_dois');	$esc_status_dois 	= $this->input->post('esc_status_dois');	$esc_data_prazo_tres 	= $this->input->post('esc_data_prazo_tres');	$esc_data_retorno_tres 	= $this->input->post('esc_data_retorno_tres');	$esc_status_tres 	= $this->input->post('esc_status_tres');	$nova_tratativa 	= $this->input->post('nova_tratativa');	$modulo 	= $this->input->post('modulo');		if(empty($data_informe_pendencia)){		$dtInforme = '1111-11-11';		}else{		$dataInformeArr = explode("/",$data_informe_pendencia);			$dtInforme = $dataInformeArr[2].'-'.$dataInformeArr[1].'-'.$dataInformeArr[0];	}		if(empty($data_inclusao_sis_ext)){		$dtInclusaoSisExt = '1111-11-11';		}else{		$dataInformeArr = explode("/",$data_inclusao_sis_ext);			$dtInclusaoSisExt = $dataInformeArr[2].'-'.$dataInformeArr[1].'-'.$dataInformeArr[0];	}		if(empty($prazo_solucao_sis_ext)){		$dtSolSisExt = '1111-11-11';		}else{		$dataSolArr = explode("/",$prazo_solucao_sis_ext);			$dtSolSisExt = $dataSolArr[2].'-'.$dataSolArr[1].'-'.$dataSolArr[0];	}		if(empty($data_encerramento_sis_ext)){		$dtEncerSisExt = '1111-11-11';		}else{		$dataEncerramentoSisExtArr = explode("/",$data_encerramento_sis_ext);		$dtEncerSisExt = $dataEncerramentoSisExtArr[2].'-'.$dataEncerramentoSisExtArr[1].'-'.$dataEncerramentoSisExtArr[0];	}		if(empty($prazo_solucao)){		$dtPrazoSolucao = '1111-11-11';		}else{		$dtPrazoSolucaoArr = explode("/",$prazo_solucao);		$dtPrazoSolucao = $dtPrazoSolucaoArr[2].'-'.$dtPrazoSolucaoArr[1].'-'.$dtPrazoSolucaoArr[0];	}		if(empty($data_envio)){		$dtEnvio = '1111-11-11';		}else{		$dataEnvioArr = explode("/",$data_envio);		$dtEnvio = $dataEnvioArr[2].'-'.$dataEnvioArr[1].'-'.$dataEnvioArr[0];	}		if(empty($data_retorno)){		$dtRetorno = '1111-11-11';		}else{		$dataRetornoArr = explode("/",$data_retorno);		$dtRetorno = $dataRetornoArr[2].'-'.$dataRetornoArr[1].'-'.$dataRetornoArr[0];	}		if(empty($esc_data_prazo_um)){		$escDtPrazoUm = '1111-11-11';		}else{		$escDataPrazoUmArr = explode("/",$esc_data_prazo_um);		$escDtPrazoUm = $escDataPrazoUmArr[2].'-'.$escDataPrazoUmArr[1].'-'.$escDataPrazoUmArr[0];	}		if(empty($esc_data_retorno_um)){		$escDtRetUm = '1111-11-11';		}else{		$escDataPrazoUmArr = explode("/",$esc_data_retorno_um);		$escDtRetUm = $escDataPrazoUmArr[2].'-'.$escDataPrazoUmArr[1].'-'.$escDataPrazoUmArr[0];	}		if(empty($esc_data_prazo_dois)){		$escDtPrazoDois = '1111-11-11';		}else{		$escDataPrazoDoisArr = explode("/",$esc_data_prazo_dois);		$escDtPrazoDois = $escDataPrazoDoisArr[2].'-'.$escDataPrazoDoisArr[1].'-'.$escDataPrazoDoisArr[0];	}		if(empty($esc_data_retorno_dois)){		$escDtRetDois = '1111-11-11';		}else{		$escDataRetornoDoisArr = explode("/",$esc_data_retorno_dois);		$escDtRetDois = $escDataRetornoDoisArr[2].'-'.$escDataRetornoDoisArr[1].'-'.$escDataRetornoDoisArr[0];	}		if(empty($esc_data_prazo_tres)){		$escDtPrazoTres = '1111-11-11';		}else{		$escDataPrazoTresArr = explode("/",$esc_data_prazo_tres);		$escDtPrazoTres = $escDataPrazoTresArr[2].'-'.$escDataPrazoTresArr[1].'-'.$escDataPrazoTresArr[0];	}		if(empty($esc_data_retorno_tres)){		$escDtRetTres = '1111-11-11';		}else{		$escDataRetornoDoisArr = explode("/",$esc_data_retorno_tres);		$escDtRetTres = $escDataRetornoDoisArr[2].'-'.$escDataRetornoDoisArr[1].'-'.$escDataRetornoDoisArr[0];	}		$dados = array(		'id_contratante' => $idContratante,		'tipo_tratativa' => $tipo_tratativa,		'id_sis_ext' => $id_sis_ext,		'id_cnd_mob' => $id_cnd,		'pendencia' => $id_pendencia,		'esfera' => $id_esfera,		'etapa' => $id_etapa,		'data_informe_pendencia' => $dtInforme ,		'data_inclusao_sis_ext' => $dtInclusaoSisExt,		'prazo_solucao_sis_ext' => $dtSolSisExt ,		'data_encerramento_sis_ext' => $dtEncerSisExt,		'sla_sis_ext' => $id_sla,		'status_chamado_sis_ext' => $status_chamado_sis_ext , 		'usu_inc' => $usu_inc,		'area_focal' => $area_focal,		'sub_area_focal' => $sub_area_focal,		'contato' => $contato ,		'data_envio' =>$dtEnvio,		'prazo_solucao' => $dtPrazoSolucao,		'data_retorno' =>$dtRetorno,		'sla' => $sla,		'status_demanda' => $status_demanda,		'esc_data_prazo_um' =>$escDtPrazoUm,		'esc_data_retorno_um' =>$escDtRetUm,		'esc_status_um' => $esc_status_um,		'esc_data_prazo_dois' =>$escDtPrazoDois,		'esc_data_retorno_dois' =>$escDtRetDois,		'esc_status_dois' => $esc_status_dois ,		'esc_data_prazo_tres' =>$escDtPrazoTres,		'esc_data_retorno_tres' =>$escDtRetTres ,		'esc_status_tres' => $esc_status_tres,		'modulo'=>$modulo,		'data_atualizacao' => date("Y-m-d H:i:s") ,		);		if($acao == 1){			$id_tratativa = $this->cnd_imobiliaria_model->add_tratativa($dados);					}else{			$this->cnd_imobiliaria_model->atualizar_tratativa($dados,$id_tratativa);							}				//guardando id para abrir novamente apos salvar		$_SESSION['idTratativa'] = $id_tratativa;						if(($status_chamado_sis_ext <> 1) && ($status_chamado_sis_ext <> 0)){			if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s") ,				'modulo'=>$modulo							);				$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);			}					$email = $this->user->buscaEmailById($idUsu);						$dadosNovaTratativa = array(				'id_contratante' => $idContratante,			'id_cnd_trat' => $id_tratativa,			'observacao' =>'Tratativa Cancelada/Encerrada',			'id_usuario' => $idUsu,			'data' => date("Y-m-d"),			'hora'=> date("H:i:s"),			'data_hora' => date("Y-m-d H:i:s") ,			'modulo'=>$modulo					);			$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);					}else{			$dados =  $this->cnd_imobiliaria_model->listarObsTratById($id_tratativa);			$isArray =  is_array($dados) ? '1' : '0';			if($isArray == 0){							$email = $this->user->buscaEmailById($idUsu);								$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>'Tratativa Aberta',				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s"),				'modulo'=>$modulo					);				$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);			}						if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s"),				'modulo'=>$modulo								);				$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);			}		}						//$dadosEntradaCadin = array('data_entrada_cadin' =>$dtCadin);				//$this->cnd_estadual_model->atualizar($dadosEntradaCadin,$id_cnd);							$idUsuario = $session_data['id'];			if($modulo == 1){			redirect('/cnd_brasil/visao_interna_cnd_mob?id='.$id_cnd);	}elseif($modulo == 2){			redirect('/cnd_brasil/visao_interna_cnd_imob?id='.$id_cnd);	}		}function atualizar_cnd_est_tratativa_unica(){		 $this->logado();	 	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$idUsu = $session_data['id'];	$acao 	= $this->input->post('acao');			$id_cnd 	= $this->input->post('id');	$tipo_tratativa 	= $this->input->post('tipo_tratativa');	if(empty($tipo_tratativa)){		$tipo_tratativa = $this->input->post('tipo_tratativa_bd');	}	$id_tratativa 	= $this->input->post('id_tratativa');	$auto 	= $this->input->post('auto');		$natureza 	= $this->input->post('natureza');	$inscricao 	= $this->input->post('inscricao');	$processo = $this->input->post('processo');		$principal = $this->input->post('principal');	$multa = $this->input->post('multa');	$juros = $this->input->post('juros');	$valor_total = $this->input->post('valor_total');	$garantia = $this->input->post('garantia');	$responsavel = $this->input->post('garantia');	$pasta = $this->input->post('garantia');	$contato 	= $this->input->post('contato');	$escritorio = $this->input->post('escritorio');	$data_envio 	= $this->input->post('data_envio');	$prazo_solucao 	= $this->input->post('prazo_solucao');	$id_sla 	= $this->input->post('id_sla');	$status 	= $this->input->post('status_chamado_sis_ext');	$data_encerramento 	= $this->input->post('data_encerramento');	$nova_tratativa 	= $this->input->post('nova_tratativa');	$modulo 	= $this->input->post('modulo');		if(empty($data_encerramento)){		$data_encerramento = '1111-11-11';		}else{		$dataEncerramentoSisExtArr = explode("/",$data_encerramento);		$data_encerramento = $dataEncerramentoSisExtArr[2].'-'.$dataEncerramentoSisExtArr[1].'-'.$dataEncerramentoSisExtArr[0];	}		if(empty($prazo_solucao)){		$dtPrazoSolucao = '1111-11-11';		}else{		$dtPrazoSolucaoArr = explode("/",$prazo_solucao);		$dtPrazoSolucao = $dtPrazoSolucaoArr[2].'-'.$dtPrazoSolucaoArr[1].'-'.$dtPrazoSolucaoArr[0];	}		if(empty($data_envio)){		$dtEnvio = '1111-11-11';		}else{		$dataEnvioArr = explode("/",$data_envio);		$dtEnvio = $dataEnvioArr[2].'-'.$dataEnvioArr[1].'-'.$dataEnvioArr[0];	}				$dados = array(		'id_contratante' => $idContratante,		'tipo_tratativa' => $tipo_tratativa,		'id_cnd_mob' => $id_cnd,		'auto' => $auto,		'natureza' => $natureza,		'inscricao' => $inscricao,		'processo' => $processo,		'principal' => $principal,		'multa' => $multa,		'juros' => $juros,		'valor_total' => $valor_total,		'garantia' => $garantia,		'responsavel' => $responsavel,		'pasta' => $pasta,		'contato' => $contato ,		'escritorio' => $escritorio ,		'data_encerramento' =>$data_encerramento,		'data_envio' =>$dtEnvio,		'prazo_solucao' => $dtPrazoSolucao,		'sla' => $id_sla,		'status_tratativa' => $status,		'modulo'=>$modulo,		'data_atualizacao' => date("Y-m-d H:i:s") ,		);		if($acao == 1){			$id_tratativa = $this->cnd_estadual_model->add_tratativa_est($dados);					}else{			$this->cnd_estadual_model->atualizar_tratativa($dados,$id_tratativa);							}				//guardando id para abrir novamente apos salvar		$_SESSION['idTratativa'] = $id_tratativa;				if($status == 2){			if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s") ,				'modulo'=>$modulo							);				$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);			}					$email = $this->user->buscaEmailById($idUsu);						$dadosNovaTratativa = array(				'id_contratante' => $idContratante,			'id_cnd_trat' => $id_tratativa,			'observacao' =>'Tratativa Cancelada/Encerrada',			'id_usuario' => $idUsu,			'data' => date("Y-m-d"),			'hora'=> date("H:i:s"),			'data_hora' => date("Y-m-d H:i:s") ,			'modulo'=>$modulo					);			$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);					}else{						$dados =  $this->cnd_imobiliaria_model->listarObsTratById($id_tratativa);			$isArray =  is_array($dados) ? '1' : '0';			if($isArray == 0){				$email = $this->user->buscaEmailById($idUsu);								$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>'Tratativa Aberta',				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s"),				'modulo'=>$modulo					);				$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);			}			if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s"),				'modulo'=>$modulo								);				$this->cnd_imobiliaria_model->addObsTrat($dadosNovaTratativa);			}		}			$idUsuario = $session_data['id'];	redirect('/cnd_brasil/visao_interna_cnd_est?id='.$id_cnd);		} function cnd_fed_criar(){	 $this->logado();	$session_data = $_SESSION['loginTeste'];	$data['cnpj_matriz']= $this->emitente_model->listarCnpjMatriz(); 	$data['perfil'] = $session_data['perfil'];		$this->load->view('header_pages_view',$data);	$this->load->view('criar_cnd_federal', $data);	$this->load->view('footer_pages_view'); }  function cadastrar_cnd_fed(){	$this->logado();	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];			$cnpjMatriz 	= $this->input->post('cnpjMatriz');	$cnpjEmitente = $this->input->post('cnpjEmitente');		$dados = array(			'id_contratante' => $idContratante,				'cnpj_matriz' => $cnpjMatriz,		'id_emitente' => $cnpjEmitente,		'possui_cnd' => 3	);	$id = $this->cnd_federal_model->add($dados);		redirect('/cnd_brasil/visao_interna_cnd_fed?id='.$id); }  function atualizar_cnd_fed_tratativa_unica(){		 $this->logado();	 	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$idUsu = $session_data['id'];	$acao 	= $this->input->post('acao');			$data_entrada_cadin 	= $this->input->post('data_entrada_cadin');			if(empty($data_entrada_cadin)){		$dtCadin = '1111-11-11';		}else{		$dtCadinArr = explode("/",$data_entrada_cadin);			$dtCadin = $dtCadinArr[2].'-'.$dtCadinArr[1].'-'.$dtCadinArr[0];	}	$id_cnd 	= $this->input->post('id');		$tipo_tratativa 	= $this->input->post('tipo_tratativa');	if(empty($tipo_tratativa)){		$tipo_tratativa = $this->input->post('tipo_tratativa_bd');		if(empty($tipo_tratativa)){			$tipo_tratativa=0;		}	}	$id_tratativa 	= $this->input->post('id_tratativa');	$id_pendencia 	= $this->input->post('id_pendencia');	$id_esfera 	= $this->input->post('id_esfera');	$id_etapa 	= $this->input->post('id_etapa');	$data_informe_pendencia 	= $this->input->post('data_informe_pendencia');	$id_sis_ext 	= $this->input->post('id_sis_ext');	$data_inclusao_sis_ext 	= $this->input->post('data_inclusao_sis_ext');	$prazo_solucao_sis_ext 	= $this->input->post('prazo_solucao_sis_ext');	$data_encerramento_sis_ext 	= $this->input->post('data_encerramento_sis_ext');	$status_chamado_sis_ext 	= $this->input->post('status_chamado_sis_ext');	$id_sla = $this->input->post('id_sla');	$usu_inc 	= $this->input->post('usu_inc');	$area_focal 	= $this->input->post('area_focal');	$sub_area_focal 	= $this->input->post('sub_area_focal');	$contato 	= $this->input->post('contato');	$data_envio 	= $this->input->post('data_envio');	$prazo_solucao 	= $this->input->post('prazo_solucao');	$data_retorno 	= $this->input->post('data_retorno');	$sla 	= $this->input->post('sla');	$status_demanda 	= $this->input->post('status_demanda');	$esc_data_prazo_um 	= $this->input->post('esc_data_prazo_um');	$esc_data_retorno_um 	= $this->input->post('esc_data_retorno_um');	$esc_status_um 	= $this->input->post('esc_status_um');	$esc_data_prazo_dois 	= $this->input->post('esc_data_prazo_dois');	$esc_data_retorno_dois 	= $this->input->post('esc_data_retorno_dois');	$esc_status_dois 	= $this->input->post('esc_status_dois');	$esc_data_prazo_tres 	= $this->input->post('esc_data_prazo_tres');	$esc_data_retorno_tres 	= $this->input->post('esc_data_retorno_tres');	$esc_status_tres 	= $this->input->post('esc_status_tres');	$nova_tratativa 	= $this->input->post('nova_tratativa');	$cnpj_pendencia= $this->input->post('cnpj_pendencia');	$origem_pendencia= $this->input->post('origem_pendencia');	$natureza_pendencia= $this->input->post('natureza_pendencia');	$agrupamento= $this->input->post('agrupamento');	$inscricao_divida_ativa= $this->input->post('inscricao_divida_ativa');	$processo= $this->input->post('processo');	$debito_cobranca_rfb= $this->input->post('debito_cobranca_rfb');	$debito_cobranca_pgfn= $this->input->post('debito_cobranca_pgfn');	$descricao_pendencia= $this->input->post('descricao_pendencia');	$valor_pendencia= $this->input->post('valor_pendencia');		if(empty($data_informe_pendencia)){		$dtInforme = '1111-11-11';		}else{		$dataInformeArr = explode("/",$data_informe_pendencia);			$dtInforme = $dataInformeArr[2].'-'.$dataInformeArr[1].'-'.$dataInformeArr[0];	}		if(empty($data_inclusao_sis_ext)){		$dtInclusaoSisExt = '1111-11-11';		}else{		$dataInformeArr = explode("/",$data_inclusao_sis_ext);			$dtInclusaoSisExt = $dataInformeArr[2].'-'.$dataInformeArr[1].'-'.$dataInformeArr[0];	}		if(empty($prazo_solucao_sis_ext)){		$dtSolSisExt = '1111-11-11';		}else{		$dataSolArr = explode("/",$prazo_solucao_sis_ext);			$dtSolSisExt = $dataSolArr[2].'-'.$dataSolArr[1].'-'.$dataSolArr[0];	}		if(empty($data_encerramento_sis_ext)){		$dtEncerSisExt = '1111-11-11';		}else{		$dataEncerramentoSisExtArr = explode("/",$data_encerramento_sis_ext);		$dtEncerSisExt = $dataEncerramentoSisExtArr[2].'-'.$dataEncerramentoSisExtArr[1].'-'.$dataEncerramentoSisExtArr[0];	}		if(empty($prazo_solucao)){		$dtPrazoSolucao = '1111-11-11';		}else{		$dtPrazoSolucaoArr = explode("/",$prazo_solucao);		$dtPrazoSolucao = $dtPrazoSolucaoArr[2].'-'.$dtPrazoSolucaoArr[1].'-'.$dtPrazoSolucaoArr[0];	}		if(empty($data_envio)){		$dtEnvio = '1111-11-11';		}else{		$dataEnvioArr = explode("/",$data_envio);		$dtEnvio = $dataEnvioArr[2].'-'.$dataEnvioArr[1].'-'.$dataEnvioArr[0];	}		if(empty($data_retorno)){		$dtRetorno = '1111-11-11';		}else{		$dataRetornoArr = explode("/",$data_retorno);		$dtRetorno = $dataRetornoArr[2].'-'.$dataRetornoArr[1].'-'.$dataRetornoArr[0];	}		if(empty($esc_data_prazo_um)){		$escDtPrazoUm = '1111-11-11';		}else{		$escDataPrazoUmArr = explode("/",$esc_data_prazo_um);		$escDtPrazoUm = $escDataPrazoUmArr[2].'-'.$escDataPrazoUmArr[1].'-'.$escDataPrazoUmArr[0];	}		if(empty($esc_data_retorno_um)){		$escDtRetUm = '1111-11-11';		}else{		$escDataPrazoUmArr = explode("/",$esc_data_retorno_um);		$escDtRetUm = $escDataPrazoUmArr[2].'-'.$escDataPrazoUmArr[1].'-'.$escDataPrazoUmArr[0];	}		if(empty($esc_data_prazo_dois)){		$escDtPrazoDois = '1111-11-11';		}else{		$escDataPrazoDoisArr = explode("/",$esc_data_prazo_dois);		$escDtPrazoDois = $escDataPrazoDoisArr[2].'-'.$escDataPrazoDoisArr[1].'-'.$escDataPrazoDoisArr[0];	}		if(empty($esc_data_retorno_dois)){		$escDtRetDois = '1111-11-11';		}else{		$escDataRetornoDoisArr = explode("/",$esc_data_retorno_dois);		$escDtRetDois = $escDataRetornoDoisArr[2].'-'.$escDataRetornoDoisArr[1].'-'.$escDataRetornoDoisArr[0];	}		if(empty($esc_data_prazo_tres)){		$escDtPrazoTres = '1111-11-11';		}else{		$escDataPrazoTresArr = explode("/",$esc_data_prazo_tres);		$escDtPrazoTres = $escDataPrazoTresArr[2].'-'.$escDataPrazoTresArr[1].'-'.$escDataPrazoTresArr[0];	}		if(empty($esc_data_retorno_tres)){		$escDtRetTres = '1111-11-11';		}else{		$escDataRetornoDoisArr = explode("/",$esc_data_retorno_tres);		$escDtRetTres = $escDataRetornoDoisArr[2].'-'.$escDataRetornoDoisArr[1].'-'.$escDataRetornoDoisArr[0];	}		$dados = array(		'id_contratante' => $idContratante,		'tipo_tratativa' => $tipo_tratativa,		'id_sis_ext' => $id_sis_ext,		'id_cnd_mob' => $id_cnd,		'pendencia' => $id_pendencia,		'esfera' => $id_esfera,		'etapa' => $id_etapa,		'data_informe_pendencia' => $dtInforme ,		'data_inclusao_sis_ext' => $dtInclusaoSisExt,		'prazo_solucao_sis_ext' => $dtSolSisExt ,		'data_encerramento_sis_ext' => $dtEncerSisExt,		'status_chamado_sis_ext' => $status_chamado_sis_ext , 		'usu_inc' => $usu_inc,		'area_focal' => $area_focal,		'sub_area_focal' => $sub_area_focal,		'contato' => $contato ,		'data_envio' =>$dtEnvio,		'prazo_solucao' => $dtPrazoSolucao,		'data_retorno' =>$dtRetorno,		'sla' => $sla,		'status_demanda' => $status_demanda,		'esc_data_prazo_um' =>$escDtPrazoUm,		'esc_data_retorno_um' =>$escDtRetUm,		'esc_status_um' => $esc_status_um,		'esc_data_prazo_dois' =>$escDtPrazoDois,		'esc_data_retorno_dois' =>$escDtRetDois,		'esc_status_dois' => $esc_status_dois ,		'esc_data_prazo_tres' =>$escDtPrazoTres,		'esc_data_retorno_tres' =>$escDtRetTres ,		'esc_status_tres' => $esc_status_tres,		'cnpj_pendencia'=>$cnpj_pendencia,		'origem_pendencia'=>$origem_pendencia,		'natureza_pendencia'=>$natureza_pendencia,		'agrupamento'=>$agrupamento,		'inscricao_divida_ativa'=>$inscricao_divida_ativa,		'processo'=>$processo,		'debito_cobranca_rfb'=>$debito_cobranca_rfb,		'debito_cobranca_pgfn'=>$debito_cobranca_pgfn,		'descricao_pendencia'=>$descricao_pendencia,		'valor_pendencia'=>$valor_pendencia,		'data_atualizacao' => date("Y-m-d H:i:s") 		);				if($acao == 1){			$id_tratativa = $this->cnd_federal_model->add_tratativa($dados);					}else{			$this->cnd_federal_model->atualizar_tratativa($dados,$id_tratativa);							}				//guardando id para abrir novamente apos salvar		$_SESSION['idTratativaFederal'] = $id_tratativa;						if(($status_chamado_sis_ext <> 3) && ($status_chamado_sis_ext <> 0)){						if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s") 							);				$this->cnd_federal_model->addObsTrat($dadosNovaTratativa);			}					$email = $this->user->buscaEmailById($idUsu);						$dadosNovaTratativa = array(				'id_contratante' => $idContratante,			'id_cnd_trat' => $id_tratativa,			'observacao' =>'Tratativa Cancelada/Encerrada',			'id_usuario' => $idUsu,			'data' => date("Y-m-d"),			'hora'=> date("H:i:s"),			'data_hora' => date("Y-m-d H:i:s") 					);			$this->cnd_federal_model->addObsTrat($dadosNovaTratativa);					}else{						$dados =  $this->cnd_federal_model->listarObsTratById($id_tratativa);			$isArray =  is_array($dados) ? '1' : '0';			if($isArray == 0){							$email = $this->user->buscaEmailById($idUsu);								$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>'Tratativa Aberta',				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s") 						);				$this->cnd_federal_model->addObsTrat($dadosNovaTratativa);			}						if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'data_hora' => date("Y-m-d H:i:s") 							);				$this->cnd_federal_model->addObsTrat($dadosNovaTratativa);			}		}						//$dadosEntradaCadin = array('data_entrada_cadin' =>$dtCadin);				//$this->cnd_estadual_model->atualizar($dadosEntradaCadin,$id_cnd);							$idUsuario = $session_data['id'];	redirect('/cnd_brasil/visao_interna_cnd_fed?id='.$id_cnd);		}function atualizar_cnd_mob_tratativa_unica(){	 	 $this->logado();	 	$session_data = $_SESSION['loginTeste'];	$idContratante = $session_data['id_contratante'];		$idUsu = $session_data['id'];	$acao 	= $this->input->post('acao');			$data_entrada_cadin 	= $this->input->post('data_entrada_cadin');			if(empty($data_entrada_cadin)){		$dtCadin = '1111-11-11';		}else{		$dtCadinArr = explode("/",$data_entrada_cadin);			$dtCadin = $dtCadinArr[2].'-'.$dtCadinArr[1].'-'.$dtCadinArr[0];	}	$id_cnd 	= $this->input->post('id');	$tipo_tratativa_escolhido 	= $this->input->post('tipo_tratativa');	if(empty($tipo_tratativa_escolhido)){		$tipo_tratativa_bd = $this->input->post('tipo_tratativa_bd');		if(empty($tipo_tratativa_bd)){			$tipo_tratativa = 0;		}else{			$tipo_tratativa =$tipo_tratativa_escolhido;		}	}else{		$tipo_tratativa =$tipo_tratativa_escolhido;	}	$id_tratativa 	= $this->input->post('id_tratativa');	$id_pendencia 	= $this->input->post('id_pendencia');	$id_esfera 	= $this->input->post('id_esfera');	$id_etapa 	= $this->input->post('id_etapa');	$data_informe_pendencia 	= $this->input->post('data_informe_pendencia');	$id_sis_ext 	= $this->input->post('id_sis_ext');	$data_inclusao_sis_ext 	= $this->input->post('data_inclusao_sis_ext');	$prazo_solucao_sis_ext 	= $this->input->post('prazo_solucao_sis_ext');	$data_encerramento_sis_ext 	= $this->input->post('data_encerramento_sis_ext');	$status_chamado_sis_ext 	= $this->input->post('status_chamado_sis_ext');	$id_sla = $this->input->post('id_sla');	$id_natureza_raiz = $this->input->post('id_natureza_raiz');	$id_area_focal = $this->input->post('id_area_focal');		if(empty($id_sla)){		$id_sla = 0;	}	$usu_inc 	= $this->input->post('usu_inc');	$area_focal 	= $this->input->post('area_focal');	$sub_area_focal 	= $this->input->post('sub_area_focal');	$contato 	= $this->input->post('contato');	$data_envio 	= $this->input->post('data_envio');	$prazo_solucao 	= $this->input->post('prazo_solucao');	$data_retorno 	= $this->input->post('data_retorno');	$sla 	= $this->input->post('sla');	$status_demanda 	= $this->input->post('status_demanda');	$esc_data_prazo_um 	= $this->input->post('esc_data_prazo_um');	$esc_data_retorno_um 	= $this->input->post('esc_data_retorno_um');	$esc_status_um 	= $this->input->post('esc_status_um');	$esc_data_prazo_dois 	= $this->input->post('esc_data_prazo_dois');	$esc_data_retorno_dois 	= $this->input->post('esc_data_retorno_dois');	$esc_status_dois 	= $this->input->post('esc_status_dois');	$esc_data_prazo_tres 	= $this->input->post('esc_data_prazo_tres');	$esc_data_retorno_tres 	= $this->input->post('esc_data_retorno_tres');	$esc_status_tres 	= $this->input->post('esc_status_tres');	$nova_tratativa 	= $this->input->post('nova_tratativa');	$valorPendencia 	= $this->input->post('valorPendencia');	if(empty($valorPendencia)){		$valorPendencia 	='0.0';	}		if(empty($data_informe_pendencia)){		$dtInforme = '1111-11-11';		}else{				if($data_informe_pendencia == '00/00/0000'){			$dtInforme = '1111-11-11';			}else{			$dataInformeArr = explode("/",$data_informe_pendencia);				$dtInforme = $dataInformeArr[2].'-'.$dataInformeArr[1].'-'.$dataInformeArr[0];		}					}		if(empty($data_inclusao_sis_ext)){		$dtInclusaoSisExt = '1111-11-11';		}else{				if($data_inclusao_sis_ext == '00/00/0000'){			$dtInclusaoSisExt = '1111-11-11';			}else{			$dataInformeArr = explode("/",$data_inclusao_sis_ext);				$dtInclusaoSisExt = $dataInformeArr[2].'-'.$dataInformeArr[1].'-'.$dataInformeArr[0];		}							}		if(empty($prazo_solucao_sis_ext)){		$dtSolSisExt = '1111-11-11';		}else{				if($prazo_solucao_sis_ext == '00/00/0000'){			$dtSolSisExt = '1111-11-11';			}else{			$dataSolArr = explode("/",$prazo_solucao_sis_ext);				$dtSolSisExt = $dataSolArr[2].'-'.$dataSolArr[1].'-'.$dataSolArr[0];		}					}		if(empty($data_encerramento_sis_ext)){		$dtEncerSisExt = '1111-11-11';		}else{		if($data_encerramento_sis_ext == '00/00/0000'){			$dtEncerSisExt = '1111-11-11';			}else{			$dataEncerramentoSisExtArr = explode("/",$data_encerramento_sis_ext);			$dtEncerSisExt = $dataEncerramentoSisExtArr[2].'-'.$dataEncerramentoSisExtArr[1].'-'.$dataEncerramentoSisExtArr[0];		}			}		if(empty($prazo_solucao)){		$dtPrazoSolucao = '1111-11-11';		}else{				if($prazo_solucao == '00/00/0000'){			$dtPrazoSolucao = '1111-11-11';			}else{			$dtPrazoSolucaoArr = explode("/",$prazo_solucao);			$dtPrazoSolucao = $dtPrazoSolucaoArr[2].'-'.$dtPrazoSolucaoArr[1].'-'.$dtPrazoSolucaoArr[0];		}					}		if(empty($data_envio)){		$dtEnvio = '1111-11-11';		}else{				if($data_envio == '00/00/0000'){			$dtEnvio = '1111-11-11';			}else{			$dataEnvioArr = explode("/",$data_envio);			$dtEnvio = $dataEnvioArr[2].'-'.$dataEnvioArr[1].'-'.$dataEnvioArr[0];		}							}		if(empty($data_retorno)){		$dtRetorno = '1111-11-11';		}else{				if($data_retorno == '00/00/0000'){			$dtRetorno = '1111-11-11';			}else{			$dataRetornoArr = explode("/",$data_retorno);			$dtRetorno = $dataRetornoArr[2].'-'.$dataRetornoArr[1].'-'.$dataRetornoArr[0];		}							}		if(empty($esc_data_prazo_um)){		$escDtPrazoUm = '1111-11-11';		}else{				if($esc_data_prazo_um == '00/00/0000'){			$escDtPrazoUm = '1111-11-11';			}else{			$escDataPrazoUmArr = explode("/",$esc_data_prazo_um);			$escDtPrazoUm = $escDataPrazoUmArr[2].'-'.$escDataPrazoUmArr[1].'-'.$escDataPrazoUmArr[0];		}					}		if(empty($esc_data_retorno_um)){		$escDtRetUm = '1111-11-11';		}else{				if($esc_data_retorno_um == '00/00/0000'){			$escDtRetUm = '1111-11-11';			}else{			$escDataPrazoUmArr = explode("/",$esc_data_retorno_um);			$escDtRetUm = $escDataPrazoUmArr[2].'-'.$escDataPrazoUmArr[1].'-'.$escDataPrazoUmArr[0];		}					}		if(empty($esc_data_prazo_dois)){		$escDtPrazoDois = '1111-11-11';		}else{				if($esc_data_prazo_dois == '00/00/0000'){			$escDtPrazoDois = '1111-11-11';			}else{			$escDataPrazoDoisArr = explode("/",$esc_data_prazo_dois);			$escDtPrazoDois = $escDataPrazoDoisArr[2].'-'.$escDataPrazoDoisArr[1].'-'.$escDataPrazoDoisArr[0];		}					}		if(empty($esc_data_retorno_dois)){		$escDtRetDois = '1111-11-11';		}else{				if($esc_data_retorno_dois == '00/00/0000'){			$escDtPrazoDois = '1111-11-11';			}else{			$escDataRetornoDoisArr = explode("/",$esc_data_retorno_dois);			$escDtPrazoDois = $escDataRetornoDoisArr[2].'-'.$escDataRetornoDoisArr[1].'-'.$escDataRetornoDoisArr[0];		}					}		if(empty($esc_data_prazo_tres)){		$escDtPrazoTres = '1111-11-11';		}else{				if($esc_data_prazo_tres == '00/00/0000'){			$escDtPrazoTres = '1111-11-11';			}else{			$escDataPrazoTresArr = explode("/",$esc_data_prazo_tres);			$escDtPrazoTres = $escDataPrazoTresArr[2].'-'.$escDataPrazoTresArr[1].'-'.$escDataPrazoTresArr[0];		}					}		if(empty($esc_data_retorno_tres)){		$escDtRetTres = '1111-11-11';		}else{				if($esc_data_retorno_tres == '00/00/0000'){			$escDtRetTres = '1111-11-11';			}else{			$escDataRetornoDoisArr = explode("/",$esc_data_retorno_tres);			$escDtRetTres = $escDataRetornoDoisArr[2].'-'.$escDataRetornoDoisArr[1].'-'.$escDataRetornoDoisArr[0];		}					}	if($_SESSION['loginTeste']['tipo_cnd'] == 2){  		$modulo = 2;	}elseif($_SESSION['loginTeste']['tipo_cnd'] == 1){		$modulo = 1;	}else{		$modulo = 3;	}				$dados = array(		'id_contratante' => $idContratante,		'tipo_tratativa' => $tipo_tratativa,		'id_sis_ext' => $id_sis_ext,		'id_cnd_mob' => $id_cnd,		'pendencia' => $id_pendencia,		'esfera' => $id_esfera,		'etapa' => $id_etapa,		'data_informe_pendencia' => $dtInforme ,		'data_inclusao_sis_ext' => $dtInclusaoSisExt,		'prazo_solucao_sis_ext' => $dtSolSisExt ,		'data_encerramento_sis_ext' => $dtEncerSisExt,		'sla_sis_ext' => $id_sla,		'status_chamado_sis_ext' => $status_chamado_sis_ext , 		'usu_inc' => $usu_inc,		'area_focal' => $area_focal,		'sub_area_focal' => $sub_area_focal,		'contato' => $contato ,		'data_envio' =>$dtEnvio,		'prazo_solucao' => $dtPrazoSolucao,		'data_retorno' =>$dtRetorno,		'sla' => $sla,		'status_demanda' => $status_demanda,		'esc_data_prazo_um' =>$escDtPrazoUm,		'esc_data_retorno_um' =>$escDtRetUm,		'esc_status_um' => $esc_status_um,		'esc_data_prazo_dois' =>$escDtPrazoDois,		'esc_data_retorno_dois' =>$escDtRetDois,		'esc_status_dois' => $esc_status_dois ,		'esc_data_prazo_tres' =>$escDtPrazoTres,		'esc_data_retorno_tres' =>$escDtRetTres ,		'esc_status_tres' => $esc_status_tres,		'modulo'=>$modulo,		'id_natureza_raiz'=>$id_natureza_raiz,		'id_area_focal'=>$id_area_focal,		'valor_pendencia'=>$valorPendencia,		'data_atualizacao' => date("Y-m-d H:i:s") 		);		if($acao == 1){			$id_tratativa = $this->cnd_mobiliaria_model->add_tratativa($dados);					}else{			$this->cnd_mobiliaria_model->atualizar_tratativa($dados,$id_tratativa);							}				//guardando id para abrir novamente apos salvar		$_SESSION['idTratativa'] = $id_tratativa;						if(($status_chamado_sis_ext <> 1) && ($status_chamado_sis_ext <> 0)){						if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'modulo'=>$modulo,				'data_hora' => date("Y-m-d H:i:s") 							);				$this->cnd_mobiliaria_model->addObsTrat($dadosNovaTratativa);			}					$email = $this->user->buscaEmailById($idUsu);						$dadosNovaTratativa = array(				'id_contratante' => $idContratante,			'id_cnd_trat' => $id_tratativa,			'observacao' =>'Tratativa Cancelada/Encerrada',			'id_usuario' => $idUsu,			'data' => date("Y-m-d"),			'hora'=> date("H:i:s"),			'modulo'=>$modulo,			'data_hora' => date("Y-m-d H:i:s") 					);			$this->cnd_mobiliaria_model->addObsTrat($dadosNovaTratativa);					}else{						$dados =  $this->cnd_mobiliaria_model->listarObsTratById($id_tratativa);			$isArray =  is_array($dados) ? '1' : '0';			if($isArray == 0){							$email = $this->user->buscaEmailById($idUsu);								$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>'Tratativa Aberta',				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'modulo'=>$modulo,				'data_hora' => date("Y-m-d H:i:s") 						);				$this->cnd_mobiliaria_model->addObsTrat($dadosNovaTratativa);			}						if(!empty($nova_tratativa)){				$dadosNovaTratativa = array(					'id_contratante' => $idContratante,				'id_cnd_trat' => $id_tratativa,				'observacao' =>$nova_tratativa,				'id_usuario' => $idUsu,				'data' => date("Y-m-d"),				'hora'=> date("H:i:s"),				'modulo'=>$modulo,				'data_hora' => date("Y-m-d H:i:s") 							);				$this->cnd_mobiliaria_model->addObsTrat($dadosNovaTratativa);			}		}			redirect('/cnd_brasil/visao_interna_cnd_mob?id='.$id_cnd);		}  	public function limpar()	{				redirect('cnd_brasil/listar_pendencia', 'refresh');	}		
}
?>